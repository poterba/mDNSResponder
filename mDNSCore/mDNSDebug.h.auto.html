<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<title>mDNSDebug.h</title>
<style type="text/css">
.enscript-comment { font-style: italic; color: rgb(178,34,34); }
.enscript-function-name { font-weight: bold; color: rgb(0,0,255); }
.enscript-variable-name { font-weight: bold; color: rgb(184,134,11); }
.enscript-keyword { font-weight: bold; color: rgb(160,32,240); }
.enscript-reference { font-weight: bold; color: rgb(95,158,160); }
.enscript-string { font-weight: bold; color: rgb(188,143,143); }
.enscript-builtin { font-weight: bold; color: rgb(218,112,214); }
.enscript-type { font-weight: bold; color: rgb(34,139,34); }
.enscript-highlight { text-decoration: underline; color: 0; }
</style>
</head>
<body id="top">
<h1 style="margin:8px;" id="f1">mDNSDebug.h&nbsp;&nbsp;&nbsp;<span style="font-weight: normal; font-size: 0.5em;">[<a href="mDNSDebug.h">plain text</a>]</span></h1>
<hr/>
<div></div>
<pre>
<span class="enscript-comment">/*
 * Copyright (c) 2002-2019 Apple Inc. All rights reserved.
 *
 * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     <a href="http://www.apache.org/licenses/LICENSE-2.0">http://www.apache.org/licenses/LICENSE-2.0</a>
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */</span>

#<span class="enscript-reference">ifndef</span> <span class="enscript-variable-name">__mDNSDebug_h</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">__mDNSDebug_h</span>

#<span class="enscript-reference">include</span> <span class="enscript-string">&quot;mDNSFeatures.h&quot;</span>

#<span class="enscript-reference">if</span> <span class="enscript-variable-name">MDNSRESPONDER_SUPPORTS</span>(<span class="enscript-variable-name">APPLE</span>, <span class="enscript-variable-name">OS_LOG</span>)
#<span class="enscript-reference">include</span> <span class="enscript-string">&lt;os/log.h&gt;</span>
#<span class="enscript-reference">endif</span>

<span class="enscript-comment">// Set MDNS_DEBUGMSGS to 0 to optimize debugf() calls out of the compiled code
</span><span class="enscript-comment">// Set MDNS_DEBUGMSGS to 1 to generate normal debugging messages
</span><span class="enscript-comment">// Set MDNS_DEBUGMSGS to 2 to generate verbose debugging messages
</span><span class="enscript-comment">// MDNS_DEBUGMSGS is normally set in the project options (or makefile) but can also be set here if desired
</span><span class="enscript-comment">// (If you edit the file here to turn on MDNS_DEBUGMSGS while you're debugging some code, be careful
</span><span class="enscript-comment">// not to accidentally check-in that change by mistake when you check in your other changes.)
</span>
<span class="enscript-comment">//#undef MDNS_DEBUGMSGS
</span><span class="enscript-comment">//#define MDNS_DEBUGMSGS 2
</span>
<span class="enscript-comment">// Set MDNS_CHECK_PRINTF_STYLE_FUNCTIONS to 1 to enable extra GCC compiler warnings
</span><span class="enscript-comment">// Note: You don't normally want to do this, because it generates a bunch of
</span><span class="enscript-comment">// spurious warnings for the following custom extensions implemented by mDNS_vsnprintf:
</span><span class="enscript-comment">//    warning: `#' flag used with `%s' printf format    (for %#s              -- pascal string format)
</span><span class="enscript-comment">//    warning: repeated `#' flag in format              (for %##s             -- DNS name string format)
</span><span class="enscript-comment">//    warning: double format, pointer arg (arg 2)       (for %.4a, %.16a, %#a -- IP address formats)
</span>#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MDNS_CHECK_PRINTF_STYLE_FUNCTIONS</span> 0

#<span class="enscript-reference">if</span> <span class="enscript-variable-name">MDNSRESPONDER_SUPPORTS</span>(<span class="enscript-variable-name">APPLE</span>, <span class="enscript-variable-name">OS_LOG</span>)
<span class="enscript-type">typedef</span> os_log_t mDNSLogCategory_t;

<span class="enscript-type">typedef</span> os_log_type_t mDNSLogLevel_t;
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MDNS_LOG_FAULT</span>      OS_LOG_TYPE_FAULT
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MDNS_LOG_ERROR</span>      OS_LOG_TYPE_ERROR
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MDNS_LOG_WARNING</span>    OS_LOG_TYPE_DEFAULT
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MDNS_LOG_DEFAULT</span>    OS_LOG_TYPE_DEFAULT
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MDNS_LOG_INFO</span>       OS_LOG_TYPE_DEFAULT
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MDNS_LOG_DEBUG</span>      OS_LOG_TYPE_DEBUG
#<span class="enscript-reference">else</span>
<span class="enscript-type">typedef</span> <span class="enscript-type">const</span> <span class="enscript-type">char</span> * mDNSLogCategory_t;
<span class="enscript-type">typedef</span> <span class="enscript-type">enum</span>
{
    MDNS_LOG_FAULT   = 1,
    MDNS_LOG_ERROR   = 2,
    MDNS_LOG_WARNING = 3,
    MDNS_LOG_DEFAULT = 4,
    MDNS_LOG_INFO    = 5,
    MDNS_LOG_DEBUG   = 6
} mDNSLogLevel_t;
#<span class="enscript-reference">endif</span>

#<span class="enscript-reference">if</span> <span class="enscript-variable-name">MDNSRESPONDER_SUPPORTS</span>(<span class="enscript-variable-name">APPLE</span>, <span class="enscript-variable-name">OS_LOG</span>)
    <span class="enscript-type">extern</span> os_log_t mDNSLogCategory_Default;
    <span class="enscript-type">extern</span> os_log_t mDNSLogCategory_mDNS;
    <span class="enscript-type">extern</span> os_log_t mDNSLogCategory_uDNS;
    <span class="enscript-type">extern</span> os_log_t mDNSLogCategory_SPS;
    <span class="enscript-type">extern</span> os_log_t mDNSLogCategory_XPC;

    #define MDNS_LOG_CATEGORY_DEFINITION(NAME)  mDNSLogCategory_ ## NAME
#<span class="enscript-reference">else</span>
    #define MDNS_LOG_CATEGORY_DEFINITION(NAME)  # NAME
#<span class="enscript-reference">endif</span>

#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MDNS_LOG_CATEGORY_DEFAULT</span>   MDNS_LOG_CATEGORY_DEFINITION(Default)
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MDNS_LOG_CATEGORY_MDNS</span>      MDNS_LOG_CATEGORY_DEFINITION(mDNS)
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MDNS_LOG_CATEGORY_UDNS</span>      MDNS_LOG_CATEGORY_DEFINITION(uDNS)
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MDNS_LOG_CATEGORY_SPS</span>       MDNS_LOG_CATEGORY_DEFINITION(SPS)
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">MDNS_LOG_CATEGORY_XPC</span>       MDNS_LOG_CATEGORY_DEFINITION(XPC)

<span class="enscript-comment">// Set this symbol to 1 to answer remote queries for our Address, and reverse mapping PTR
</span>#<span class="enscript-reference">define</span> <span class="enscript-variable-name">ANSWER_REMOTE_HOSTNAME_QUERIES</span> 0

<span class="enscript-comment">// Set this symbol to 1 to do extra debug checks on malloc() and free()
</span><span class="enscript-comment">// Set this symbol to 2 to write a log message for every malloc() and free()
</span><span class="enscript-comment">// #define MDNS_MALLOC_DEBUGGING 1
</span>
#<span class="enscript-reference">if</span> (<span class="enscript-variable-name">MDNS_MALLOC_DEBUGGING</span> &gt; 0) &amp;&amp; <span class="enscript-reference">defined</span>(<span class="enscript-variable-name">WIN32</span>)
#<span class="enscript-reference">error</span> <span class="enscript-string">&quot;Malloc debugging does not yet work on Windows&quot;</span>
#<span class="enscript-reference">endif</span>

<span class="enscript-comment">//#define ForceAlerts 1
</span><span class="enscript-comment">//#define LogTimeStamps 1
</span>
<span class="enscript-comment">// Developer-settings section ends here
</span>
#<span class="enscript-reference">if</span> <span class="enscript-variable-name">MDNS_CHECK_PRINTF_STYLE_FUNCTIONS</span>
#<span class="enscript-reference">define</span> <span class="enscript-function-name">IS_A_PRINTF_STYLE_FUNCTION</span>(F,A) __attribute__ ((format(printf,F,A)))
#<span class="enscript-reference">else</span>
#<span class="enscript-reference">define</span> <span class="enscript-function-name">IS_A_PRINTF_STYLE_FUNCTION</span>(F,A)
#<span class="enscript-reference">endif</span>

#<span class="enscript-reference">ifdef</span> <span class="enscript-variable-name">__cplusplus</span>
<span class="enscript-type">extern</span> <span class="enscript-string">&quot;C&quot;</span> {
#<span class="enscript-reference">endif</span>

<span class="enscript-comment">// Variable argument macro support. Use ANSI C99 __VA_ARGS__ where possible. Otherwise, use the next best thing.
</span>
#<span class="enscript-reference">if</span> (<span class="enscript-reference">defined</span>(<span class="enscript-variable-name">__GNUC__</span>))
    #<span class="enscript-keyword">if</span> ((__GNUC__ &gt; 3) || ((__GNUC__ == 3) &amp;&amp; (__GNUC_MINOR__ &gt;= 2)))
        #define MDNS_C99_VA_ARGS        1
        #define MDNS_GNU_VA_ARGS        0
    #<span class="enscript-keyword">else</span>
        #define MDNS_C99_VA_ARGS        0
        #define MDNS_GNU_VA_ARGS        1
    #endif
    #define MDNS_HAS_VA_ARG_MACROS      1
#<span class="enscript-reference">elif</span> (<span class="enscript-variable-name">_MSC_VER</span> &gt;= 1400) // <span class="enscript-variable-name">Visual</span> <span class="enscript-variable-name">Studio</span> 2005 <span class="enscript-variable-name">and</span> <span class="enscript-variable-name">later</span>
    #define MDNS_C99_VA_ARGS            1
    #define MDNS_GNU_VA_ARGS            0
    #define MDNS_HAS_VA_ARG_MACROS      1
#<span class="enscript-reference">elif</span> (<span class="enscript-reference">defined</span>(<span class="enscript-variable-name">__MWERKS__</span>))
    #define MDNS_C99_VA_ARGS            1
    #define MDNS_GNU_VA_ARGS            0
    #define MDNS_HAS_VA_ARG_MACROS      1
#<span class="enscript-reference">else</span>
    #define MDNS_C99_VA_ARGS            0
    #define MDNS_GNU_VA_ARGS            0
    #define MDNS_HAS_VA_ARG_MACROS      0
#<span class="enscript-reference">endif</span>

#<span class="enscript-reference">if</span> (<span class="enscript-variable-name">MDNS_HAS_VA_ARG_MACROS</span>)
    #<span class="enscript-keyword">if</span> (MDNS_C99_VA_ARGS)
        #define MDNS_LOG_DEFINITION(LEVEL, ...) \
            <span class="enscript-keyword">do</span> { <span class="enscript-keyword">if</span> (mDNS_LoggingEnabled) LogMsgWithLevel(MDNS_LOG_CATEGORY_DEFAULT, LEVEL, __VA_ARGS__); } <span class="enscript-keyword">while</span> (0)

        #define debug_noop(...)   <span class="enscript-keyword">do</span> {} <span class="enscript-keyword">while</span>(0)
        #define LogMsg(...)       LogMsgWithLevel(MDNS_LOG_CATEGORY_DEFAULT, MDNS_LOG_DEFAULT, __VA_ARGS__)
        #define LogOperation(...) MDNS_LOG_DEFINITION(MDNS_LOG_INFO,  __VA_ARGS__)
        #define LogSPS(...)       MDNS_LOG_DEFINITION(MDNS_LOG_INFO,  __VA_ARGS__)
        #define LogInfo(...)      MDNS_LOG_DEFINITION(MDNS_LOG_INFO,  __VA_ARGS__)
        #define LogDebug(...)     MDNS_LOG_DEFINITION(MDNS_LOG_DEBUG, __VA_ARGS__)
    #elif (MDNS_GNU_VA_ARGS)
        #define MDNS_LOG_DEFINITION(LEVEL, ARGS...) \
            <span class="enscript-keyword">do</span> { <span class="enscript-keyword">if</span> (mDNS_LoggingEnabled) LogMsgWithLevel(MDNS_LOG_CATEGORY_DEFAULT, LEVEL, ARGS); } <span class="enscript-keyword">while</span> (0)

        #define debug_noop(ARGS...)   <span class="enscript-keyword">do</span> {} <span class="enscript-keyword">while</span> (0)
        #define LogMsg(ARGS... )      LogMsgWithLevel(MDNS_LOG_CATEGORY_DEFAULT, MDNS_LOG_DEFAULT, ARGS)
        #define LogOperation(ARGS...) MDNS_LOG_DEFINITION(MDNS_LOG_INFO,  ARGS)
        #define LogSPS(ARGS...)       MDNS_LOG_DEFINITION(MDNS_LOG_INFO,  ARGS)
        #define LogInfo(ARGS...)      MDNS_LOG_DEFINITION(MDNS_LOG_INFO,  ARGS)
        #define LogDebug(ARGS...)     MDNS_LOG_DEFINITION(MDNS_LOG_DEBUG, ARGS)
    #<span class="enscript-keyword">else</span>
        #error <span class="enscript-string">&quot;Unknown variadic macros&quot;</span>
    #endif
#<span class="enscript-reference">else</span>
<span class="enscript-comment">// If your platform does not support variadic macros, you need to define the following variadic functions.
</span><span class="enscript-comment">// See mDNSShared/mDNSDebug.c for sample implementation
</span>    #define debug_noop 1 ? (<span class="enscript-type">void</span>)0 : (<span class="enscript-type">void</span>)
    #define LogMsg LogMsg_
    #define LogOperation (mDNS_LoggingEnabled == 0) ? ((<span class="enscript-type">void</span>)0) : LogOperation_
    #define LogSPS       (mDNS_LoggingEnabled == 0) ? ((<span class="enscript-type">void</span>)0) : LogSPS_
    #define LogInfo      (mDNS_LoggingEnabled == 0) ? ((<span class="enscript-type">void</span>)0) : LogInfo_
    #define LogDebug     (mDNS_LoggingEnabled == 0) ? ((<span class="enscript-type">void</span>)0) : LogDebug_
<span class="enscript-type">extern</span> <span class="enscript-type">void</span> <span class="enscript-function-name">LogMsg_</span>(<span class="enscript-type">const</span> <span class="enscript-type">char</span> *format, ...)       IS_A_PRINTF_STYLE_FUNCTION(1,2);
<span class="enscript-type">extern</span> <span class="enscript-type">void</span> <span class="enscript-function-name">LogOperation_</span>(<span class="enscript-type">const</span> <span class="enscript-type">char</span> *format, ...) IS_A_PRINTF_STYLE_FUNCTION(1,2);
<span class="enscript-type">extern</span> <span class="enscript-type">void</span> <span class="enscript-function-name">LogSPS_</span>(<span class="enscript-type">const</span> <span class="enscript-type">char</span> *format, ...)       IS_A_PRINTF_STYLE_FUNCTION(1,2);
<span class="enscript-type">extern</span> <span class="enscript-type">void</span> <span class="enscript-function-name">LogInfo_</span>(<span class="enscript-type">const</span> <span class="enscript-type">char</span> *format, ...)      IS_A_PRINTF_STYLE_FUNCTION(1,2);
<span class="enscript-type">extern</span> <span class="enscript-type">void</span> <span class="enscript-function-name">LogDebug_</span>(<span class="enscript-type">const</span> <span class="enscript-type">char</span> *format, ...)     IS_A_PRINTF_STYLE_FUNCTION(1,2);
#<span class="enscript-reference">endif</span>


#<span class="enscript-reference">if</span> <span class="enscript-variable-name">MDNS_DEBUGMSGS</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">debugf</span> debugf_
<span class="enscript-type">extern</span> <span class="enscript-type">void</span> <span class="enscript-function-name">debugf_</span>(<span class="enscript-type">const</span> <span class="enscript-type">char</span> *format, ...) IS_A_PRINTF_STYLE_FUNCTION(1,2);
#<span class="enscript-reference">else</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">debugf</span> debug_noop
#<span class="enscript-reference">endif</span>

#<span class="enscript-reference">if</span> <span class="enscript-variable-name">MDNS_DEBUGMSGS</span> &gt; 1
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">verbosedebugf</span> verbosedebugf_
<span class="enscript-type">extern</span> <span class="enscript-type">void</span> <span class="enscript-function-name">verbosedebugf_</span>(<span class="enscript-type">const</span> <span class="enscript-type">char</span> *format, ...) IS_A_PRINTF_STYLE_FUNCTION(1,2);
#<span class="enscript-reference">else</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">verbosedebugf</span> debug_noop
#<span class="enscript-reference">endif</span>

<span class="enscript-type">extern</span> <span class="enscript-type">int</span> mDNS_LoggingEnabled;
<span class="enscript-type">extern</span> <span class="enscript-type">int</span> mDNS_PacketLoggingEnabled;
<span class="enscript-type">extern</span> <span class="enscript-type">int</span> mDNS_McastLoggingEnabled;
<span class="enscript-type">extern</span> <span class="enscript-type">int</span> mDNS_McastTracingEnabled;
<span class="enscript-type">extern</span> <span class="enscript-type">int</span> mDNS_DebugMode;          <span class="enscript-comment">// If non-zero, LogMsg() writes to stderr instead of syslog
</span><span class="enscript-type">extern</span> <span class="enscript-type">const</span> <span class="enscript-type">char</span> ProgramName[];

<span class="enscript-type">extern</span> <span class="enscript-type">void</span> <span class="enscript-function-name">LogMsgWithLevel</span>(mDNSLogCategory_t category, mDNSLogLevel_t level, <span class="enscript-type">const</span> <span class="enscript-type">char</span> *format, ...) IS_A_PRINTF_STYLE_FUNCTION(3,4);
<span class="enscript-comment">// LogMsgNoIdent needs to be fixed so that it logs without the ident prefix like it used to
</span><span class="enscript-comment">// (or completely overhauled to use the new &quot;log to a separate file&quot; facility)
</span>#<span class="enscript-reference">define</span> <span class="enscript-variable-name">LogMsgNoIdent</span> LogMsg

#<span class="enscript-reference">if</span> <span class="enscript-variable-name">APPLE_OSX_mDNSResponder</span>
<span class="enscript-type">extern</span> <span class="enscript-type">void</span> <span class="enscript-function-name">LogFatalError</span>(<span class="enscript-type">const</span> <span class="enscript-type">char</span> *format, ...);
#<span class="enscript-reference">else</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">LogFatalError</span> LogMsg
#<span class="enscript-reference">endif</span>

#<span class="enscript-reference">if</span> <span class="enscript-variable-name">MDNS_MALLOC_DEBUGGING</span> &gt;= 1
<span class="enscript-type">extern</span> <span class="enscript-type">void</span> *<span class="enscript-function-name">mallocL</span>(<span class="enscript-type">const</span> <span class="enscript-type">char</span> *msg, mDNSu32 size);
<span class="enscript-type">extern</span> <span class="enscript-type">void</span> *<span class="enscript-function-name">callocL</span>(<span class="enscript-type">const</span> <span class="enscript-type">char</span> *msg, mDNSu32 size);
<span class="enscript-type">extern</span> <span class="enscript-type">void</span> <span class="enscript-function-name">freeL</span>(<span class="enscript-type">const</span> <span class="enscript-type">char</span> *msg, <span class="enscript-type">void</span> *x);
#<span class="enscript-reference">if</span> <span class="enscript-variable-name">APPLE_OSX_mDNSResponder</span>
<span class="enscript-type">extern</span> <span class="enscript-type">void</span> <span class="enscript-function-name">LogMemCorruption</span>(<span class="enscript-type">const</span> <span class="enscript-type">char</span> *format, ...);
#<span class="enscript-reference">else</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">LogMemCorruption</span> LogMsg
#<span class="enscript-reference">endif</span>
#<span class="enscript-reference">else</span>
#<span class="enscript-reference">define</span> <span class="enscript-function-name">mallocL</span>(MSG, SIZE) malloc(SIZE)
#<span class="enscript-reference">define</span> <span class="enscript-function-name">callocL</span>(MSG, SIZE) calloc(1, SIZE)
#<span class="enscript-reference">define</span> <span class="enscript-function-name">freeL</span>(MSG, PTR) free(PTR)
#<span class="enscript-reference">endif</span>

#<span class="enscript-reference">ifdef</span> <span class="enscript-variable-name">__cplusplus</span>
}
#<span class="enscript-reference">endif</span>

#<span class="enscript-reference">if</span> <span class="enscript-variable-name">MDNSRESPONDER_SUPPORTS</span>(<span class="enscript-variable-name">APPLE</span>, <span class="enscript-variable-name">OS_LOG</span>)
<span class="enscript-comment">/** @brief Write a log message to system's log storage(memory or disk).
 *
 *  On Apple platform, os_log() will be called to log a message.
 *
 *  @param CATEGORY         A custom log object previously created by the os_log_create function, and such an object is
 *                          used to specify &quot;subsystem&quot; and &quot;category&quot;. For mDNSResponder, the subsystem should always
 *                          be set to &quot;com.apple.mDNSResponder&quot;; and the category is used for categorization and
 *                          filtering of related log messages within the subsystem’s settings. We have 4 categories that
 *                          are pre-defined: MDNS_LOG_CATEGORY_DEFAULT, MDNS_LOG_CATEGORY_MDNS, MDNS_LOG_CATEGORY_UDNS,
 *                          MDNS_LOG_CATEGORY_SPS. If these categories are not enough, use os_log_create to create more.
 *
 *  @param LEVEL            The log level that determines the importance of the message. The levels are, in order of
 *                          decreasing importance:
 *                              MDNS_LOG_FAULT      Fault-level messages are intended for capturing system-level errors
 *                                                  that are critical to the system. They are always saved in the data store.
 *                              MDNS_LOG_ERROR      Error-level messages are intended for reporting process-level errors
 *                                                  that are unexpected and incorrect during the normal operation. They
 *                                                  are always saved in the data store.
 *                              MDNS_LOG_WARNING    Warning-level messages are intended for capturing unexpected and
 *                                                  possible incorrect behavior that might be used later to root cause
 *                                                  an error or fault. They are are initially stored in memory buffers
 *                                                  and then moved to a data store.
 *                              MDNS_LOG_DEFAULT    Default-level messages are intended for reporting things that might
 *                                                  result a failure. They are are initially stored in memory buffers
 *                                                  and then moved to a data store.
 *                              MDNS_LOG_INFO       Info-level messages are intended for capturing information that may
 *                                                  be helpful, but isn’t essential, for troubleshooting errors. They
 *                                                  are initially stored in memory buffers, but will only be moved into
 *                                                  data store when faults and, optionally, errors occur.
 *                              MDNS_LOG_DEBUG      Debug-level messages are intended for information that may be useful
 *                                                  during development or while troubleshooting a specific problem, Debug
 *                                                  logging should not be used in shipping software. They are only
 *                                                  captured in memory when debug logging is enabled through a
 *                                                  configuration change.
 *
 *  @param FORMAT           A constant string or format string that produces a human-readable log message. The format
 *                          string follows the IEEE printf specification, besides the following customized format specifiers:
 *                              %{mdnsresponder:domain_name}.*P     the pointer to a DNS lable sequence
 *                              %{mdnsresponder:ip_addr}.20P        the pointer to a mDNSAddr variable
 *                              %{network:in_addr}.4P               the pointer to a mDNSv4Addr variable
 *                              %{network:in6_addr}.16P             the pointer to a mDNSv6Addr variable
 *                              %{mdnsresponder:mac_addr}.6P        the pointer to a 6-byte-length MAC address
 *
 *  @param ...              The parameter list that will be formated by the format string. Note that if the customized
 *                          format specifiers are used and the data length is not specified in the format string, the
 *                          size should be listed before the pointer to the data, for example:
 *                              &quot;%{mdnsresponder:domain_name}.*P&quot;, (name ? (int)DomainNameLength((const domainname *)name) : 0), &lt;the pointer to a DNS label sequence&gt;
 *
 */</span>
    #define LogRedact(CATEGORY, LEVEL, FORMAT, ...) os_log_with_type(CATEGORY, LEVEL, FORMAT, ## __VA_ARGS__)
#<span class="enscript-reference">else</span>
    #<span class="enscript-keyword">if</span> (MDNS_HAS_VA_ARG_MACROS)
        #<span class="enscript-keyword">if</span> (MDNS_C99_VA_ARGS)
            #define LogRedact(CATEGORY, LEVEL, ...) \
                <span class="enscript-keyword">do</span> { <span class="enscript-keyword">if</span> (mDNS_LoggingEnabled) LogMsgWithLevel(CATEGORY, LEVEL, __VA_ARGS__); } <span class="enscript-keyword">while</span> (0)
        #elif (MDNS_GNU_VA_ARGS)
            #define LogRedact(CATEGORY, LEVEL, ARGS...) \
                <span class="enscript-keyword">do</span> { <span class="enscript-keyword">if</span> (mDNS_LoggingEnabled) LogMsgWithLevel(CATEGORY, LEVEL, ARGS); } <span class="enscript-keyword">while</span> (0)
        #<span class="enscript-keyword">else</span>
            #error <span class="enscript-string">&quot;Unknown variadic macros&quot;</span>
        #endif
    #<span class="enscript-keyword">else</span>
        #define LogRedact      (mDNS_LoggingEnabled == 0) ? ((<span class="enscript-type">void</span>)0) : LogRedact_
        <span class="enscript-type">extern</span> <span class="enscript-type">void</span> LogRedact_(<span class="enscript-type">const</span> <span class="enscript-type">char</span> *format, ...) IS_A_PRINTF_STYLE_FUNCTION(1,2);
    #endif
#<span class="enscript-reference">endif</span> // <span class="enscript-variable-name">MDNSRESPONDER_SUPPORTS</span>(<span class="enscript-variable-name">APPLE</span>, <span class="enscript-variable-name">OS_LOG</span>)

<span class="enscript-comment">// The followings are the customized log specifier defined in os_log. For compatibility, we have to define it when it is
</span><span class="enscript-comment">// not on the Apple platform, for example, the Posix platform. The keyword &quot;public&quot; or &quot;private&quot; is used to control whether
</span><span class="enscript-comment">// the content would be redacted when the redaction is turned on: &quot;public&quot; means the content will always be printed;
</span><span class="enscript-comment">// &quot;private&quot; means the content will be printed as &lt;private&gt; if the redaction is turned on, only when the redaction is
</span><span class="enscript-comment">// turned off, the content will be printed as what it should be.
</span>
#<span class="enscript-reference">if</span> <span class="enscript-variable-name">MDNSRESPONDER_SUPPORTS</span>(<span class="enscript-variable-name">APPLE</span>, <span class="enscript-variable-name">OS_LOG</span>)
    #define PUB_S <span class="enscript-string">&quot;%{public}s&quot;</span>
    #define PRI_S <span class="enscript-string">&quot;%{private}s&quot;</span>
#<span class="enscript-reference">else</span>
    #define PUB_S <span class="enscript-string">&quot;%s&quot;</span>
    #define PRI_S PUB_S
#<span class="enscript-reference">endif</span>

#<span class="enscript-reference">if</span> <span class="enscript-variable-name">MDNSRESPONDER_SUPPORTS</span>(<span class="enscript-variable-name">APPLE</span>, <span class="enscript-variable-name">OS_LOG</span>)
    #define PUB_DM_NAME <span class="enscript-string">&quot;%{public, mdnsresponder:domain_name}.*P&quot;</span>
    #define PRI_DM_NAME <span class="enscript-string">&quot;%{private, mdnsresponder:domain_name}.*P&quot;</span>
    <span class="enscript-comment">// When DM_NAME_PARAM is used, the file where the function is defined must include DNSEmbeddedAPI.h
</span>    #define DM_NAME_PARAM(name) ((name) ? ((<span class="enscript-type">int</span>)DomainNameLength((<span class="enscript-type">const</span> domainname *)(name))) : 0), (name)
#<span class="enscript-reference">else</span>
    #define PUB_DM_NAME <span class="enscript-string">&quot;%##s&quot;</span>
    #define PRI_DM_NAME PUB_DM_NAME
    #define DM_NAME_PARAM(name) (name)
#<span class="enscript-reference">endif</span>

#<span class="enscript-reference">if</span> <span class="enscript-variable-name">MDNSRESPONDER_SUPPORTS</span>(<span class="enscript-variable-name">APPLE</span>, <span class="enscript-variable-name">OS_LOG</span>)
    #define PUB_IP_ADDR <span class="enscript-string">&quot;%{public, mdnsresponder:ip_addr}.20P&quot;</span>
    #define PRI_IP_ADDR <span class="enscript-string">&quot;%{private, mdnsresponder:ip_addr}.20P&quot;</span>

    #define PUB_IPv4_ADDR <span class="enscript-string">&quot;%{public, network:in_addr}.4P&quot;</span>
    #define PRI_IPv4_ADDR <span class="enscript-string">&quot;%{private, network:in_addr}.4P&quot;</span>

    #define PUB_IPv6_ADDR <span class="enscript-string">&quot;%{public, network:in6_addr}.16P&quot;</span>
    #define PRI_IPv6_ADDR <span class="enscript-string">&quot;%{private, network:in6_addr}.16P&quot;</span>
#<span class="enscript-reference">else</span>
    #define PUB_IP_ADDR <span class="enscript-string">&quot;%#a&quot;</span>
    #define PRI_IP_ADDR PUB_IP_ADDR

    #define PUB_IPv4_ADDR <span class="enscript-string">&quot;%.4a&quot;</span>
    #define PRI_IPv4_ADDR PUB_IPv4_ADDR

    #define PUB_IPv6_ADDR <span class="enscript-string">&quot;%.16a&quot;</span>
    #define PRI_IPv6_ADDR PUB_IPv6_ADDR
#<span class="enscript-reference">endif</span>

#<span class="enscript-reference">if</span> <span class="enscript-variable-name">MDNSRESPONDER_SUPPORTS</span>(<span class="enscript-variable-name">APPLE</span>, <span class="enscript-variable-name">OS_LOG</span>)
    #define PUB_MAC_ADDR <span class="enscript-string">&quot;%{public, mdnsresponder:mac_addr}.6P&quot;</span>
    #define PRI_MAC_ADDR <span class="enscript-string">&quot;%{private, mdnsresponder:mac_addr}.6P&quot;</span>
#<span class="enscript-reference">else</span>
    #define PUB_MAC_ADDR <span class="enscript-string">&quot;%.6a&quot;</span>
    #define PRI_MAC_ADDR PUB_MAC_ADDR
#<span class="enscript-reference">endif</span>

<span class="enscript-type">extern</span> <span class="enscript-type">void</span> <span class="enscript-function-name">LogToFD</span>(<span class="enscript-type">int</span> fd, <span class="enscript-type">const</span> <span class="enscript-type">char</span> *format, ...);

#<span class="enscript-reference">endif</span> // <span class="enscript-variable-name">__mDNSDebug_h</span>
</pre>
<hr />
</body></html>