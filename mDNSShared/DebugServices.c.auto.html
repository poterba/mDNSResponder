<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<title>DebugServices.c</title>
<style type="text/css">
.enscript-comment { font-style: italic; color: rgb(178,34,34); }
.enscript-function-name { font-weight: bold; color: rgb(0,0,255); }
.enscript-variable-name { font-weight: bold; color: rgb(184,134,11); }
.enscript-keyword { font-weight: bold; color: rgb(160,32,240); }
.enscript-reference { font-weight: bold; color: rgb(95,158,160); }
.enscript-string { font-weight: bold; color: rgb(188,143,143); }
.enscript-builtin { font-weight: bold; color: rgb(218,112,214); }
.enscript-type { font-weight: bold; color: rgb(34,139,34); }
.enscript-highlight { text-decoration: underline; color: 0; }
</style>
</head>
<body id="top">
<h1 style="margin:8px;" id="f1">DebugServices.c&nbsp;&nbsp;&nbsp;<span style="font-weight: normal; font-size: 0.5em;">[<a href="DebugServices.c">plain text</a>]</span></h1>
<hr/>
<div></div>
<pre>
<span class="enscript-comment">/* -*- Mode: C; tab-width: 4 -*-
 *
 * Copyright (c) 1997-2004 Apple Computer, Inc. All rights reserved.
 *
 * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     <a href="http://www.apache.org/licenses/LICENSE-2.0">http://www.apache.org/licenses/LICENSE-2.0</a>
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.

    To Do:

    - Use StackWalk on Windows to optionally print stack frames.
 */</span>

#<span class="enscript-reference">if</span> 0
#<span class="enscript-reference">pragma</span> <span class="enscript-variable-name">mark</span> == <span class="enscript-variable-name">Includes</span> ==
#<span class="enscript-reference">endif</span>

<span class="enscript-comment">//===========================================================================================================================
</span><span class="enscript-comment">//	Includes
</span><span class="enscript-comment">//===========================================================================================================================
</span>
#<span class="enscript-reference">if</span> ( !<span class="enscript-variable-name">KERNEL</span> )
    #include    &lt;ctype.h&gt;
    #include    &lt;stdio.h&gt;
    #include    &lt;string.h&gt;
#<span class="enscript-reference">endif</span>

#<span class="enscript-reference">include</span>    <span class="enscript-string">&quot;CommonServices.h&quot;</span>

#<span class="enscript-reference">include</span>    <span class="enscript-string">&quot;DebugServices.h&quot;</span>

#<span class="enscript-reference">if</span> ( <span class="enscript-variable-name">DEBUG</span> )

#<span class="enscript-reference">if</span> ( <span class="enscript-variable-name">TARGET_OS_WIN32</span> )
    #include    &lt;time.h&gt;

    #<span class="enscript-keyword">if</span> ( !TARGET_OS_WINDOWS_CE )
        #include    &lt;fcntl.h&gt;
        #include    &lt;io.h&gt;
    #endif
#<span class="enscript-reference">endif</span>

#<span class="enscript-reference">if</span> ( <span class="enscript-variable-name">DEBUG_IDEBUG_ENABLED</span> &amp;&amp; <span class="enscript-variable-name">TARGET_API_MAC_OSX_KERNEL</span> )
    #include    &lt;IOKit/IOLib.h&gt;
#<span class="enscript-reference">endif</span>

<span class="enscript-comment">// If MDNS_DEBUGMSGS is defined (even if defined 0), it is aware of mDNS and it is probably safe to include mDNSEmbeddedAPI.h.
</span>
#<span class="enscript-reference">if</span> ( <span class="enscript-reference">defined</span>(<span class="enscript-variable-name"> MDNS_DEBUGMSGS </span>) )
    #include    <span class="enscript-string">&quot;mDNSEmbeddedAPI.h&quot;</span>
#<span class="enscript-reference">endif</span>

#<span class="enscript-reference">if</span> 0
#<span class="enscript-reference">pragma</span> <span class="enscript-variable-name">mark</span> == <span class="enscript-variable-name">Macros</span> ==
#<span class="enscript-reference">endif</span>

<span class="enscript-comment">//===========================================================================================================================
</span><span class="enscript-comment">//	Macros
</span><span class="enscript-comment">//===========================================================================================================================
</span>
#<span class="enscript-reference">define</span> <span class="enscript-function-name">DebugIsPrint</span>( C )       ( ( ( C ) &gt;= 0x20 ) &amp;&amp; ( ( C ) &lt;= 0x7E ) )

#<span class="enscript-reference">if</span> 0
#<span class="enscript-reference">pragma</span> <span class="enscript-variable-name">mark</span> == <span class="enscript-variable-name">Prototypes</span> ==
#<span class="enscript-reference">endif</span>

<span class="enscript-comment">//===========================================================================================================================
</span><span class="enscript-comment">//	Prototypes
</span><span class="enscript-comment">//===========================================================================================================================
</span>
<span class="enscript-type">static</span> OSStatus <span class="enscript-function-name">DebugPrint</span>( DebugLevel inLevel, <span class="enscript-type">char</span> *inData, size_t inSize );

<span class="enscript-comment">// fprintf
</span>
#<span class="enscript-reference">if</span> ( <span class="enscript-variable-name">DEBUG_FPRINTF_ENABLED</span> )
<span class="enscript-type">static</span> OSStatus <span class="enscript-function-name">DebugFPrintFInit</span>( DebugOutputTypeFlags inFlags, <span class="enscript-type">const</span> <span class="enscript-type">char</span> *inFilename );
<span class="enscript-type">static</span> <span class="enscript-type">void</span>     <span class="enscript-function-name">DebugFPrintFPrint</span>( <span class="enscript-type">char</span> *inData, size_t inSize );
#<span class="enscript-reference">endif</span>

<span class="enscript-comment">// iDebug (Mac OS X user and kernel)
</span>
#<span class="enscript-reference">if</span> ( <span class="enscript-variable-name">DEBUG_IDEBUG_ENABLED</span> )
<span class="enscript-type">static</span> OSStatus <span class="enscript-function-name">DebugiDebugInit</span>( <span class="enscript-type">void</span> );
<span class="enscript-type">static</span> <span class="enscript-type">void</span>     <span class="enscript-function-name">DebugiDebugPrint</span>( <span class="enscript-type">char</span> *inData, size_t inSize );
#<span class="enscript-reference">endif</span>

<span class="enscript-comment">// kprintf (Mac OS X Kernel)
</span>
#<span class="enscript-reference">if</span> ( <span class="enscript-variable-name">DEBUG_KPRINTF_ENABLED</span> )
<span class="enscript-type">static</span> <span class="enscript-type">void</span> <span class="enscript-function-name">DebugKPrintFPrint</span>( <span class="enscript-type">char</span> *inData, size_t inSize );
#<span class="enscript-reference">endif</span>

<span class="enscript-comment">// Mac OS X IOLog (Mac OS X Kernel)
</span>
#<span class="enscript-reference">if</span> ( <span class="enscript-variable-name">DEBUG_MAC_OS_X_IOLOG_ENABLED</span> )
<span class="enscript-type">static</span> <span class="enscript-type">void</span> <span class="enscript-function-name">DebugMacOSXIOLogPrint</span>( <span class="enscript-type">char</span> *inData, size_t inSize );
#<span class="enscript-reference">endif</span>

<span class="enscript-comment">// Mac OS X Log
</span>
#<span class="enscript-reference">if</span> ( <span class="enscript-variable-name">TARGET_OS_MAC</span> )
<span class="enscript-type">static</span> OSStatus <span class="enscript-function-name">DebugMacOSXLogInit</span>( <span class="enscript-type">void</span> );
<span class="enscript-type">static</span> <span class="enscript-type">void</span>     <span class="enscript-function-name">DebugMacOSXLogPrint</span>( <span class="enscript-type">char</span> *inData, size_t inSize );
#<span class="enscript-reference">endif</span>

<span class="enscript-comment">// Windows Debugger
</span>
#<span class="enscript-reference">if</span> ( <span class="enscript-variable-name">TARGET_OS_WIN32</span> )
<span class="enscript-type">static</span> <span class="enscript-type">void</span> <span class="enscript-function-name">DebugWindowsDebuggerPrint</span>( <span class="enscript-type">char</span> *inData, size_t inSize );
#<span class="enscript-reference">endif</span>

<span class="enscript-comment">// Windows Event Log
</span>
#<span class="enscript-reference">if</span> ( <span class="enscript-variable-name">TARGET_OS_WIN32</span> &amp;&amp; !<span class="enscript-variable-name">TARGET_OS_WINDOWS_CE</span> )
<span class="enscript-type">static</span> OSStatus <span class="enscript-function-name">DebugWindowsEventLogInit</span>( <span class="enscript-type">const</span> <span class="enscript-type">char</span> *inName, HMODULE inModule );
<span class="enscript-type">static</span> <span class="enscript-type">void</span> <span class="enscript-function-name">DebugWindowsEventLogPrint</span>( DebugLevel inLevel, <span class="enscript-type">char</span> *inData, size_t inSize );
#<span class="enscript-reference">endif</span>

<span class="enscript-comment">// DebugLib support
</span>
#<span class="enscript-reference">if</span> ( <span class="enscript-variable-name">DEBUG_CORE_SERVICE_ASSERTS_ENABLED</span> )
<span class="enscript-type">static</span> pascal <span class="enscript-type">void</span>
<span class="enscript-function-name">DebugAssertOutputHandler</span>(
    OSType inComponentSignature,
    UInt32 inOptions,
    <span class="enscript-type">const</span> <span class="enscript-type">char</span> *        inAssertionString,
    <span class="enscript-type">const</span> <span class="enscript-type">char</span> *        inExceptionString,
    <span class="enscript-type">const</span> <span class="enscript-type">char</span> *        inErrorString,
    <span class="enscript-type">const</span> <span class="enscript-type">char</span> *        inFileName,
    <span class="enscript-type">long</span> inLineNumber,
    <span class="enscript-type">void</span> *              inValue,
    ConstStr255Param inOutputMsg );
#<span class="enscript-reference">endif</span>

<span class="enscript-comment">// Utilities
</span>
<span class="enscript-type">static</span> <span class="enscript-type">char</span> *   <span class="enscript-function-name">DebugNumVersionToString</span>( uint32_t inVersion, <span class="enscript-type">char</span> *inString );

#<span class="enscript-reference">if</span> ( <span class="enscript-variable-name">TARGET_OS_WIN32</span> &amp;&amp; !<span class="enscript-variable-name">TARGET_OS_WINDOWS_CE</span> )
<span class="enscript-type">static</span> <span class="enscript-type">void</span> <span class="enscript-function-name">DebugWinEnableConsole</span>( <span class="enscript-type">void</span> );
#<span class="enscript-reference">endif</span>

#<span class="enscript-reference">if</span> ( <span class="enscript-variable-name">TARGET_OS_WIN32</span> )
<span class="enscript-type">static</span> TCHAR *
<span class="enscript-function-name">DebugWinCharToTCharString</span>(
    <span class="enscript-type">const</span> <span class="enscript-type">char</span> *    inCharString,
    size_t inCharCount,
    TCHAR *         outTCharString,
    size_t inTCharCountMax,
    size_t *        outTCharCount );
#<span class="enscript-reference">endif</span>

#<span class="enscript-reference">if</span> 0
#<span class="enscript-reference">pragma</span> <span class="enscript-variable-name">mark</span> == <span class="enscript-variable-name">Globals</span> ==
#<span class="enscript-reference">endif</span>

<span class="enscript-comment">//===========================================================================================================================
</span><span class="enscript-comment">//	Private Globals
</span><span class="enscript-comment">//===========================================================================================================================
</span>
<span class="enscript-comment">// General
</span>
<span class="enscript-type">static</span> bool gDebugInitialized               = false;
<span class="enscript-type">static</span> DebugOutputType gDebugOutputType                = kDebugOutputTypeNone;
<span class="enscript-type">static</span> DebugLevel gDebugPrintLevelMin             = kDebugLevelInfo;
<span class="enscript-type">static</span> DebugLevel gDebugPrintLevelMax             = kDebugLevelMax;
<span class="enscript-type">static</span> DebugLevel gDebugBreakLevel                = kDebugLevelAssert;
#<span class="enscript-reference">if</span> ( <span class="enscript-variable-name">DEBUG_CORE_SERVICE_ASSERTS_ENABLED</span> )
<span class="enscript-type">static</span> DebugAssertOutputHandlerUPP gDebugAssertOutputHandlerUPP    = NULL;
#<span class="enscript-reference">endif</span>

<span class="enscript-comment">// Custom
</span>
<span class="enscript-type">static</span> DebugOutputFunctionPtr gDebugCustomOutputFunction      = NULL;
<span class="enscript-type">static</span> <span class="enscript-type">void</span> *                               gDebugCustomOutputContext       = NULL;

<span class="enscript-comment">// fprintf
</span>
#<span class="enscript-reference">if</span> ( <span class="enscript-variable-name">DEBUG_FPRINTF_ENABLED</span> )
<span class="enscript-type">static</span> FILE *                           gDebugFPrintFFile               = NULL;
#<span class="enscript-reference">endif</span>

<span class="enscript-comment">// MacOSXLog
</span>
#<span class="enscript-reference">if</span> ( <span class="enscript-variable-name">TARGET_OS_MAC</span> )
<span class="enscript-type">typedef</span> <span class="enscript-function-name">int</span> ( *DebugMacOSXLogFunctionPtr )( <span class="enscript-type">const</span> <span class="enscript-type">char</span> *inFormat, ... );

<span class="enscript-type">static</span> DebugMacOSXLogFunctionPtr gDebugMacOSXLogFunction         = NULL;
#<span class="enscript-reference">endif</span>

<span class="enscript-comment">// WindowsEventLog
</span>

#<span class="enscript-reference">if</span> ( <span class="enscript-variable-name">TARGET_OS_WIN32</span> &amp;&amp; !<span class="enscript-variable-name">TARGET_OS_WINDOWS_CE</span> )
<span class="enscript-type">static</span> HANDLE gDebugWindowsEventLogEventSource = NULL;
#<span class="enscript-reference">endif</span>

#<span class="enscript-reference">if</span> 0
#<span class="enscript-reference">pragma</span> <span class="enscript-variable-name">mark</span> -
#<span class="enscript-reference">pragma</span> <span class="enscript-variable-name">mark</span> == <span class="enscript-variable-name">General</span> ==
#<span class="enscript-reference">endif</span>

<span class="enscript-comment">//===========================================================================================================================
</span><span class="enscript-comment">//	DebugInitialize
</span><span class="enscript-comment">//===========================================================================================================================
</span>
DEBUG_EXPORT OSStatus   <span class="enscript-function-name">DebugInitialize</span>( DebugOutputType inType, ... )
{
    OSStatus err;
    DebugOutputType type;
    va_list args;

    va_start( args, inType );

    <span class="enscript-comment">// Set up DebugLib stuff (if building with Debugging.h).
</span>
#<span class="enscript-reference">if</span> ( <span class="enscript-variable-name">DEBUG_CORE_SERVICE_ASSERTS_ENABLED</span> )
    <span class="enscript-keyword">if</span>( !gDebugAssertOutputHandlerUPP )
    {
        gDebugAssertOutputHandlerUPP = NewDebugAssertOutputHandlerUPP( DebugAssertOutputHandler );
        check( gDebugAssertOutputHandlerUPP );
        <span class="enscript-keyword">if</span>( gDebugAssertOutputHandlerUPP )
        {
            InstallDebugAssertOutputHandler( gDebugAssertOutputHandlerUPP );
        }
    }
#<span class="enscript-reference">endif</span>

    <span class="enscript-comment">// Pre-process meta-output kind to pick an appropriate output kind for the platform.
</span>
    type = inType;
    <span class="enscript-keyword">if</span>( type == kDebugOutputTypeMetaConsole )
    {
        #<span class="enscript-keyword">if</span> ( TARGET_OS_MAC )
        type = kDebugOutputTypeMacOSXLog;
        #elif ( TARGET_OS_WIN32 &amp;&amp; !TARGET_OS_WINDOWS_CE )
            #<span class="enscript-keyword">if</span> ( DEBUG_FPRINTF_ENABLED )
        type = kDebugOutputTypeFPrintF;
            #<span class="enscript-keyword">else</span>
        type = kDebugOutputTypeWindowsDebugger;
            #endif
        #elif ( TARGET_API_MAC_OSX_KERNEL )
            #<span class="enscript-keyword">if</span> ( DEBUG_MAC_OS_X_IOLOG_ENABLED )
        type = kDebugOutputTypeMacOSXIOLog;
            #elif ( DEBUG_IDEBUG_ENABLED )
        type = kDebugOutputTypeiDebug;
            #elif ( DEBUG_KPRINTF_ENABLED )
        type = kDebugOutputTypeKPrintF;
            #endif
        #<span class="enscript-keyword">else</span>
            #<span class="enscript-keyword">if</span> ( DEBUG_FPRINTF_ENABLED )
        type = kDebugOutputTypeFPrintF;
            #endif
        #endif
    }

    <span class="enscript-comment">// Process output kind.
</span>
    gDebugOutputType = type;
    <span class="enscript-keyword">switch</span>( type )
    {
    <span class="enscript-keyword">case</span> <span class="enscript-reference">kDebugOutputTypeNone</span>:
        err = kNoErr;
        <span class="enscript-keyword">break</span>;

    <span class="enscript-keyword">case</span> <span class="enscript-reference">kDebugOutputTypeCustom</span>:
        gDebugCustomOutputFunction = va_arg( args, DebugOutputFunctionPtr );
        gDebugCustomOutputContext  = va_arg( args, <span class="enscript-type">void</span> * );
        err = kNoErr;
        <span class="enscript-keyword">break</span>;

#<span class="enscript-reference">if</span> ( <span class="enscript-variable-name">DEBUG_FPRINTF_ENABLED</span> )
    <span class="enscript-keyword">case</span> <span class="enscript-reference">kDebugOutputTypeFPrintF</span>:
        <span class="enscript-keyword">if</span>( inType == kDebugOutputTypeMetaConsole )
        {
            err = DebugFPrintFInit( kDebugOutputTypeFlagsStdErr, NULL );
        }
        <span class="enscript-keyword">else</span>
        {
            DebugOutputTypeFlags flags;
            <span class="enscript-type">const</span> <span class="enscript-type">char</span> *                filename;

            flags = (DebugOutputTypeFlags) va_arg( args, <span class="enscript-type">unsigned</span> <span class="enscript-type">int</span> );
            <span class="enscript-keyword">if</span>( ( flags &amp; kDebugOutputTypeFlagsTypeMask ) == kDebugOutputTypeFlagsFile )
            {
                filename = va_arg( args, <span class="enscript-type">const</span> <span class="enscript-type">char</span> * );
            }
            <span class="enscript-keyword">else</span>
            {
                filename = NULL;
            }
            err = DebugFPrintFInit( flags, filename );
        }
        <span class="enscript-keyword">break</span>;
#<span class="enscript-reference">endif</span>

#<span class="enscript-reference">if</span> ( <span class="enscript-variable-name">DEBUG_IDEBUG_ENABLED</span> )
    <span class="enscript-keyword">case</span> <span class="enscript-reference">kDebugOutputTypeiDebug</span>:
        err = DebugiDebugInit();
        <span class="enscript-keyword">break</span>;
#<span class="enscript-reference">endif</span>

#<span class="enscript-reference">if</span> ( <span class="enscript-variable-name">DEBUG_KPRINTF_ENABLED</span> )
    <span class="enscript-keyword">case</span> <span class="enscript-reference">kDebugOutputTypeKPrintF</span>:
        err = kNoErr;
        <span class="enscript-keyword">break</span>;
#<span class="enscript-reference">endif</span>

#<span class="enscript-reference">if</span> ( <span class="enscript-variable-name">DEBUG_MAC_OS_X_IOLOG_ENABLED</span> )
    <span class="enscript-keyword">case</span> <span class="enscript-reference">kDebugOutputTypeMacOSXIOLog</span>:
        err = kNoErr;
        <span class="enscript-keyword">break</span>;
#<span class="enscript-reference">endif</span>

#<span class="enscript-reference">if</span> ( <span class="enscript-variable-name">TARGET_OS_MAC</span> )
    <span class="enscript-keyword">case</span> <span class="enscript-reference">kDebugOutputTypeMacOSXLog</span>:
        err = DebugMacOSXLogInit();
        <span class="enscript-keyword">break</span>;
#<span class="enscript-reference">endif</span>

#<span class="enscript-reference">if</span> ( <span class="enscript-variable-name">TARGET_OS_WIN32</span> )
    <span class="enscript-keyword">case</span> <span class="enscript-reference">kDebugOutputTypeWindowsDebugger</span>:
        err = kNoErr;
        <span class="enscript-keyword">break</span>;
#<span class="enscript-reference">endif</span>

#<span class="enscript-reference">if</span> ( <span class="enscript-variable-name">TARGET_OS_WIN32</span> &amp;&amp; !<span class="enscript-variable-name">TARGET_OS_WINDOWS_CE</span> )
    <span class="enscript-keyword">case</span> <span class="enscript-reference">kDebugOutputTypeWindowsEventLog</span>:
    {
        <span class="enscript-type">const</span> <span class="enscript-type">char</span> *        name;
        HMODULE module;

        name   = va_arg( args, <span class="enscript-type">const</span> <span class="enscript-type">char</span> * );
        module = va_arg( args, HMODULE );
        err = DebugWindowsEventLogInit( name, module );
    }
    <span class="enscript-keyword">break</span>;
#<span class="enscript-reference">endif</span>

    <span class="enscript-reference">default</span>:
        err = kParamErr;
        <span class="enscript-keyword">goto</span> <span class="enscript-reference">exit</span>;
    }
    gDebugInitialized = true;

<span class="enscript-reference">exit</span>:
    va_end( args );
    <span class="enscript-keyword">return</span>( err );
}

<span class="enscript-comment">//===========================================================================================================================
</span><span class="enscript-comment">//	DebugFinalize
</span><span class="enscript-comment">//===========================================================================================================================
</span>
DEBUG_EXPORT <span class="enscript-type">void</span>       <span class="enscript-function-name">DebugFinalize</span>( <span class="enscript-type">void</span> )
{
#<span class="enscript-reference">if</span> ( <span class="enscript-variable-name">DEBUG_CORE_SERVICE_ASSERTS_ENABLED</span> )
    check( gDebugAssertOutputHandlerUPP );
    <span class="enscript-keyword">if</span>( gDebugAssertOutputHandlerUPP )
    {
        InstallDebugAssertOutputHandler( NULL );
        DisposeDebugAssertOutputHandlerUPP( gDebugAssertOutputHandlerUPP );
        gDebugAssertOutputHandlerUPP = NULL;
    }
#<span class="enscript-reference">endif</span>
}

<span class="enscript-comment">//===========================================================================================================================
</span><span class="enscript-comment">//	DebugGetProperty
</span><span class="enscript-comment">//===========================================================================================================================
</span>
DEBUG_EXPORT OSStatus   <span class="enscript-function-name">DebugGetProperty</span>( DebugPropertyTag inTag, ... )
{
    OSStatus err;
    va_list args;
    DebugLevel *        level;

    va_start( args, inTag );
    <span class="enscript-keyword">switch</span>( inTag )
    {
    <span class="enscript-keyword">case</span> <span class="enscript-reference">kDebugPropertyTagPrintLevelMin</span>:
        level  = va_arg( args, DebugLevel * );
        *level = gDebugPrintLevelMin;
        err = kNoErr;
        <span class="enscript-keyword">break</span>;

    <span class="enscript-keyword">case</span> <span class="enscript-reference">kDebugPropertyTagPrintLevelMax</span>:
        level  = va_arg( args, DebugLevel * );
        *level = gDebugPrintLevelMax;
        err = kNoErr;
        <span class="enscript-keyword">break</span>;

    <span class="enscript-keyword">case</span> <span class="enscript-reference">kDebugPropertyTagBreakLevel</span>:
        level  = va_arg( args, DebugLevel * );
        *level = gDebugBreakLevel;
        err = kNoErr;
        <span class="enscript-keyword">break</span>;

    <span class="enscript-reference">default</span>:
        err = kUnsupportedErr;
        <span class="enscript-keyword">break</span>;
    }
    va_end( args );
    <span class="enscript-keyword">return</span>( err );
}

<span class="enscript-comment">//===========================================================================================================================
</span><span class="enscript-comment">//	DebugSetProperty
</span><span class="enscript-comment">//===========================================================================================================================
</span>
DEBUG_EXPORT OSStatus   <span class="enscript-function-name">DebugSetProperty</span>( DebugPropertyTag inTag, ... )
{
    OSStatus err;
    va_list args;
    DebugLevel level;

    va_start( args, inTag );
    <span class="enscript-keyword">switch</span>( inTag )
    {
    <span class="enscript-keyword">case</span> <span class="enscript-reference">kDebugPropertyTagPrintLevelMin</span>:
        level  = va_arg( args, DebugLevel );
        gDebugPrintLevelMin = level;
        err = kNoErr;
        <span class="enscript-keyword">break</span>;

    <span class="enscript-keyword">case</span> <span class="enscript-reference">kDebugPropertyTagPrintLevelMax</span>:
        level  = va_arg( args, DebugLevel );
        gDebugPrintLevelMax = level;
        err = kNoErr;
        <span class="enscript-keyword">break</span>;

    <span class="enscript-keyword">case</span> <span class="enscript-reference">kDebugPropertyTagBreakLevel</span>:
        level  = va_arg( args, DebugLevel );
        gDebugBreakLevel = level;
        err = kNoErr;
        <span class="enscript-keyword">break</span>;

    <span class="enscript-reference">default</span>:
        err = kUnsupportedErr;
        <span class="enscript-keyword">break</span>;
    }
    va_end( args );
    <span class="enscript-keyword">return</span>( err );
}

#<span class="enscript-reference">if</span> 0
#<span class="enscript-reference">pragma</span> <span class="enscript-variable-name">mark</span> -
#<span class="enscript-reference">pragma</span> <span class="enscript-variable-name">mark</span> == <span class="enscript-variable-name">Output</span> ==
#<span class="enscript-reference">endif</span>

<span class="enscript-comment">//===========================================================================================================================
</span><span class="enscript-comment">//	DebugPrintF
</span><span class="enscript-comment">//===========================================================================================================================
</span>
DEBUG_EXPORT size_t <span class="enscript-function-name">DebugPrintF</span>( DebugLevel inLevel, <span class="enscript-type">const</span> <span class="enscript-type">char</span> *inFormat, ... )
{
    va_list args;
    size_t n;

    <span class="enscript-comment">// Skip if the level is not in the enabled range..
</span>
    <span class="enscript-keyword">if</span>( ( inLevel &lt; gDebugPrintLevelMin ) || ( inLevel &gt; gDebugPrintLevelMax ) )
    {
        n = 0;
        <span class="enscript-keyword">goto</span> <span class="enscript-reference">exit</span>;
    }

    va_start( args, inFormat );
    n = DebugPrintFVAList( inLevel, inFormat, args );
    va_end( args );

<span class="enscript-reference">exit</span>:
    <span class="enscript-keyword">return</span>( n );
}

<span class="enscript-comment">//===========================================================================================================================
</span><span class="enscript-comment">//	DebugPrintFVAList
</span><span class="enscript-comment">//===========================================================================================================================
</span>
DEBUG_EXPORT size_t <span class="enscript-function-name">DebugPrintFVAList</span>( DebugLevel inLevel, <span class="enscript-type">const</span> <span class="enscript-type">char</span> *inFormat, va_list inArgs )
{
    size_t n;
    <span class="enscript-type">char</span> buffer[ 512 ];

    <span class="enscript-comment">// Skip if the level is not in the enabled range..
</span>
    <span class="enscript-keyword">if</span>( ( inLevel &lt; gDebugPrintLevelMin ) || ( inLevel &gt; gDebugPrintLevelMax ) )
    {
        n = 0;
        <span class="enscript-keyword">goto</span> <span class="enscript-reference">exit</span>;
    }

    n = DebugSNPrintFVAList( buffer, <span class="enscript-keyword">sizeof</span>( buffer ), inFormat, inArgs );
    DebugPrint( inLevel, buffer, (size_t) n );

<span class="enscript-reference">exit</span>:
    <span class="enscript-keyword">return</span>( n );
}

<span class="enscript-comment">//===========================================================================================================================
</span><span class="enscript-comment">//	DebugPrint
</span><span class="enscript-comment">//===========================================================================================================================
</span>
<span class="enscript-type">static</span> OSStatus <span class="enscript-function-name">DebugPrint</span>( DebugLevel inLevel, <span class="enscript-type">char</span> *inData, size_t inSize )
{
    OSStatus err;

    <span class="enscript-comment">// Skip if the level is not in the enabled range..
</span>
    <span class="enscript-keyword">if</span>( ( inLevel &lt; gDebugPrintLevelMin ) || ( inLevel &gt; gDebugPrintLevelMax ) )
    {
        err = kRangeErr;
        <span class="enscript-keyword">goto</span> <span class="enscript-reference">exit</span>;
    }

    <span class="enscript-comment">// Printing is not safe at interrupt time so check for this and warn with an interrupt safe mechanism (if available).
</span>
    <span class="enscript-keyword">if</span>( DebugTaskLevel() &amp; kDebugInterruptLevelMask )
    {
        err = kExecutionStateErr;
        <span class="enscript-keyword">goto</span> <span class="enscript-reference">exit</span>;
    }

    <span class="enscript-comment">// Initialize the debugging library if it hasn't already been initialized (allows for zero-config usage).
</span>
    <span class="enscript-keyword">if</span>( !gDebugInitialized )
    {
        debug_initialize( kDebugOutputTypeMetaConsole );
    }

    <span class="enscript-comment">// Print based on the current output type.
</span>
    <span class="enscript-keyword">switch</span>( gDebugOutputType )
    {
    <span class="enscript-keyword">case</span> <span class="enscript-reference">kDebugOutputTypeNone</span>:
        <span class="enscript-keyword">break</span>;

    <span class="enscript-keyword">case</span> <span class="enscript-reference">kDebugOutputTypeCustom</span>:
        <span class="enscript-keyword">if</span>( gDebugCustomOutputFunction )
        {
            gDebugCustomOutputFunction( inData, inSize, gDebugCustomOutputContext );
        }
        <span class="enscript-keyword">break</span>;

#<span class="enscript-reference">if</span> ( <span class="enscript-variable-name">DEBUG_FPRINTF_ENABLED</span> )
    <span class="enscript-keyword">case</span> <span class="enscript-reference">kDebugOutputTypeFPrintF</span>:
        DebugFPrintFPrint( inData, inSize );
        <span class="enscript-keyword">break</span>;
#<span class="enscript-reference">endif</span>

#<span class="enscript-reference">if</span> ( <span class="enscript-variable-name">DEBUG_IDEBUG_ENABLED</span> )
    <span class="enscript-keyword">case</span> <span class="enscript-reference">kDebugOutputTypeiDebug</span>:
        DebugiDebugPrint( inData, inSize );
        <span class="enscript-keyword">break</span>;
#<span class="enscript-reference">endif</span>

#<span class="enscript-reference">if</span> ( <span class="enscript-variable-name">DEBUG_KPRINTF_ENABLED</span> )
    <span class="enscript-keyword">case</span> <span class="enscript-reference">kDebugOutputTypeKPrintF</span>:
        DebugKPrintFPrint( inData, inSize );
        <span class="enscript-keyword">break</span>;
#<span class="enscript-reference">endif</span>

#<span class="enscript-reference">if</span> ( <span class="enscript-variable-name">DEBUG_MAC_OS_X_IOLOG_ENABLED</span> )
    <span class="enscript-keyword">case</span> <span class="enscript-reference">kDebugOutputTypeMacOSXIOLog</span>:
        DebugMacOSXIOLogPrint( inData, inSize );
        <span class="enscript-keyword">break</span>;
#<span class="enscript-reference">endif</span>

#<span class="enscript-reference">if</span> ( <span class="enscript-variable-name">TARGET_OS_MAC</span> )
    <span class="enscript-keyword">case</span> <span class="enscript-reference">kDebugOutputTypeMacOSXLog</span>:
        DebugMacOSXLogPrint( inData, inSize );
        <span class="enscript-keyword">break</span>;
#<span class="enscript-reference">endif</span>

#<span class="enscript-reference">if</span> ( <span class="enscript-variable-name">TARGET_OS_WIN32</span> )
    <span class="enscript-keyword">case</span> <span class="enscript-reference">kDebugOutputTypeWindowsDebugger</span>:
        DebugWindowsDebuggerPrint( inData, inSize );
        <span class="enscript-keyword">break</span>;
#<span class="enscript-reference">endif</span>

#<span class="enscript-reference">if</span> ( <span class="enscript-variable-name">TARGET_OS_WIN32</span> &amp;&amp; !<span class="enscript-variable-name">TARGET_OS_WINDOWS_CE</span> )
    <span class="enscript-keyword">case</span> <span class="enscript-reference">kDebugOutputTypeWindowsEventLog</span>:
        DebugWindowsEventLogPrint( inLevel, inData, inSize );
        <span class="enscript-keyword">break</span>;
#<span class="enscript-reference">endif</span>

    <span class="enscript-reference">default</span>:
        <span class="enscript-keyword">break</span>;
    }
    err = kNoErr;

<span class="enscript-reference">exit</span>:
    <span class="enscript-keyword">return</span>( err );
}

<span class="enscript-comment">//===========================================================================================================================
</span><span class="enscript-comment">//	DebugPrintAssert
</span><span class="enscript-comment">//
</span><span class="enscript-comment">//	Warning: This routine relies on several of the strings being string constants that will exist forever because the
</span><span class="enscript-comment">//           underlying logMsg API that does the printing is asynchronous so it cannot use temporary/stack-based
</span><span class="enscript-comment">//           pointer variables (e.g. local strings). The debug macros that invoke this function only use constant
</span><span class="enscript-comment">//           constant strings, but if this function is invoked directly from other places, it must use constant strings.
</span><span class="enscript-comment">//===========================================================================================================================
</span>
DEBUG_EXPORT <span class="enscript-type">void</span>
<span class="enscript-function-name">DebugPrintAssert</span>(
    int_least32_t inErrorCode,
    <span class="enscript-type">const</span> <span class="enscript-type">char</span> *    inAssertString,
    <span class="enscript-type">const</span> <span class="enscript-type">char</span> *    inMessage,
    <span class="enscript-type">const</span> <span class="enscript-type">char</span> *    inFilename,
    int_least32_t inLineNumber,
    <span class="enscript-type">const</span> <span class="enscript-type">char</span> *    inFunction )
{
    <span class="enscript-comment">// Skip if the level is not in the enabled range..
</span>
    <span class="enscript-keyword">if</span>( ( kDebugLevelAssert &lt; gDebugPrintLevelMin ) || ( kDebugLevelAssert &gt; gDebugPrintLevelMax ) )
    {
        <span class="enscript-keyword">return</span>;
    }

    <span class="enscript-keyword">if</span>( inErrorCode != 0 )
    {
        DebugPrintF(
            kDebugLevelAssert,
            <span class="enscript-string">&quot;\n&quot;</span>
            <span class="enscript-string">&quot;[ASSERT] error:  %ld (%m)\n&quot;</span>
            <span class="enscript-string">&quot;[ASSERT] where:  \&quot;%s\&quot;, line %ld, \&quot;%s\&quot;\n&quot;</span>
            <span class="enscript-string">&quot;\n&quot;</span>,
            inErrorCode, inErrorCode,
            inFilename ? inFilename : <span class="enscript-string">&quot;&quot;</span>,
            inLineNumber,
            inFunction ? inFunction : <span class="enscript-string">&quot;&quot;</span> );
    }
    <span class="enscript-keyword">else</span>
    {
        DebugPrintF(
            kDebugLevelAssert,
            <span class="enscript-string">&quot;\n&quot;</span>
            <span class="enscript-string">&quot;[ASSERT] assert: \&quot;%s\&quot; %s\n&quot;</span>
            <span class="enscript-string">&quot;[ASSERT] where:  \&quot;%s\&quot;, line %ld, \&quot;%s\&quot;\n&quot;</span>
            <span class="enscript-string">&quot;\n&quot;</span>,
            inAssertString ? inAssertString : <span class="enscript-string">&quot;&quot;</span>,
            inMessage ? inMessage : <span class="enscript-string">&quot;&quot;</span>,
            inFilename ? inFilename : <span class="enscript-string">&quot;&quot;</span>,
            inLineNumber,
            inFunction ? inFunction : <span class="enscript-string">&quot;&quot;</span> );
    }

    <span class="enscript-comment">// Break into the debugger if enabled.
</span>
    #<span class="enscript-keyword">if</span> ( TARGET_OS_WIN32 )
    <span class="enscript-keyword">if</span>( gDebugBreakLevel &lt;= kDebugLevelAssert )
    {
        <span class="enscript-keyword">if</span>( IsDebuggerPresent() )
        {
            DebugBreak();
        }
    }
    #endif
}

#<span class="enscript-reference">if</span> 0
#<span class="enscript-reference">pragma</span> <span class="enscript-variable-name">mark</span> -
#<span class="enscript-reference">endif</span>

#<span class="enscript-reference">if</span> ( <span class="enscript-variable-name">DEBUG_FPRINTF_ENABLED</span> )
<span class="enscript-comment">//===========================================================================================================================
</span><span class="enscript-comment">//	DebugFPrintFInit
</span><span class="enscript-comment">//===========================================================================================================================
</span>
<span class="enscript-type">static</span> OSStatus <span class="enscript-function-name">DebugFPrintFInit</span>( DebugOutputTypeFlags inFlags, <span class="enscript-type">const</span> <span class="enscript-type">char</span> *inFilename )
{
    OSStatus err;
    DebugOutputTypeFlags typeFlags;

    typeFlags = inFlags &amp; kDebugOutputTypeFlagsTypeMask;
    <span class="enscript-keyword">if</span>( typeFlags == kDebugOutputTypeFlagsStdOut )
    {
        #<span class="enscript-keyword">if</span> ( TARGET_OS_WIN32 )
        DebugWinEnableConsole();
        #endif

        gDebugFPrintFFile = stdout;
    }
    <span class="enscript-keyword">else</span> <span class="enscript-keyword">if</span>( typeFlags == kDebugOutputTypeFlagsStdErr )
    {
        #<span class="enscript-keyword">if</span> ( TARGET_OS_WIN32 )
        DebugWinEnableConsole();
        #endif

        gDebugFPrintFFile = stdout;
    }
    <span class="enscript-keyword">else</span> <span class="enscript-keyword">if</span>( typeFlags == kDebugOutputTypeFlagsFile )
    {
        require_action_quiet( inFilename &amp;&amp; ( *inFilename != <span class="enscript-string">'\0'</span> ), exit, err = kOpenErr );

        gDebugFPrintFFile = fopen( inFilename, <span class="enscript-string">&quot;a&quot;</span> );
        require_action_quiet( gDebugFPrintFFile, exit, err = kOpenErr );
    }
    <span class="enscript-keyword">else</span>
    {
        err = kParamErr;
        <span class="enscript-keyword">goto</span> <span class="enscript-reference">exit</span>;
    }
    err = kNoErr;

<span class="enscript-reference">exit</span>:
    <span class="enscript-keyword">return</span>( err );
}

<span class="enscript-comment">//===========================================================================================================================
</span><span class="enscript-comment">//	DebugFPrintFPrint
</span><span class="enscript-comment">//===========================================================================================================================
</span>
<span class="enscript-type">static</span> <span class="enscript-type">void</span> <span class="enscript-function-name">DebugFPrintFPrint</span>( <span class="enscript-type">char</span> *inData, size_t inSize )
{
    <span class="enscript-type">char</span> *      p;
    <span class="enscript-type">char</span> *      q;

    <span class="enscript-comment">// Convert \r to \n. fprintf will interpret \n and convert to whatever is appropriate for the platform.
</span>
    p = inData;
    q = p + inSize;
    <span class="enscript-keyword">while</span>( p &lt; q )
    {
        <span class="enscript-keyword">if</span>( *p == <span class="enscript-string">'\r'</span> )
        {
            *p = <span class="enscript-string">'\n'</span>;
        }
        ++p;
    }

    <span class="enscript-comment">// Write the data and flush.
</span>
    <span class="enscript-keyword">if</span>( gDebugFPrintFFile )
    {
        fprintf( gDebugFPrintFFile, <span class="enscript-string">&quot;%.*s&quot;</span>, (<span class="enscript-type">int</span>) inSize, inData );
        fflush( gDebugFPrintFFile );
    }
}
#<span class="enscript-reference">endif</span>  // <span class="enscript-variable-name">DEBUG_FPRINTF_ENABLED</span>

#<span class="enscript-reference">if</span> ( <span class="enscript-variable-name">DEBUG_IDEBUG_ENABLED</span> )
<span class="enscript-comment">//===========================================================================================================================
</span><span class="enscript-comment">//	DebugiDebugInit
</span><span class="enscript-comment">//===========================================================================================================================
</span>
<span class="enscript-type">static</span> OSStatus <span class="enscript-function-name">DebugiDebugInit</span>( <span class="enscript-type">void</span> )
{
    OSStatus err;

    #<span class="enscript-keyword">if</span> ( TARGET_API_MAC_OSX_KERNEL )

    <span class="enscript-type">extern</span> uint32_t *       _giDebugReserved1;

    <span class="enscript-comment">// Emulate the iDebugSetOutputType macro in iDebugServices.h.
</span>    <span class="enscript-comment">// Note: This is not thread safe, but neither is iDebugServices.h nor iDebugKext.
</span>
    <span class="enscript-keyword">if</span>( !_giDebugReserved1 )
    {
        _giDebugReserved1 = (uint32_t *) IOMalloc( <span class="enscript-keyword">sizeof</span>( uint32_t ) );
        require_action_quiet( _giDebugReserved1, exit, err = kNoMemoryErr );
    }
    *_giDebugReserved1 = 0x00010000U;
    err = kNoErr;
<span class="enscript-reference">exit</span>:
    #<span class="enscript-keyword">else</span>

    __private_extern__ <span class="enscript-type">void</span> iDebugSetOutputTypeInternal( uint32_t inType );

    iDebugSetOutputTypeInternal( 0x00010000U );
    err = kNoErr;

    #endif

    <span class="enscript-keyword">return</span>( err );
}

<span class="enscript-comment">//===========================================================================================================================
</span><span class="enscript-comment">//	DebugiDebugPrint
</span><span class="enscript-comment">//===========================================================================================================================
</span>
<span class="enscript-type">static</span> <span class="enscript-type">void</span> <span class="enscript-function-name">DebugiDebugPrint</span>( <span class="enscript-type">char</span> *inData, size_t inSize )
{
    #<span class="enscript-keyword">if</span> ( TARGET_API_MAC_OSX_KERNEL )

    <span class="enscript-comment">// Locally declared here so we do not need to include iDebugKext.h.
</span>    <span class="enscript-comment">// Note: IOKit uses a global namespace for all code and only a partial link occurs at build time. When the
</span>    <span class="enscript-comment">// KEXT is loaded, the runtime linker will link in this extern'd symbol (assuming iDebug is present).
</span>    <span class="enscript-comment">// _giDebugLogInternal is actually part of IOKit proper so this should link even if iDebug is not present.
</span>
    <span class="enscript-type">typedef</span> <span class="enscript-type">void</span> ( *iDebugLogFunctionPtr )( uint32_t inLevel, uint32_t inTag, <span class="enscript-type">const</span> <span class="enscript-type">char</span> *inFormat, ... );

    <span class="enscript-type">extern</span> iDebugLogFunctionPtr _giDebugLogInternal;

    <span class="enscript-keyword">if</span>( _giDebugLogInternal )
    {
        _giDebugLogInternal( 0, 0, <span class="enscript-string">&quot;%.*s&quot;</span>, (<span class="enscript-type">int</span>) inSize, inData );
    }

    #<span class="enscript-keyword">else</span>

    __private_extern__ <span class="enscript-type">void</span> iDebugLogInternal( uint32_t inLevel, uint32_t inTag, <span class="enscript-type">const</span> <span class="enscript-type">char</span> *inFormat, ... );

    iDebugLogInternal( 0, 0, <span class="enscript-string">&quot;%.*s&quot;</span>, (<span class="enscript-type">int</span>) inSize, inData );

    #endif
}
#<span class="enscript-reference">endif</span>

#<span class="enscript-reference">if</span> ( <span class="enscript-variable-name">DEBUG_KPRINTF_ENABLED</span> )
<span class="enscript-comment">//===========================================================================================================================
</span><span class="enscript-comment">//	DebugKPrintFPrint
</span><span class="enscript-comment">//===========================================================================================================================
</span>
<span class="enscript-type">static</span> <span class="enscript-type">void</span> <span class="enscript-function-name">DebugKPrintFPrint</span>( <span class="enscript-type">char</span> *inData, size_t inSize )
{
    <span class="enscript-type">extern</span> <span class="enscript-type">void</span> kprintf( <span class="enscript-type">const</span> <span class="enscript-type">char</span> *inFormat, ... );

    kprintf( <span class="enscript-string">&quot;%.*s&quot;</span>, (<span class="enscript-type">int</span>) inSize, inData );
}
#<span class="enscript-reference">endif</span>

#<span class="enscript-reference">if</span> ( <span class="enscript-variable-name">DEBUG_MAC_OS_X_IOLOG_ENABLED</span> )
<span class="enscript-comment">//===========================================================================================================================
</span><span class="enscript-comment">//	DebugMacOSXIOLogPrint
</span><span class="enscript-comment">//===========================================================================================================================
</span>
<span class="enscript-type">static</span> <span class="enscript-type">void</span> <span class="enscript-function-name">DebugMacOSXIOLogPrint</span>( <span class="enscript-type">char</span> *inData, size_t inSize )
{
    <span class="enscript-type">extern</span> <span class="enscript-type">void</span> IOLog( <span class="enscript-type">const</span> <span class="enscript-type">char</span> *inFormat, ... );

    IOLog( <span class="enscript-string">&quot;%.*s&quot;</span>, (<span class="enscript-type">int</span>) inSize, inData );
}
#<span class="enscript-reference">endif</span>

#<span class="enscript-reference">if</span> ( <span class="enscript-variable-name">TARGET_OS_MAC</span> )
<span class="enscript-comment">//===========================================================================================================================
</span><span class="enscript-comment">//	DebugMacOSXLogInit
</span><span class="enscript-comment">//===========================================================================================================================
</span>
<span class="enscript-type">static</span> OSStatus <span class="enscript-function-name">DebugMacOSXLogInit</span>( <span class="enscript-type">void</span> )
{
    OSStatus err;
    CFStringRef path;
    CFURLRef url;
    CFBundleRef bundle;
    CFStringRef functionName;
    <span class="enscript-type">void</span> *          functionPtr;

    bundle = NULL;

    <span class="enscript-comment">// Create a bundle reference for System.framework.
</span>
    path = CFSTR( <span class="enscript-string">&quot;/System/Library/Frameworks/System.framework&quot;</span> );
    url = CFURLCreateWithFileSystemPath( NULL, path, kCFURLPOSIXPathStyle, true );
    require_action_quiet( url, exit, err = memFullErr );

    bundle = CFBundleCreate( NULL, url );
    CFRelease( url );
    require_action_quiet( bundle, exit, err = memFullErr );

    <span class="enscript-comment">// Get a ptr to the system's &quot;printf&quot; function from System.framework.
</span>
    functionName = CFSTR( <span class="enscript-string">&quot;printf&quot;</span> );
    functionPtr = CFBundleGetFunctionPointerForName( bundle, functionName );
    require_action_quiet( functionPtr, exit, err = memFullErr );

    <span class="enscript-comment">// Success! Note: The bundle cannot be released because it would invalidate the function ptr.
</span>
    gDebugMacOSXLogFunction = (DebugMacOSXLogFunctionPtr) functionPtr;
    bundle = NULL;
    err = noErr;

<span class="enscript-reference">exit</span>:
    <span class="enscript-keyword">if</span>( bundle )
    {
        CFRelease( bundle );
    }
    <span class="enscript-keyword">return</span>( err );
}

<span class="enscript-comment">//===========================================================================================================================
</span><span class="enscript-comment">//	DebugMacOSXLogPrint
</span><span class="enscript-comment">//===========================================================================================================================
</span>
<span class="enscript-type">static</span> <span class="enscript-type">void</span> <span class="enscript-function-name">DebugMacOSXLogPrint</span>( <span class="enscript-type">char</span> *inData, size_t inSize )
{
    <span class="enscript-keyword">if</span>( gDebugMacOSXLogFunction )
    {
        gDebugMacOSXLogFunction( <span class="enscript-string">&quot;%.*s&quot;</span>, (<span class="enscript-type">int</span>) inSize, inData );
    }
}
#<span class="enscript-reference">endif</span>

#<span class="enscript-reference">if</span> ( <span class="enscript-variable-name">TARGET_OS_WIN32</span> )
<span class="enscript-comment">//===========================================================================================================================
</span><span class="enscript-comment">//	DebugWindowsDebuggerPrint
</span><span class="enscript-comment">//===========================================================================================================================
</span>
<span class="enscript-type">void</span>    <span class="enscript-function-name">DebugWindowsDebuggerPrint</span>( <span class="enscript-type">char</span> *inData, size_t inSize )
{
    TCHAR buffer[ 512 ];
    <span class="enscript-type">const</span> <span class="enscript-type">char</span> *        src;
    <span class="enscript-type">const</span> <span class="enscript-type">char</span> *        end;
    TCHAR *             dst;
    <span class="enscript-type">char</span> c;

    <span class="enscript-comment">// Copy locally and null terminate the string. This also converts from char to TCHAR in case we are
</span>    <span class="enscript-comment">// building with UNICODE enabled since the input is always char. Also convert \r to \n in the process.
</span>
    src = inData;
    <span class="enscript-keyword">if</span>( inSize &gt;= sizeof_array( buffer ) )
    {
        inSize = sizeof_array( buffer ) - 1;
    }
    end = src + inSize;
    dst = buffer;
    <span class="enscript-keyword">while</span>( src &lt; end )
    {
        c = *src++;
        <span class="enscript-keyword">if</span>( c == <span class="enscript-string">'\r'</span> )
        {
            c = <span class="enscript-string">'\n'</span>;
        }
        *dst++ = (TCHAR) c;
    }
    *dst = 0;

    <span class="enscript-comment">// Print out the string to the debugger.
</span>
    OutputDebugString( buffer );
}
#<span class="enscript-reference">endif</span>

#<span class="enscript-reference">if</span> ( <span class="enscript-variable-name">TARGET_OS_WIN32</span> &amp;&amp; !<span class="enscript-variable-name">TARGET_OS_WINDOWS_CE</span> )
<span class="enscript-comment">//===========================================================================================================================
</span><span class="enscript-comment">//	DebugWindowsEventLogInit
</span><span class="enscript-comment">//===========================================================================================================================
</span>
<span class="enscript-type">static</span> OSStatus <span class="enscript-function-name">DebugWindowsEventLogInit</span>( <span class="enscript-type">const</span> <span class="enscript-type">char</span> *inName, HMODULE inModule )
{
    OSStatus err;
    HKEY key;
    TCHAR name[ 128 ];
    <span class="enscript-type">const</span> <span class="enscript-type">char</span> *        src;
    TCHAR path[ MAX_PATH ];
    size_t size;
    DWORD typesSupported;
    DWORD n;

    key = NULL;

    <span class="enscript-comment">// Use a default name if needed then convert the name to TCHARs so it works on ANSI or Unicode builds.
</span>
    <span class="enscript-keyword">if</span>( !inName || ( *inName == <span class="enscript-string">'\0'</span> ) )
    {
        inName = <span class="enscript-string">&quot;DefaultApp&quot;</span>;
    }
    DebugWinCharToTCharString( inName, kSizeCString, name, <span class="enscript-keyword">sizeof</span>( name ), NULL );

    <span class="enscript-comment">// Build the path string using the fixed registry path and app name.
</span>
    src = <span class="enscript-string">&quot;SYSTEM\\CurrentControlSet\\Services\\EventLog\\Application\\&quot;</span>;
    DebugWinCharToTCharString( src, kSizeCString, path, sizeof_array( path ), &amp;size );
    DebugWinCharToTCharString( inName, kSizeCString, path + size, sizeof_array( path ) - size, NULL );

    <span class="enscript-comment">// Add/Open the source name as a sub-key under the Application key in the EventLog registry key.
</span>
    err = RegCreateKeyEx( HKEY_LOCAL_MACHINE, path, 0, NULL, REG_OPTION_NON_VOLATILE, KEY_ALL_ACCESS, NULL, &amp;key, NULL );
    require_noerr_quiet( err, exit );

    <span class="enscript-comment">// Set the path in the EventMessageFile subkey. Add 1 to the TCHAR count to include the null terminator.
</span>
    n = GetModuleFileName( inModule, path, sizeof_array( path ) );
    err = translate_errno( n &gt; 0, (OSStatus) GetLastError(), kParamErr );
    require_noerr_quiet( err, exit );
    n += 1;
    n *= <span class="enscript-keyword">sizeof</span>( TCHAR );

    err = RegSetValueEx( key, TEXT( <span class="enscript-string">&quot;EventMessageFile&quot;</span> ), 0, REG_EXPAND_SZ, (<span class="enscript-type">const</span> LPBYTE) path, n );
    require_noerr_quiet( err, exit );

    <span class="enscript-comment">// Set the supported event types in the TypesSupported subkey.
</span>
    typesSupported = EVENTLOG_SUCCESS | EVENTLOG_ERROR_TYPE | EVENTLOG_WARNING_TYPE | EVENTLOG_INFORMATION_TYPE |
                     EVENTLOG_AUDIT_SUCCESS | EVENTLOG_AUDIT_FAILURE;
    err = RegSetValueEx( key, TEXT( <span class="enscript-string">&quot;TypesSupported&quot;</span> ), 0, REG_DWORD, (<span class="enscript-type">const</span> LPBYTE) &amp;typesSupported, <span class="enscript-keyword">sizeof</span>( DWORD ) );
    require_noerr_quiet( err, exit );

    <span class="enscript-comment">// Set up the event source.
</span>
    gDebugWindowsEventLogEventSource = RegisterEventSource( NULL, name );
    err = translate_errno( gDebugWindowsEventLogEventSource, (OSStatus) GetLastError(), kParamErr );
    require_noerr_quiet( err, exit );

<span class="enscript-reference">exit</span>:
    <span class="enscript-keyword">if</span>( key )
    {
        RegCloseKey( key );
    }
    <span class="enscript-keyword">return</span>( err );
}

<span class="enscript-comment">//===========================================================================================================================
</span><span class="enscript-comment">//	DebugWindowsEventLogPrint
</span><span class="enscript-comment">//===========================================================================================================================
</span>
<span class="enscript-type">static</span> <span class="enscript-type">void</span> <span class="enscript-function-name">DebugWindowsEventLogPrint</span>( DebugLevel inLevel, <span class="enscript-type">char</span> *inData, size_t inSize )
{
    WORD type;
    TCHAR buffer[ 512 ];
    <span class="enscript-type">const</span> <span class="enscript-type">char</span> *        src;
    <span class="enscript-type">const</span> <span class="enscript-type">char</span> *        end;
    TCHAR *             dst;
    <span class="enscript-type">char</span> c;
    <span class="enscript-type">const</span> TCHAR *       array[ 1 ];

    <span class="enscript-comment">// Map the debug level to a Windows EventLog type.
</span>
    <span class="enscript-keyword">if</span>( inLevel &lt;= kDebugLevelNotice )
    {
        type = EVENTLOG_INFORMATION_TYPE;
    }
    <span class="enscript-keyword">else</span> <span class="enscript-keyword">if</span>( inLevel &lt;= kDebugLevelWarning )
    {
        type = EVENTLOG_WARNING_TYPE;
    }
    <span class="enscript-keyword">else</span>
    {
        type = EVENTLOG_ERROR_TYPE;
    }

    <span class="enscript-comment">// Copy locally and null terminate the string. This also converts from char to TCHAR in case we are
</span>    <span class="enscript-comment">// building with UNICODE enabled since the input is always char. Also convert \r to \n in the process.
</span>
    src = inData;
    <span class="enscript-keyword">if</span>( inSize &gt;= sizeof_array( buffer ) )
    {
        inSize = sizeof_array( buffer ) - 1;
    }
    end = src + inSize;
    dst = buffer;
    <span class="enscript-keyword">while</span>( src &lt; end )
    {
        c = *src++;
        <span class="enscript-keyword">if</span>( c == <span class="enscript-string">'\r'</span> )
        {
            c = <span class="enscript-string">'\n'</span>;
        }
        *dst++ = (TCHAR) c;
    }
    *dst = 0;

    <span class="enscript-comment">// Add the the string to the event log.
</span>
    array[ 0 ] = buffer;
    <span class="enscript-keyword">if</span>( gDebugWindowsEventLogEventSource )
    {
        ReportEvent( gDebugWindowsEventLogEventSource, type, 0, 0x20000001L, NULL, 1, 0, array, NULL );
    }
}
#<span class="enscript-reference">endif</span>  // <span class="enscript-variable-name">TARGET_OS_WIN32</span> &amp;&amp; !<span class="enscript-variable-name">TARGET_OS_WINDOWS_CE</span>

#<span class="enscript-reference">if</span> ( <span class="enscript-variable-name">DEBUG_CORE_SERVICE_ASSERTS_ENABLED</span> )
<span class="enscript-comment">//===========================================================================================================================
</span><span class="enscript-comment">//	DebugAssertOutputHandler
</span><span class="enscript-comment">//===========================================================================================================================
</span>
<span class="enscript-type">static</span> pascal <span class="enscript-type">void</span>
<span class="enscript-function-name">DebugAssertOutputHandler</span>(
    OSType inComponentSignature,
    UInt32 inOptions,
    <span class="enscript-type">const</span> <span class="enscript-type">char</span> *        inAssertString,
    <span class="enscript-type">const</span> <span class="enscript-type">char</span> *        inExceptionString,
    <span class="enscript-type">const</span> <span class="enscript-type">char</span> *        inErrorString,
    <span class="enscript-type">const</span> <span class="enscript-type">char</span> *        inFileName,
    <span class="enscript-type">long</span> inLineNumber,
    <span class="enscript-type">void</span> *              inValue,
    ConstStr255Param inOutputMsg )
{
    DEBUG_UNUSED( inComponentSignature );
    DEBUG_UNUSED( inOptions );
    DEBUG_UNUSED( inExceptionString );
    DEBUG_UNUSED( inValue );
    DEBUG_UNUSED( inOutputMsg );

    DebugPrintAssert( 0, inAssertString, inErrorString, inFileName, (int_least32_t) inLineNumber, <span class="enscript-string">&quot;&quot;</span> );
}
#<span class="enscript-reference">endif</span>

#<span class="enscript-reference">if</span> 0
#<span class="enscript-reference">pragma</span> <span class="enscript-variable-name">mark</span> -
#<span class="enscript-reference">pragma</span> <span class="enscript-variable-name">mark</span> == <span class="enscript-variable-name">Utilities</span> ==
#<span class="enscript-reference">endif</span>

<span class="enscript-comment">//===========================================================================================================================
</span><span class="enscript-comment">//	DebugSNPrintF
</span><span class="enscript-comment">//
</span><span class="enscript-comment">//	Stolen from mDNS.c's mDNS_snprintf/mDNS_vsnprintf with the following changes:
</span><span class="enscript-comment">//
</span><span class="enscript-comment">//	Changed names to avoid name collisions with the mDNS versions.
</span><span class="enscript-comment">//	Changed types to standard C types since mDNSEmbeddedAPI.h may not be available.
</span><span class="enscript-comment">//	Conditionalized mDNS stuff so it can be used with or with mDNSEmbeddedAPI.h.
</span><span class="enscript-comment">//	Added 64-bit support for %d (%lld), %i (%lli), %u (%llu), %o (%llo), %x (%llx), and %b (%llb).
</span><span class="enscript-comment">//	Added %@   - Cocoa/CoreFoundation object. Param is the object. Strings are used directly. Others use CFCopyDescription.
</span><span class="enscript-comment">//	Added %.8a - FIbre Channel address. Arg=ptr to address.
</span><span class="enscript-comment">//	Added %##a - IPv4 (if AF_INET defined) or IPv6 (if AF_INET6 defined) sockaddr. Arg=ptr to sockaddr.
</span><span class="enscript-comment">//	Added %b   - Binary representation of integer (e.g. 01101011). Modifiers and arg=the same as %d, %x, etc.
</span><span class="enscript-comment">//	Added %C   - Mac-style FourCharCode (e.g. 'APPL'). Arg=32-bit value to print as a Mac-style FourCharCode.
</span><span class="enscript-comment">//	Added %H   - Hex Dump (e.g. &quot;\x6b\xa7&quot; -&gt; &quot;6B A7&quot;). 1st arg=ptr, 2nd arg=size, 3rd arg=max size.
</span><span class="enscript-comment">//	Added %#H  - Hex Dump &amp; ASCII (e.g. &quot;\x41\x62&quot; -&gt; &quot;6B A7 'Ab'&quot;). 1st arg=ptr, 2nd arg=size, 3rd arg=max size.
</span><span class="enscript-comment">//	Added %m   - Error Message (e.g. 0 -&gt; &quot;kNoErr&quot;). Modifiers and error code args are the same as %d, %x, etc.
</span><span class="enscript-comment">//	Added %S   - UTF-16 string. Host order if no BOM. Precision is UTF-16 char count. BOM counts in any precision. Arg=ptr.
</span><span class="enscript-comment">//	Added %#S  - Big Endian UTF-16 string (unless BOM overrides). Otherwise the same as %S.
</span><span class="enscript-comment">//	Added %##S - Little Endian UTF-16 string (unless BOM overrides). Otherwise the same as %S.
</span><span class="enscript-comment">//	Added %U   - Universally Unique Identifier (UUID) (e.g. 6ba7b810-9dad-11d1-80b4-00c04fd430c8). Arg=ptr to 16-byte UUID.
</span><span class="enscript-comment">//===========================================================================================================================
</span>
DEBUG_EXPORT size_t <span class="enscript-function-name">DebugSNPrintF</span>(<span class="enscript-type">char</span> *sbuffer, size_t buflen, <span class="enscript-type">const</span> <span class="enscript-type">char</span> *fmt, ...)
{
    size_t length;

    va_list ptr;
    va_start(ptr,fmt);
    length = DebugSNPrintFVAList(sbuffer, buflen, fmt, ptr);
    va_end(ptr);

    <span class="enscript-keyword">return</span>(length);
}

<span class="enscript-comment">//===========================================================================================================================
</span><span class="enscript-comment">//	DebugSNPrintFVAList	- va_list version of DebugSNPrintF. See DebugSNPrintF for more info.
</span><span class="enscript-comment">//===========================================================================================================================
</span>
DEBUG_EXPORT size_t <span class="enscript-function-name">DebugSNPrintFVAList</span>(<span class="enscript-type">char</span> *sbuffer, size_t buflen, <span class="enscript-type">const</span> <span class="enscript-type">char</span> *fmt, va_list arg)
{
    <span class="enscript-type">static</span> <span class="enscript-type">const</span> <span class="enscript-type">struct</span> DebugSNPrintF_format
    {
        <span class="enscript-type">unsigned</span> leftJustify : 1;
        <span class="enscript-type">unsigned</span> forceSign : 1;
        <span class="enscript-type">unsigned</span> zeroPad : 1;
        <span class="enscript-type">unsigned</span> havePrecision : 1;
        <span class="enscript-type">unsigned</span> hSize : 1;
        <span class="enscript-type">char</span> lSize;
        <span class="enscript-type">char</span> altForm;
        <span class="enscript-type">char</span> sign;              <span class="enscript-comment">// +, - or space
</span>        <span class="enscript-type">unsigned</span> <span class="enscript-type">int</span> fieldWidth;
        <span class="enscript-type">unsigned</span> <span class="enscript-type">int</span> precision;
    } DebugSNPrintF_format_default = { 0, 0, 0, 0, 0, 0, 0, 0, 0, 0 };

    size_t nwritten = 0;
    <span class="enscript-type">int</span> c;
    <span class="enscript-keyword">if</span> (buflen == 0) <span class="enscript-keyword">return</span>(0);
    buflen--;       <span class="enscript-comment">// Pre-reserve one space in the buffer for the terminating nul
</span>    <span class="enscript-keyword">if</span> (buflen == 0) <span class="enscript-keyword">goto</span> <span class="enscript-reference">exit</span>;

    <span class="enscript-keyword">for</span> (c = *fmt; c != 0; c = *++fmt)
    {
        <span class="enscript-keyword">if</span> (c != <span class="enscript-string">'%'</span>)
        {
            *sbuffer++ = (<span class="enscript-type">char</span>)c;
            <span class="enscript-keyword">if</span> (++nwritten &gt;= buflen) <span class="enscript-keyword">goto</span> <span class="enscript-reference">exit</span>;
        }
        <span class="enscript-keyword">else</span>
        {
            size_t i=0, j;
            <span class="enscript-comment">// The mDNS Vsprintf Argument Conversion Buffer is used as a temporary holding area for
</span>            <span class="enscript-comment">// generating decimal numbers, hexdecimal numbers, IP addresses, domain name strings, etc.
</span>            <span class="enscript-comment">// The size needs to be enough for a 256-byte domain name plus some error text.
</span>            #define mDNS_VACB_Size 300
            <span class="enscript-type">char</span> mDNS_VACB[mDNS_VACB_Size];
            #define mDNS_VACB_Lim (&amp;mDNS_VACB[mDNS_VACB_Size])
            #define mDNS_VACB_Remain(s) ((size_t)(mDNS_VACB_Lim - s))
            <span class="enscript-type">char</span> *s = mDNS_VACB_Lim;
            <span class="enscript-type">const</span> <span class="enscript-type">char</span> *digits = <span class="enscript-string">&quot;0123456789ABCDEF&quot;</span>;
            <span class="enscript-type">struct</span> DebugSNPrintF_format F = DebugSNPrintF_format_default;

            <span class="enscript-keyword">for</span>(;;) <span class="enscript-comment">//  decode flags
</span>            {
                c = *++fmt;
                <span class="enscript-keyword">if</span>      (c == <span class="enscript-string">'-'</span>) F.leftJustify = 1;
                <span class="enscript-keyword">else</span> <span class="enscript-keyword">if</span> (c == <span class="enscript-string">'+'</span>) F.forceSign = 1;
                <span class="enscript-keyword">else</span> <span class="enscript-keyword">if</span> (c == <span class="enscript-string">' '</span>) F.sign = <span class="enscript-string">' '</span>;
                <span class="enscript-keyword">else</span> <span class="enscript-keyword">if</span> (c == <span class="enscript-string">'#'</span>) F.altForm++;
                <span class="enscript-keyword">else</span> <span class="enscript-keyword">if</span> (c == <span class="enscript-string">'0'</span>) F.zeroPad = 1;
                <span class="enscript-keyword">else</span> <span class="enscript-keyword">break</span>;
            }

            <span class="enscript-keyword">if</span> (c == <span class="enscript-string">'*'</span>)   <span class="enscript-comment">//  decode field width
</span>            {
                <span class="enscript-type">int</span> f = va_arg(arg, <span class="enscript-type">int</span>);
                <span class="enscript-keyword">if</span> (f &lt; 0) { f = -f; F.leftJustify = 1; }
                F.fieldWidth = (<span class="enscript-type">unsigned</span> <span class="enscript-type">int</span>)f;
                c = *++fmt;
            }
            <span class="enscript-keyword">else</span>
            {
                <span class="enscript-keyword">for</span> (; c &gt;= <span class="enscript-string">'0'</span> &amp;&amp; c &lt;= <span class="enscript-string">'9'</span>; c = *++fmt)
                    F.fieldWidth = (10 * F.fieldWidth) + (c - <span class="enscript-string">'0'</span>);
            }

            <span class="enscript-keyword">if</span> (c == <span class="enscript-string">'.'</span>)   <span class="enscript-comment">//  decode precision
</span>            {
                <span class="enscript-keyword">if</span> ((c = *++fmt) == <span class="enscript-string">'*'</span>)
                { F.precision = va_arg(arg, <span class="enscript-type">unsigned</span> <span class="enscript-type">int</span>); c = *++fmt; }
                <span class="enscript-keyword">else</span> <span class="enscript-keyword">for</span> (; c &gt;= <span class="enscript-string">'0'</span> &amp;&amp; c &lt;= <span class="enscript-string">'9'</span>; c = *++fmt)
                        F.precision = (10 * F.precision) + (c - <span class="enscript-string">'0'</span>);
                F.havePrecision = 1;
            }

            <span class="enscript-keyword">if</span> (F.leftJustify) F.zeroPad = 0;

<span class="enscript-reference">conv</span>:
            <span class="enscript-keyword">switch</span> (c)  <span class="enscript-comment">//  perform appropriate conversion
</span>            {
                #<span class="enscript-keyword">if</span> TYPE_LONGLONG_NATIVE
                unsigned_long_long_compat n;
                unsigned_long_long_compat base;
                #<span class="enscript-keyword">else</span>
                <span class="enscript-type">unsigned</span> <span class="enscript-type">long</span> n;
                <span class="enscript-type">unsigned</span> <span class="enscript-type">long</span> base;
                #endif
            <span class="enscript-keyword">case</span> <span class="enscript-string">'h'</span>:  F.hSize = 1; c = *++fmt; <span class="enscript-keyword">goto</span> <span class="enscript-reference">conv</span>;
            <span class="enscript-keyword">case</span> <span class="enscript-string">'l'</span>:       <span class="enscript-comment">// fall through
</span>            <span class="enscript-keyword">case</span> <span class="enscript-string">'L'</span>:  F.lSize++; c = *++fmt; <span class="enscript-keyword">goto</span> <span class="enscript-reference">conv</span>;
            <span class="enscript-keyword">case</span> <span class="enscript-string">'d'</span>:
            <span class="enscript-keyword">case</span> <span class="enscript-string">'i'</span>:  base = 10;
                <span class="enscript-keyword">goto</span> <span class="enscript-reference">canBeSigned</span>;
            <span class="enscript-keyword">case</span> <span class="enscript-string">'u'</span>:  base = 10;
                <span class="enscript-keyword">goto</span> <span class="enscript-reference">notSigned</span>;
            <span class="enscript-keyword">case</span> <span class="enscript-string">'o'</span>:  base = 8;
                <span class="enscript-keyword">goto</span> <span class="enscript-reference">notSigned</span>;
            <span class="enscript-keyword">case</span> <span class="enscript-string">'b'</span>:  base = 2;
                <span class="enscript-keyword">goto</span> <span class="enscript-reference">notSigned</span>;
            <span class="enscript-keyword">case</span> <span class="enscript-string">'p'</span>:  n = va_arg(arg, uintptr_t);
                F.havePrecision = 1;
                F.precision = (<span class="enscript-keyword">sizeof</span>(uintptr_t) == 4) ? 8 : 16;
                F.sign = 0;
                base = 16;
                c = <span class="enscript-string">'x'</span>;
                <span class="enscript-keyword">goto</span> <span class="enscript-reference">number</span>;
            <span class="enscript-keyword">case</span> <span class="enscript-string">'x'</span>:  digits = <span class="enscript-string">&quot;0123456789abcdef&quot;</span>;
            <span class="enscript-keyword">case</span> <span class="enscript-string">'X'</span>:  base = 16;
                <span class="enscript-keyword">goto</span> <span class="enscript-reference">notSigned</span>;
<span class="enscript-reference">canBeSigned</span>:
                            #<span class="enscript-keyword">if</span> TYPE_LONGLONG_NATIVE
                <span class="enscript-keyword">if</span> (F.lSize == 1) n = (unsigned_long_long_compat)va_arg(arg, <span class="enscript-type">long</span>);
                <span class="enscript-keyword">else</span> <span class="enscript-keyword">if</span> (F.lSize == 2) n = (unsigned_long_long_compat)va_arg(arg, long_long_compat);
                <span class="enscript-keyword">else</span> n = (unsigned_long_long_compat)va_arg(arg, <span class="enscript-type">int</span>);
                            #<span class="enscript-keyword">else</span>
                <span class="enscript-keyword">if</span> (F.lSize == 1) n = (<span class="enscript-type">unsigned</span> <span class="enscript-type">long</span>)va_arg(arg, <span class="enscript-type">long</span>);
                <span class="enscript-keyword">else</span> <span class="enscript-keyword">if</span> (F.lSize == 2) <span class="enscript-keyword">goto</span> <span class="enscript-reference">exit</span>;
                <span class="enscript-keyword">else</span> n = (<span class="enscript-type">unsigned</span> <span class="enscript-type">long</span>)va_arg(arg, <span class="enscript-type">int</span>);
                            #endif
                <span class="enscript-keyword">if</span> (F.hSize) n = (<span class="enscript-type">short</span>) n;
                            #<span class="enscript-keyword">if</span> TYPE_LONGLONG_NATIVE
                <span class="enscript-keyword">if</span> ((long_long_compat) n &lt; 0) { n = (unsigned_long_long_compat)-(long_long_compat)n; F.sign = <span class="enscript-string">'-'</span>; }
                            #<span class="enscript-keyword">else</span>
                <span class="enscript-keyword">if</span> ((<span class="enscript-type">long</span>) n &lt; 0) { n = (<span class="enscript-type">unsigned</span> <span class="enscript-type">long</span>)-(<span class="enscript-type">long</span>)n; F.sign = <span class="enscript-string">'-'</span>; }
                            #endif
                <span class="enscript-keyword">else</span> <span class="enscript-keyword">if</span> (F.forceSign) F.sign = <span class="enscript-string">'+'</span>;
                <span class="enscript-keyword">goto</span> <span class="enscript-reference">number</span>;

<span class="enscript-reference">notSigned</span>:  <span class="enscript-keyword">if</span> (F.lSize == 1) n = va_arg(arg, <span class="enscript-type">unsigned</span> <span class="enscript-type">long</span>);
                <span class="enscript-keyword">else</span> <span class="enscript-keyword">if</span> (F.lSize == 2)
                {
                                #<span class="enscript-keyword">if</span> TYPE_LONGLONG_NATIVE
                    n = va_arg(arg, unsigned_long_long_compat);
                                #<span class="enscript-keyword">else</span>
                    <span class="enscript-keyword">goto</span> <span class="enscript-reference">exit</span>;
                                #endif
                }
                <span class="enscript-keyword">else</span> n = va_arg(arg, <span class="enscript-type">unsigned</span> <span class="enscript-type">int</span>);
                <span class="enscript-keyword">if</span> (F.hSize) n = (<span class="enscript-type">unsigned</span> <span class="enscript-type">short</span>) n;
                F.sign = 0;
                <span class="enscript-keyword">goto</span> <span class="enscript-reference">number</span>;

<span class="enscript-reference">number</span>:     <span class="enscript-keyword">if</span> (!F.havePrecision)
                {
                    <span class="enscript-keyword">if</span> (F.zeroPad)
                    {
                        F.precision = F.fieldWidth;
                        <span class="enscript-keyword">if</span> (F.altForm) F.precision -= 2;
                        <span class="enscript-keyword">if</span> (F.sign) --F.precision;
                    }
                    <span class="enscript-keyword">if</span> (F.precision &lt; 1) F.precision = 1;
                }
                <span class="enscript-keyword">if</span> (F.precision &gt; mDNS_VACB_Size - 1)
                    F.precision = mDNS_VACB_Size - 1;
                <span class="enscript-keyword">for</span> (i = 0; n; n /= base, i++) *--s = (<span class="enscript-type">char</span>)(digits[n % base]);
                <span class="enscript-keyword">for</span> (; i &lt; F.precision; i++) *--s = <span class="enscript-string">'0'</span>;
                <span class="enscript-keyword">if</span> (F.altForm) { *--s = (<span class="enscript-type">char</span>)c; *--s = <span class="enscript-string">'0'</span>; i += 2; }
                <span class="enscript-keyword">if</span> (F.sign) { *--s = F.sign; i++; }
                <span class="enscript-keyword">break</span>;

            <span class="enscript-keyword">case</span> <span class="enscript-string">'a'</span>:  {
                <span class="enscript-type">unsigned</span> <span class="enscript-type">char</span> *a = va_arg(arg, <span class="enscript-type">unsigned</span> <span class="enscript-type">char</span> *);
                <span class="enscript-type">char</span> pre[4] = <span class="enscript-string">&quot;&quot;</span>;
                <span class="enscript-type">char</span> post[32] = <span class="enscript-string">&quot;&quot;</span>;
                <span class="enscript-keyword">if</span> (!a) { <span class="enscript-type">static</span> <span class="enscript-type">char</span> emsg[] = <span class="enscript-string">&quot;&lt;&lt;NULL&gt;&gt;&quot;</span>; s = emsg; i = <span class="enscript-keyword">sizeof</span>(emsg)-1; }
                <span class="enscript-keyword">else</span>
                {
                    s = mDNS_VACB;              <span class="enscript-comment">// Adjust s to point to the start of the buffer, not the end
</span>                    <span class="enscript-keyword">if</span> (F.altForm == 1)
                    {
                                    #<span class="enscript-keyword">if</span> (defined(MDNS_DEBUGMSGS))
                        mDNSAddr *ip = (mDNSAddr*)a;
                        <span class="enscript-keyword">switch</span> (ip-&gt;type)
                        {
                        <span class="enscript-keyword">case</span> <span class="enscript-reference">mDNSAddrType_IPv4</span>: F.precision =  4; a = (<span class="enscript-type">unsigned</span> <span class="enscript-type">char</span> *)&amp;ip-&gt;ip.v4; <span class="enscript-keyword">break</span>;
                        <span class="enscript-keyword">case</span> <span class="enscript-reference">mDNSAddrType_IPv6</span>: F.precision = 16; a = (<span class="enscript-type">unsigned</span> <span class="enscript-type">char</span> *)&amp;ip-&gt;ip.v6; <span class="enscript-keyword">break</span>;
                        <span class="enscript-reference">default</span>:                F.precision =  0; <span class="enscript-keyword">break</span>;
                        }
                                    #<span class="enscript-keyword">else</span>
                        F.precision = 0;                    <span class="enscript-comment">// mDNSEmbeddedAPI.h not included so no mDNSAddr support
</span>                                    #endif
                    }
                    <span class="enscript-keyword">else</span> <span class="enscript-keyword">if</span> (F.altForm == 2)
                    {
                                    #ifdef AF_INET
                        <span class="enscript-type">const</span> <span class="enscript-type">struct</span> sockaddr *sa;
                        <span class="enscript-type">unsigned</span> <span class="enscript-type">char</span> *port;
                        sa = (<span class="enscript-type">const</span> <span class="enscript-type">struct</span> sockaddr*)a;
                        <span class="enscript-keyword">switch</span> (sa-&gt;sa_family)
                        {
                        <span class="enscript-keyword">case</span> <span class="enscript-reference">AF_INET</span>:  F.precision =  4; a = (<span class="enscript-type">unsigned</span> <span class="enscript-type">char</span>*)&amp;((<span class="enscript-type">const</span> <span class="enscript-type">struct</span> sockaddr_in *)a)-&gt;sin_addr;
                            port = (<span class="enscript-type">unsigned</span> <span class="enscript-type">char</span>*)&amp;((<span class="enscript-type">const</span> <span class="enscript-type">struct</span> sockaddr_in *)sa)-&gt;sin_port;
                            DebugSNPrintF(post, <span class="enscript-keyword">sizeof</span>(post), <span class="enscript-string">&quot;:%d&quot;</span>, (port[0] &lt;&lt; 8) | port[1]); <span class="enscript-keyword">break</span>;
                                            #ifdef AF_INET6
                        <span class="enscript-keyword">case</span> <span class="enscript-reference">AF_INET6</span>: F.precision = 16; a = (<span class="enscript-type">unsigned</span> <span class="enscript-type">char</span>*)&amp;((<span class="enscript-type">const</span> <span class="enscript-type">struct</span> sockaddr_in6 *)a)-&gt;sin6_addr;
                            pre[0] = <span class="enscript-string">'['</span>; pre[1] = <span class="enscript-string">'\0'</span>;
                            port = (<span class="enscript-type">unsigned</span> <span class="enscript-type">char</span>*)&amp;((<span class="enscript-type">const</span> <span class="enscript-type">struct</span> sockaddr_in6 *)sa)-&gt;sin6_port;
                            DebugSNPrintF(post, <span class="enscript-keyword">sizeof</span>(post), <span class="enscript-string">&quot;%%%d]:%d&quot;</span>,
                                          (<span class="enscript-type">int</span>)((<span class="enscript-type">const</span> <span class="enscript-type">struct</span> sockaddr_in6 *)sa)-&gt;sin6_scope_id,
                                          (port[0] &lt;&lt; 8) | port[1]); <span class="enscript-keyword">break</span>;
                                            #endif
                        <span class="enscript-reference">default</span>:       F.precision =  0; <span class="enscript-keyword">break</span>;
                        }
                                    #<span class="enscript-keyword">else</span>
                        F.precision = 0;                    <span class="enscript-comment">// socket interfaces not included so no sockaddr support
</span>                                    #endif
                    }
                    <span class="enscript-keyword">switch</span> (F.precision)
                    {
                    <span class="enscript-keyword">case</span>  <span class="enscript-reference">4</span>: i = DebugSNPrintF(mDNS_VACB, <span class="enscript-keyword">sizeof</span>(mDNS_VACB), <span class="enscript-string">&quot;%d.%d.%d.%d%s&quot;</span>,
                                               a[0], a[1], a[2], a[3], post); <span class="enscript-keyword">break</span>;
                    <span class="enscript-keyword">case</span>  <span class="enscript-reference">6</span>: i = DebugSNPrintF(mDNS_VACB, <span class="enscript-keyword">sizeof</span>(mDNS_VACB), <span class="enscript-string">&quot;%02X:%02X:%02X:%02X:%02X:%02X&quot;</span>,
                                               a[0], a[1], a[2], a[3], a[4], a[5]); <span class="enscript-keyword">break</span>;
                    <span class="enscript-keyword">case</span>  <span class="enscript-reference">8</span>: i = DebugSNPrintF(mDNS_VACB, <span class="enscript-keyword">sizeof</span>(mDNS_VACB), <span class="enscript-string">&quot;%02X:%02X:%02X:%02X:%02X:%02X:%02X:%02X&quot;</span>,
                                               a[0], a[1], a[2], a[3], a[4], a[5], a[6], a[7]); <span class="enscript-keyword">break</span>;
                    <span class="enscript-keyword">case</span> <span class="enscript-reference">16</span>: i = DebugSNPrintF(mDNS_VACB, <span class="enscript-keyword">sizeof</span>(mDNS_VACB),
                                               <span class="enscript-string">&quot;%s%02X%02X:%02X%02X:%02X%02X:%02X%02X:%02X%02X:%02X%02X:%02X%02X:%02X%02X%s&quot;</span>,
                                               pre, a[0], a[1], a[2], a[3], a[4], a[5], a[6], a[7], a[8],
                                               a[9], a[10], a[11], a[12], a[13], a[14], a[15], post); <span class="enscript-keyword">break</span>;
                    <span class="enscript-reference">default</span>: i = DebugSNPrintF(mDNS_VACB, <span class="enscript-keyword">sizeof</span>(mDNS_VACB), <span class="enscript-string">&quot;%s&quot;</span>, <span class="enscript-string">&quot;&lt;&lt; ERROR: Must specify address size &quot;</span>
                                               <span class="enscript-string">&quot;(i.e. %.4a=IPv4, %.6a=Ethernet, %.8a=Fibre Channel %.16a=IPv6) &gt;&gt;&quot;</span>); <span class="enscript-keyword">break</span>;
                    }
                }
            }
            <span class="enscript-keyword">break</span>;

            <span class="enscript-keyword">case</span> <span class="enscript-string">'U'</span>:  {
                <span class="enscript-type">unsigned</span> <span class="enscript-type">char</span> *a = va_arg(arg, <span class="enscript-type">unsigned</span> <span class="enscript-type">char</span> *);
                <span class="enscript-keyword">if</span> (!a) { <span class="enscript-type">static</span> <span class="enscript-type">char</span> emsg[] = <span class="enscript-string">&quot;&lt;&lt;NULL&gt;&gt;&quot;</span>; s = emsg; i = <span class="enscript-keyword">sizeof</span>(emsg)-1; }
                <span class="enscript-keyword">else</span>
                {
                    s = mDNS_VACB;              <span class="enscript-comment">// Adjust s to point to the start of the buffer, not the end
</span>                    i = DebugSNPrintF(mDNS_VACB, <span class="enscript-keyword">sizeof</span>(mDNS_VACB), <span class="enscript-string">&quot;%08x-%04x-%04x-%02x%02x-%02x%02x%02x%02x%02x%02x&quot;</span>,
                                      *((uint32_t*) &amp;a[0]), *((uint16_t*) &amp;a[4]), *((uint16_t*) &amp;a[6]),
                                      a[8], a[9], a[10], a[11], a[12], a[13], a[14], a[15]); <span class="enscript-keyword">break</span>;
                }
            }
            <span class="enscript-keyword">break</span>;

            <span class="enscript-keyword">case</span> <span class="enscript-string">'c'</span>:  *--s = (<span class="enscript-type">char</span>)va_arg(arg, <span class="enscript-type">int</span>); i = 1; <span class="enscript-keyword">break</span>;

            <span class="enscript-keyword">case</span> <span class="enscript-string">'C'</span>:  <span class="enscript-keyword">if</span> (F.lSize) n = va_arg(arg, <span class="enscript-type">unsigned</span> <span class="enscript-type">long</span>);
                <span class="enscript-keyword">else</span> n = va_arg(arg, <span class="enscript-type">unsigned</span> <span class="enscript-type">int</span>);
                <span class="enscript-keyword">if</span> (F.hSize) n = (<span class="enscript-type">unsigned</span> <span class="enscript-type">short</span>) n;
                c = (<span class="enscript-type">int</span>)( n        &amp; 0xFF); *--s = (<span class="enscript-type">char</span>)(DebugIsPrint(c) ? c : <span class="enscript-string">'^'</span>);
                c = (<span class="enscript-type">int</span>)((n &gt;&gt;  8) &amp; 0xFF); *--s = (<span class="enscript-type">char</span>)(DebugIsPrint(c) ? c : <span class="enscript-string">'^'</span>);
                c = (<span class="enscript-type">int</span>)((n &gt;&gt; 16) &amp; 0xFF); *--s = (<span class="enscript-type">char</span>)(DebugIsPrint(c) ? c : <span class="enscript-string">'^'</span>);
                c = (<span class="enscript-type">int</span>)((n &gt;&gt; 24) &amp; 0xFF); *--s = (<span class="enscript-type">char</span>)(DebugIsPrint(c) ? c : <span class="enscript-string">'^'</span>);
                i = 4;
                <span class="enscript-keyword">break</span>;

            <span class="enscript-keyword">case</span> <span class="enscript-string">'s'</span>:  s = va_arg(arg, <span class="enscript-type">char</span> *);
                <span class="enscript-keyword">if</span> (!s) { <span class="enscript-type">static</span> <span class="enscript-type">char</span> emsg[] = <span class="enscript-string">&quot;&lt;&lt;NULL&gt;&gt;&quot;</span>; s = emsg; i = <span class="enscript-keyword">sizeof</span>(emsg)-1; }
                <span class="enscript-keyword">else</span> <span class="enscript-keyword">switch</span> (F.altForm)
                    {
                    <span class="enscript-keyword">case</span> <span class="enscript-reference">0</span>: i=0;
                        <span class="enscript-keyword">if</span> (F.havePrecision)                                <span class="enscript-comment">// C string
</span>                        {
                            <span class="enscript-keyword">while</span>((i &lt; F.precision) &amp;&amp; s[i]) i++;
                            <span class="enscript-comment">// Make sure we don't truncate in the middle of a UTF-8 character.
</span>                            <span class="enscript-comment">// If the last character is part of a multi-byte UTF-8 character, back up to the start of it.
</span>                            j=0;
                            <span class="enscript-keyword">while</span>((i &gt; 0) &amp;&amp; ((c = s[i-1]) &amp; 0x80)) { j++; i--; <span class="enscript-keyword">if</span>((c &amp; 0xC0) != 0x80) <span class="enscript-keyword">break</span>;}
                            <span class="enscript-comment">// If the actual count of UTF-8 characters matches the encoded UTF-8 count, add it back.
</span>                            <span class="enscript-keyword">if</span>((j &gt; 1) &amp;&amp; (j &lt;= 6))
                            {
                                <span class="enscript-type">int</span> test = (0xFF &lt;&lt; (8-j)) &amp; 0xFF;
                                <span class="enscript-type">int</span> mask = test | (1 &lt;&lt; ((8-j)-1));
                                <span class="enscript-keyword">if</span>((c &amp; mask) == test) i += j;
                            }
                        }
                        <span class="enscript-keyword">else</span>
                            <span class="enscript-keyword">while</span>(s[i]) i++;
                        <span class="enscript-keyword">break</span>;
                    <span class="enscript-keyword">case</span> <span class="enscript-reference">1</span>: i = (<span class="enscript-type">unsigned</span> <span class="enscript-type">char</span>) *s++; <span class="enscript-keyword">break</span>;                <span class="enscript-comment">// Pascal string
</span>                    <span class="enscript-keyword">case</span> <span class="enscript-reference">2</span>: {                                               <span class="enscript-comment">// DNS label-sequence name
</span>                        <span class="enscript-type">unsigned</span> <span class="enscript-type">char</span> *a = (<span class="enscript-type">unsigned</span> <span class="enscript-type">char</span> *)s;
                        s = mDNS_VACB;                  <span class="enscript-comment">// Adjust s to point to the start of the buffer, not the end
</span>                        <span class="enscript-keyword">if</span> (*a == 0) *s++ = <span class="enscript-string">'.'</span>;                    <span class="enscript-comment">// Special case for root DNS name
</span>                        <span class="enscript-keyword">while</span> (*a)
                        {
                            <span class="enscript-keyword">if</span> (*a &gt; 63) { s += DebugSNPrintF(s, mDNS_VACB_Remain(s), <span class="enscript-string">&quot;&lt;&lt;INVALID LABEL LENGTH %u&gt;&gt;&quot;</span>, *a); <span class="enscript-keyword">break</span>; }
                            <span class="enscript-keyword">if</span> (s + *a &gt;= &amp;mDNS_VACB[254]) { s += DebugSNPrintF(s, mDNS_VACB_Remain(s), <span class="enscript-string">&quot;&lt;&lt;NAME TOO LONG&gt;&gt;&quot;</span>); <span class="enscript-keyword">break</span>; }
                            s += DebugSNPrintF(s, mDNS_VACB_Remain(s), <span class="enscript-string">&quot;%#s.&quot;</span>, a);
                            a += 1 + *a;
                        }
                        i = (size_t)(s - mDNS_VACB);
                        s = mDNS_VACB;                  <span class="enscript-comment">// Reset s back to the start of the buffer
</span>                        <span class="enscript-keyword">break</span>;
                    }
                    }
                <span class="enscript-keyword">if</span> (F.havePrecision &amp;&amp; i &gt; F.precision)                 <span class="enscript-comment">// Make sure we don't truncate in the middle of a UTF-8 character
</span>                { i = F.precision; <span class="enscript-keyword">while</span> (i&gt;0 &amp;&amp; (s[i] &amp; 0xC0) == 0x80) i--;}
                <span class="enscript-keyword">break</span>;

            <span class="enscript-keyword">case</span> <span class="enscript-string">'S'</span>:   {       <span class="enscript-comment">// UTF-16 string
</span>                <span class="enscript-type">unsigned</span> <span class="enscript-type">char</span> *a = va_arg(arg, <span class="enscript-type">unsigned</span> <span class="enscript-type">char</span> *);
                uint16_t      *u = (uint16_t*)a;
                <span class="enscript-keyword">if</span> (!u) { <span class="enscript-type">static</span> <span class="enscript-type">char</span> emsg[] = <span class="enscript-string">&quot;&lt;&lt;NULL&gt;&gt;&quot;</span>; s = emsg; i = <span class="enscript-keyword">sizeof</span>(emsg)-1; }
                <span class="enscript-keyword">if</span> ((!F.havePrecision || F.precision))
                {
                    <span class="enscript-keyword">if</span>      ((a[0] == 0xFE) &amp;&amp; (a[1] == 0xFF)) { F.altForm = 1; u += 1; a += 2; F.precision--; }                <span class="enscript-comment">// Big Endian
</span>                    <span class="enscript-keyword">else</span> <span class="enscript-keyword">if</span> ((a[0] == 0xFF) &amp;&amp; (a[1] == 0xFE)) { F.altForm = 2; u += 1; a += 2; F.precision--; }                <span class="enscript-comment">// Little Endian
</span>                }
                s = mDNS_VACB;              <span class="enscript-comment">// Adjust s to point to the start of the buffer, not the end
</span>                <span class="enscript-keyword">switch</span> (F.altForm)
                {
                <span class="enscript-keyword">case</span> <span class="enscript-reference">0</span>: <span class="enscript-keyword">while</span> ((!F.havePrecision || (i &lt; F.precision)) &amp;&amp; u[i] &amp;&amp; mDNS_VACB_Remain(s))                  <span class="enscript-comment">// Host Endian
</span>                    { c = u[i]; *s++ = (<span class="enscript-type">char</span>)(DebugIsPrint(c) ? c : <span class="enscript-string">'^'</span>); i++; }
                    <span class="enscript-keyword">break</span>;
                <span class="enscript-keyword">case</span> <span class="enscript-reference">1</span>: <span class="enscript-keyword">while</span> ((!F.havePrecision || (i &lt; F.precision)) &amp;&amp; u[i] &amp;&amp; mDNS_VACB_Remain(s))                  <span class="enscript-comment">// Big Endian
</span>                    { c = ((a[0] &lt;&lt; 8) | a[1]) &amp; 0xFF; *s++ = (<span class="enscript-type">char</span>)(DebugIsPrint(c) ? c : <span class="enscript-string">'^'</span>); i++; a += 2; }
                    <span class="enscript-keyword">break</span>;
                <span class="enscript-keyword">case</span> <span class="enscript-reference">2</span>: <span class="enscript-keyword">while</span> ((!F.havePrecision || (i &lt; F.precision)) &amp;&amp; u[i] &amp;&amp; mDNS_VACB_Remain(s))                  <span class="enscript-comment">// Little Endian
</span>                    { c = ((a[1] &lt;&lt; 8) | a[0]) &amp; 0xFF; *s++ = (<span class="enscript-type">char</span>)(DebugIsPrint(c) ? c : <span class="enscript-string">'^'</span>); i++; a += 2; }
                    <span class="enscript-keyword">break</span>;
                }
            }
                s = mDNS_VACB;              <span class="enscript-comment">// Reset s back to the start of the buffer
</span>                <span class="enscript-keyword">break</span>;

            #<span class="enscript-keyword">if</span> TARGET_OS_MAC
            <span class="enscript-keyword">case</span> <span class="enscript-string">'@'</span>:   {       <span class="enscript-comment">// Cocoa/CoreFoundation object
</span>                CFTypeRef cfObj;
                CFStringRef cfStr;
                cfObj = (CFTypeRef) va_arg(arg, <span class="enscript-type">void</span> *);
                cfStr = (CFGetTypeID(cfObj) == CFStringGetTypeID()) ? (CFStringRef)CFRetain(cfObj) : CFCopyDescription(cfObj);
                s = mDNS_VACB;              <span class="enscript-comment">// Adjust s to point to the start of the buffer, not the end
</span>                <span class="enscript-keyword">if</span> (cfStr)
                {
                    CFRange range;
                    CFIndex m;
                    range = CFRangeMake(0, CFStringGetLength(cfStr));
                    m = 0;
                    CFStringGetBytes(cfStr, range, kCFStringEncodingUTF8, <span class="enscript-string">'^'</span>, false, (UInt8*)mDNS_VACB, (CFIndex)<span class="enscript-keyword">sizeof</span>(mDNS_VACB), &amp;m);
                    CFRelease(cfStr);
                    i = (size_t) m;
                }
                <span class="enscript-keyword">else</span>
                {
                    i = DebugSNPrintF(mDNS_VACB, <span class="enscript-keyword">sizeof</span>(mDNS_VACB), <span class="enscript-string">&quot;%s&quot;</span>, <span class="enscript-string">&quot;ERROR: &lt;invalid CF object&gt;&quot;</span> );
                }
            }
                <span class="enscript-keyword">if</span> (F.havePrecision &amp;&amp; i &gt; F.precision)                 <span class="enscript-comment">// Make sure we don't truncate in the middle of a UTF-8 character
</span>                { i = F.precision; <span class="enscript-keyword">while</span> (i&gt;0 &amp;&amp; (s[i] &amp; 0xC0) == 0x80) i--;}
                <span class="enscript-keyword">break</span>;
            #endif

            <span class="enscript-keyword">case</span> <span class="enscript-string">'m'</span>:  {        <span class="enscript-comment">// Error Message
</span>                <span class="enscript-type">long</span> err;
                <span class="enscript-keyword">if</span> (F.lSize) err = va_arg(arg, <span class="enscript-type">long</span>);
                <span class="enscript-keyword">else</span> err = va_arg(arg, <span class="enscript-type">int</span>);
                <span class="enscript-keyword">if</span> (F.hSize) err = (<span class="enscript-type">short</span>)err;
                DebugGetErrorString(err, mDNS_VACB, <span class="enscript-keyword">sizeof</span>(mDNS_VACB));
                s = mDNS_VACB;              <span class="enscript-comment">// Adjust s to point to the start of the buffer, not the end
</span>                <span class="enscript-keyword">for</span>(i=0; s[i]; i++) {}
            }
            <span class="enscript-keyword">break</span>;

            <span class="enscript-keyword">case</span> <span class="enscript-string">'H'</span>:  {        <span class="enscript-comment">// Hex Dump
</span>                <span class="enscript-type">void</span> *a = va_arg(arg, <span class="enscript-type">void</span> *);
                size_t size = (size_t)va_arg(arg, <span class="enscript-type">int</span>);
                size_t max = (size_t)va_arg(arg, <span class="enscript-type">int</span>);
                DebugFlags flags =
                    kDebugFlagsNoAddress | kDebugFlagsNoOffset | kDebugFlagsNoNewLine |
                    kDebugFlags8BitSeparator | kDebugFlagsNo32BitSeparator |
                    kDebugFlagsNo16ByteHexPad | kDebugFlagsNoByteCount;
                <span class="enscript-keyword">if</span> (F.altForm == 0) flags |= kDebugFlagsNoASCII;
                size = (max &lt; size) ? max : size;
                s = mDNS_VACB;              <span class="enscript-comment">// Adjust s to point to the start of the buffer, not the end
</span>                i = DebugHexDump(kDebugLevelMax, 0, NULL, 0, 0, NULL, 0, a, a, size, flags, mDNS_VACB, <span class="enscript-keyword">sizeof</span>(mDNS_VACB));
            }
            <span class="enscript-keyword">break</span>;

            <span class="enscript-keyword">case</span> <span class="enscript-string">'v'</span>:  {        <span class="enscript-comment">// Version
</span>                uint32_t version;
                version = va_arg(arg, <span class="enscript-type">unsigned</span> <span class="enscript-type">int</span>);
                DebugNumVersionToString(version, mDNS_VACB);
                s = mDNS_VACB;              <span class="enscript-comment">// Adjust s to point to the start of the buffer, not the end
</span>                <span class="enscript-keyword">for</span>(i=0; s[i]; i++) {}
            }
            <span class="enscript-keyword">break</span>;

            <span class="enscript-keyword">case</span> <span class="enscript-string">'n'</span>:  s = va_arg(arg, <span class="enscript-type">char</span> *);
                <span class="enscript-keyword">if</span>      (F.hSize) *(<span class="enscript-type">short</span> *) s = (<span class="enscript-type">short</span>)nwritten;
                <span class="enscript-keyword">else</span> <span class="enscript-keyword">if</span> (F.lSize) *(<span class="enscript-type">long</span>  *) s = (<span class="enscript-type">long</span>)nwritten;
                <span class="enscript-keyword">else</span> *(<span class="enscript-type">int</span>   *) s = (<span class="enscript-type">int</span>)nwritten;
                <span class="enscript-keyword">continue</span>;

            <span class="enscript-reference">default</span>:    s = mDNS_VACB;
                i = DebugSNPrintF(mDNS_VACB, <span class="enscript-keyword">sizeof</span>(mDNS_VACB), <span class="enscript-string">&quot;&lt;&lt;UNKNOWN FORMAT CONVERSION CODE %%%c&gt;&gt;&quot;</span>, c);

            <span class="enscript-keyword">case</span> <span class="enscript-string">'%'</span>:  *sbuffer++ = (<span class="enscript-type">char</span>)c;
                <span class="enscript-keyword">if</span> (++nwritten &gt;= buflen) <span class="enscript-keyword">goto</span> <span class="enscript-reference">exit</span>;
                <span class="enscript-keyword">break</span>;
            }

            <span class="enscript-keyword">if</span> (i &lt; F.fieldWidth &amp;&amp; !F.leftJustify)         <span class="enscript-comment">// Pad on the left
</span>                <span class="enscript-keyword">do</span>  {
                    *sbuffer++ = <span class="enscript-string">' '</span>;
                    <span class="enscript-keyword">if</span> (++nwritten &gt;= buflen) <span class="enscript-keyword">goto</span> <span class="enscript-reference">exit</span>;
                } <span class="enscript-keyword">while</span> (i &lt; --F.fieldWidth);

            <span class="enscript-keyword">if</span> (i &gt; buflen - nwritten)  <span class="enscript-comment">// Make sure we don't truncate in the middle of a UTF-8 character
</span>            { i = buflen - nwritten; <span class="enscript-keyword">while</span> (i&gt;0 &amp;&amp; (s[i] &amp; 0xC0) == 0x80) i--;}
            <span class="enscript-keyword">for</span> (j=0; j&lt;i; j++) *sbuffer++ = *s++;          <span class="enscript-comment">// Write the converted result
</span>            nwritten += i;
            <span class="enscript-keyword">if</span> (nwritten &gt;= buflen) <span class="enscript-keyword">goto</span> <span class="enscript-reference">exit</span>;

            <span class="enscript-keyword">for</span> (; i &lt; F.fieldWidth; i++)                   <span class="enscript-comment">// Pad on the right
</span>            {
                *sbuffer++ = <span class="enscript-string">' '</span>;
                <span class="enscript-keyword">if</span> (++nwritten &gt;= buflen) <span class="enscript-keyword">goto</span> <span class="enscript-reference">exit</span>;
            }
        }
    }
<span class="enscript-reference">exit</span>:
    *sbuffer++ = 0;
    <span class="enscript-keyword">return</span>(nwritten);
}

<span class="enscript-comment">//===========================================================================================================================
</span><span class="enscript-comment">//	DebugGetErrorString
</span><span class="enscript-comment">//===========================================================================================================================
</span>
DEBUG_EXPORT <span class="enscript-type">const</span> <span class="enscript-type">char</span> *   <span class="enscript-function-name">DebugGetErrorString</span>( int_least32_t inErrorCode, <span class="enscript-type">char</span> *inBuffer, size_t inBufferSize )
{
    <span class="enscript-type">const</span> <span class="enscript-type">char</span> *        s;
    <span class="enscript-type">char</span> *              dst;
    <span class="enscript-type">char</span> *              end;
#<span class="enscript-reference">if</span> ( <span class="enscript-variable-name">TARGET_OS_WIN32</span> &amp;&amp; !<span class="enscript-variable-name">TARGET_OS_WINDOWS_CE</span> )
    <span class="enscript-type">char</span> buffer[ 256 ];
#<span class="enscript-reference">endif</span>

    <span class="enscript-keyword">switch</span>( inErrorCode )
    {
        #define CaseErrorString( X, STR )                   <span class="enscript-keyword">case</span> <span class="enscript-reference">X</span>: s = STR; <span class="enscript-keyword">break</span>
        #define CaseErrorStringify( X )                     <span class="enscript-keyword">case</span> <span class="enscript-reference">X</span>: s = # X; <span class="enscript-keyword">break</span>
        #define CaseErrorStringifyHardCode( VALUE, X )      <span class="enscript-keyword">case</span> <span class="enscript-reference">VALUE</span>: s = # X; <span class="enscript-keyword">break</span>

        <span class="enscript-comment">// General Errors
</span>
        CaseErrorString( 0,  <span class="enscript-string">&quot;no error&quot;</span> );
        CaseErrorString( 1,  <span class="enscript-string">&quot;in-progress/waiting&quot;</span> );
        CaseErrorString( -1, <span class="enscript-string">&quot;catch-all unknown error&quot;</span> );

        <span class="enscript-comment">// ACP Errors
</span>
        CaseErrorStringifyHardCode( -2,  kACPBadRequestErr );
        CaseErrorStringifyHardCode( -3,  kACPNoMemoryErr );
        CaseErrorStringifyHardCode( -4,  kACPBadParamErr );
        CaseErrorStringifyHardCode( -5,  kACPNotFoundErr );
        CaseErrorStringifyHardCode( -6,  kACPBadChecksumErr );
        CaseErrorStringifyHardCode( -7,  kACPCommandNotHandledErr );
        CaseErrorStringifyHardCode( -8,  kACPNetworkErr );
        CaseErrorStringifyHardCode( -9,  kACPDuplicateCommandHandlerErr );
        CaseErrorStringifyHardCode( -10, kACPUnknownPropertyErr );
        CaseErrorStringifyHardCode( -11, kACPImmutablePropertyErr );
        CaseErrorStringifyHardCode( -12, kACPBadPropertyValueErr );
        CaseErrorStringifyHardCode( -13, kACPNoResourcesErr );
        CaseErrorStringifyHardCode( -14, kACPBadOptionErr );
        CaseErrorStringifyHardCode( -15, kACPBadSizeErr );
        CaseErrorStringifyHardCode( -16, kACPBadPasswordErr );
        CaseErrorStringifyHardCode( -17, kACPNotInitializedErr );
        CaseErrorStringifyHardCode( -18, kACPNonReadablePropertyErr );
        CaseErrorStringifyHardCode( -19, kACPBadVersionErr );
        CaseErrorStringifyHardCode( -20, kACPBadSignatureErr );
        CaseErrorStringifyHardCode( -21, kACPBadIndexErr );
        CaseErrorStringifyHardCode( -22, kACPUnsupportedErr );
        CaseErrorStringifyHardCode( -23, kACPInUseErr );
        CaseErrorStringifyHardCode( -24, kACPParamCountErr );
        CaseErrorStringifyHardCode( -25, kACPIDErr );
        CaseErrorStringifyHardCode( -26, kACPFormatErr );
        CaseErrorStringifyHardCode( -27, kACPUnknownUserErr );
        CaseErrorStringifyHardCode( -28, kACPAccessDeniedErr );
        CaseErrorStringifyHardCode( -29, kACPIncorrectFWErr );

        <span class="enscript-comment">// Common Services Errors
</span>
        CaseErrorStringify( kUnknownErr );
        CaseErrorStringify( kOptionErr );
        CaseErrorStringify( kSelectorErr );
        CaseErrorStringify( kExecutionStateErr );
        CaseErrorStringify( kPathErr );
        CaseErrorStringify( kParamErr );
        CaseErrorStringify( kParamCountErr );
        CaseErrorStringify( kCommandErr );
        CaseErrorStringify( kIDErr );
        CaseErrorStringify( kStateErr );
        CaseErrorStringify( kRangeErr );
        CaseErrorStringify( kRequestErr );
        CaseErrorStringify( kResponseErr );
        CaseErrorStringify( kChecksumErr );
        CaseErrorStringify( kNotHandledErr );
        CaseErrorStringify( kVersionErr );
        CaseErrorStringify( kSignatureErr );
        CaseErrorStringify( kFormatErr );
        CaseErrorStringify( kNotInitializedErr );
        CaseErrorStringify( kAlreadyInitializedErr );
        CaseErrorStringify( kNotInUseErr );
        CaseErrorStringify( kInUseErr );
        CaseErrorStringify( kTimeoutErr );
        CaseErrorStringify( kCanceledErr );
        CaseErrorStringify( kAlreadyCanceledErr );
        CaseErrorStringify( kCannotCancelErr );
        CaseErrorStringify( kDeletedErr );
        CaseErrorStringify( kNotFoundErr );
        CaseErrorStringify( kNoMemoryErr );
        CaseErrorStringify( kNoResourcesErr );
        CaseErrorStringify( kDuplicateErr );
        CaseErrorStringify( kImmutableErr );
        CaseErrorStringify( kUnsupportedDataErr );
        CaseErrorStringify( kIntegrityErr );
        CaseErrorStringify( kIncompatibleErr );
        CaseErrorStringify( kUnsupportedErr );
        CaseErrorStringify( kUnexpectedErr );
        CaseErrorStringify( kValueErr );
        CaseErrorStringify( kNotReadableErr );
        CaseErrorStringify( kNotWritableErr );
        CaseErrorStringify( kBadReferenceErr );
        CaseErrorStringify( kFlagErr );
        CaseErrorStringify( kMalformedErr );
        CaseErrorStringify( kSizeErr );
        CaseErrorStringify( kNameErr );
        CaseErrorStringify( kNotReadyErr );
        CaseErrorStringify( kReadErr );
        CaseErrorStringify( kWriteErr );
        CaseErrorStringify( kMismatchErr );
        CaseErrorStringify( kDateErr );
        CaseErrorStringify( kUnderrunErr );
        CaseErrorStringify( kOverrunErr );
        CaseErrorStringify( kEndingErr );
        CaseErrorStringify( kConnectionErr );
        CaseErrorStringify( kAuthenticationErr );
        CaseErrorStringify( kOpenErr );
        CaseErrorStringify( kTypeErr );
        CaseErrorStringify( kSkipErr );
        CaseErrorStringify( kNoAckErr );
        CaseErrorStringify( kCollisionErr );
        CaseErrorStringify( kBackoffErr );
        CaseErrorStringify( kNoAddressAckErr );
        CaseErrorStringify( kBusyErr );
        CaseErrorStringify( kNoSpaceErr );

        <span class="enscript-comment">// mDNS/DNS-SD Errors
</span>
        CaseErrorStringifyHardCode( -65537, mStatus_UnknownErr );
        CaseErrorStringifyHardCode( -65538, mStatus_NoSuchNameErr );
        CaseErrorStringifyHardCode( -65539, mStatus_NoMemoryErr );
        CaseErrorStringifyHardCode( -65540, mStatus_BadParamErr );
        CaseErrorStringifyHardCode( -65541, mStatus_BadReferenceErr );
        CaseErrorStringifyHardCode( -65542, mStatus_BadStateErr );
        CaseErrorStringifyHardCode( -65543, mStatus_BadFlagsErr );
        CaseErrorStringifyHardCode( -65544, mStatus_UnsupportedErr );
        CaseErrorStringifyHardCode( -65545, mStatus_NotInitializedErr );
        CaseErrorStringifyHardCode( -65546, mStatus_NoCache );
        CaseErrorStringifyHardCode( -65547, mStatus_AlreadyRegistered );
        CaseErrorStringifyHardCode( -65548, mStatus_NameConflict );
        CaseErrorStringifyHardCode( -65549, mStatus_Invalid );
        CaseErrorStringifyHardCode( -65550, mStatus_GrowCache );
        CaseErrorStringifyHardCode( -65551, mStatus_Incompatible );
        CaseErrorStringifyHardCode( -65552, mStatus_BadInterfaceErr );
        CaseErrorStringifyHardCode( -65791, mStatus_ConfigChanged );
        CaseErrorStringifyHardCode( -65792, mStatus_MemFree );

        <span class="enscript-comment">// RSP Errors
</span>
        CaseErrorStringifyHardCode( -400000, kRSPUnknownErr );
        CaseErrorStringifyHardCode( -400050, kRSPParamErr );
        CaseErrorStringifyHardCode( -400108, kRSPNoMemoryErr );
        CaseErrorStringifyHardCode( -405246, kRSPRangeErr );
        CaseErrorStringifyHardCode( -409057, kRSPSizeErr );
        CaseErrorStringifyHardCode( -400200, kRSPHardwareErr );
        CaseErrorStringifyHardCode( -401712, kRSPTimeoutErr );
        CaseErrorStringifyHardCode( -402053, kRSPUnsupportedErr );
        CaseErrorStringifyHardCode( -402419, kRSPIDErr );
        CaseErrorStringifyHardCode( -403165, kRSPFlagErr );
        CaseErrorString(            -200000, <span class="enscript-string">&quot;kRSPControllerStatusBase - 0x50&quot;</span> );
        CaseErrorString(            -200080, <span class="enscript-string">&quot;kRSPCommandSucceededErr - 0x50&quot;</span> );
        CaseErrorString(            -200001, <span class="enscript-string">&quot;kRSPCommandFailedErr - 0x01&quot;</span> );
        CaseErrorString(            -200051, <span class="enscript-string">&quot;kRSPChecksumErr - 0x33&quot;</span> );
        CaseErrorString(            -200132, <span class="enscript-string">&quot;kRSPCommandTimeoutErr - 0x84&quot;</span> );
        CaseErrorString(            -200034, <span class="enscript-string">&quot;kRSPPasswordRequiredErr - 0x22 OBSOLETE&quot;</span> );
        CaseErrorString(            -200128, <span class="enscript-string">&quot;kRSPCanceledErr - 0x02 Async&quot;</span> );

        <span class="enscript-comment">// XML Errors
</span>
        CaseErrorStringifyHardCode( -100043, kXMLNotFoundErr );
        CaseErrorStringifyHardCode( -100050, kXMLParamErr );
        CaseErrorStringifyHardCode( -100108, kXMLNoMemoryErr );
        CaseErrorStringifyHardCode( -100206, kXMLFormatErr );
        CaseErrorStringifyHardCode( -100586, kXMLNoRootElementErr );
        CaseErrorStringifyHardCode( -101703, kXMLWrongDataTypeErr );
        CaseErrorStringifyHardCode( -101726, kXMLKeyErr );
        CaseErrorStringifyHardCode( -102053, kXMLUnsupportedErr );
        CaseErrorStringifyHardCode( -102063, kXMLMissingElementErr );
        CaseErrorStringifyHardCode( -103026, kXMLParseErr );
        CaseErrorStringifyHardCode( -103159, kXMLBadDataErr );
        CaseErrorStringifyHardCode( -103170, kXMLBadNameErr );
        CaseErrorStringifyHardCode( -105246, kXMLRangeErr );
        CaseErrorStringifyHardCode( -105251, kXMLUnknownElementErr );
        CaseErrorStringifyHardCode( -108739, kXMLMalformedInputErr );
        CaseErrorStringifyHardCode( -109057, kXMLBadSizeErr );
        CaseErrorStringifyHardCode( -101730, kXMLMissingChildElementErr );
        CaseErrorStringifyHardCode( -102107, kXMLMissingParentElementErr );
        CaseErrorStringifyHardCode( -130587, kXMLNonRootElementErr );
        CaseErrorStringifyHardCode( -102015, kXMLDateErr );

    #<span class="enscript-keyword">if</span> ( __MACH__ )

        <span class="enscript-comment">// Mach Errors
</span>
        CaseErrorStringifyHardCode( 0x00002000, MACH_MSG_IPC_SPACE );
        CaseErrorStringifyHardCode( 0x00001000, MACH_MSG_VM_SPACE );
        CaseErrorStringifyHardCode( 0x00000800, MACH_MSG_IPC_KERNEL );
        CaseErrorStringifyHardCode( 0x00000400, MACH_MSG_VM_KERNEL );
        CaseErrorStringifyHardCode( 0x10000001, MACH_SEND_IN_PROGRESS );
        CaseErrorStringifyHardCode( 0x10000002, MACH_SEND_INVALID_DATA );
        CaseErrorStringifyHardCode( 0x10000003, MACH_SEND_INVALID_DEST );
        CaseErrorStringifyHardCode( 0x10000004, MACH_SEND_TIMED_OUT );
        CaseErrorStringifyHardCode( 0x10000007, MACH_SEND_INTERRUPTED );
        CaseErrorStringifyHardCode( 0x10000008, MACH_SEND_MSG_TOO_SMALL );
        CaseErrorStringifyHardCode( 0x10000009, MACH_SEND_INVALID_REPLY );
        CaseErrorStringifyHardCode( 0x1000000A, MACH_SEND_INVALID_RIGHT );
        CaseErrorStringifyHardCode( 0x1000000B, MACH_SEND_INVALID_NOTIFY );
        CaseErrorStringifyHardCode( 0x1000000C, MACH_SEND_INVALID_MEMORY );
        CaseErrorStringifyHardCode( 0x1000000D, MACH_SEND_NO_BUFFER );
        CaseErrorStringifyHardCode( 0x1000000E, MACH_SEND_TOO_LARGE );
        CaseErrorStringifyHardCode( 0x1000000F, MACH_SEND_INVALID_TYPE );
        CaseErrorStringifyHardCode( 0x10000010, MACH_SEND_INVALID_HEADER );
        CaseErrorStringifyHardCode( 0x10000011, MACH_SEND_INVALID_TRAILER );
        CaseErrorStringifyHardCode( 0x10000015, MACH_SEND_INVALID_RT_OOL_SIZE );
        CaseErrorStringifyHardCode( 0x10004001, MACH_RCV_IN_PROGRESS );
        CaseErrorStringifyHardCode( 0x10004002, MACH_RCV_INVALID_NAME );
        CaseErrorStringifyHardCode( 0x10004003, MACH_RCV_TIMED_OUT );
        CaseErrorStringifyHardCode( 0x10004004, MACH_RCV_TOO_LARGE );
        CaseErrorStringifyHardCode( 0x10004005, MACH_RCV_INTERRUPTED );
        CaseErrorStringifyHardCode( 0x10004006, MACH_RCV_PORT_CHANGED );
        CaseErrorStringifyHardCode( 0x10004007, MACH_RCV_INVALID_NOTIFY );
        CaseErrorStringifyHardCode( 0x10004008, MACH_RCV_INVALID_DATA );
        CaseErrorStringifyHardCode( 0x10004009, MACH_RCV_PORT_DIED );
        CaseErrorStringifyHardCode( 0x1000400A, MACH_RCV_IN_SET );
        CaseErrorStringifyHardCode( 0x1000400B, MACH_RCV_HEADER_ERROR );
        CaseErrorStringifyHardCode( 0x1000400C, MACH_RCV_BODY_ERROR );
        CaseErrorStringifyHardCode( 0x1000400D, MACH_RCV_INVALID_TYPE );
        CaseErrorStringifyHardCode( 0x1000400E, MACH_RCV_SCATTER_SMALL );
        CaseErrorStringifyHardCode( 0x1000400F, MACH_RCV_INVALID_TRAILER );
        CaseErrorStringifyHardCode( 0x10004011, MACH_RCV_IN_PROGRESS_TIMED );

        <span class="enscript-comment">// Mach OSReturn Errors
</span>
        CaseErrorStringifyHardCode( 0xDC000001, kOSReturnError );
        CaseErrorStringifyHardCode( 0xDC004001, kOSMetaClassInternal );
        CaseErrorStringifyHardCode( 0xDC004002, kOSMetaClassHasInstances );
        CaseErrorStringifyHardCode( 0xDC004003, kOSMetaClassNoInit );
        CaseErrorStringifyHardCode( 0xDC004004, kOSMetaClassNoTempData );
        CaseErrorStringifyHardCode( 0xDC004005, kOSMetaClassNoDicts );
        CaseErrorStringifyHardCode( 0xDC004006, kOSMetaClassNoKModSet );
        CaseErrorStringifyHardCode( 0xDC004007, kOSMetaClassNoInsKModSet );
        CaseErrorStringifyHardCode( 0xDC004008, kOSMetaClassNoSuper );
        CaseErrorStringifyHardCode( 0xDC004009, kOSMetaClassInstNoSuper );
        CaseErrorStringifyHardCode( 0xDC00400A, kOSMetaClassDuplicateClass );

        <span class="enscript-comment">// IOKit Errors
</span>
        CaseErrorStringifyHardCode( 0xE00002BC, kIOReturnError );
        CaseErrorStringifyHardCode( 0xE00002BD, kIOReturnNoMemory );
        CaseErrorStringifyHardCode( 0xE00002BE, kIOReturnNoResources );
        CaseErrorStringifyHardCode( 0xE00002BF, kIOReturnIPCError );
        CaseErrorStringifyHardCode( 0xE00002C0, kIOReturnNoDevice );
        CaseErrorStringifyHardCode( 0xE00002C1, kIOReturnNotPrivileged );
        CaseErrorStringifyHardCode( 0xE00002C2, kIOReturnBadArgument );
        CaseErrorStringifyHardCode( 0xE00002C3, kIOReturnLockedRead );
        CaseErrorStringifyHardCode( 0xE00002C4, kIOReturnLockedWrite );
        CaseErrorStringifyHardCode( 0xE00002C5, kIOReturnExclusiveAccess );
        CaseErrorStringifyHardCode( 0xE00002C6, kIOReturnBadMessageID );
        CaseErrorStringifyHardCode( 0xE00002C7, kIOReturnUnsupported );
        CaseErrorStringifyHardCode( 0xE00002C8, kIOReturnVMError );
        CaseErrorStringifyHardCode( 0xE00002C9, kIOReturnInternalError );
        CaseErrorStringifyHardCode( 0xE00002CA, kIOReturnIOError );
        CaseErrorStringifyHardCode( 0xE00002CC, kIOReturnCannotLock );
        CaseErrorStringifyHardCode( 0xE00002CD, kIOReturnNotOpen );
        CaseErrorStringifyHardCode( 0xE00002CE, kIOReturnNotReadable );
        CaseErrorStringifyHardCode( 0xE00002CF, kIOReturnNotWritable );
        CaseErrorStringifyHardCode( 0xE00002D0, kIOReturnNotAligned );
        CaseErrorStringifyHardCode( 0xE00002D1, kIOReturnBadMedia );
        CaseErrorStringifyHardCode( 0xE00002D2, kIOReturnStillOpen );
        CaseErrorStringifyHardCode( 0xE00002D3, kIOReturnRLDError );
        CaseErrorStringifyHardCode( 0xE00002D4, kIOReturnDMAError );
        CaseErrorStringifyHardCode( 0xE00002D5, kIOReturnBusy );
        CaseErrorStringifyHardCode( 0xE00002D6, kIOReturnTimeout );
        CaseErrorStringifyHardCode( 0xE00002D7, kIOReturnOffline );
        CaseErrorStringifyHardCode( 0xE00002D8, kIOReturnNotReady );
        CaseErrorStringifyHardCode( 0xE00002D9, kIOReturnNotAttached );
        CaseErrorStringifyHardCode( 0xE00002DA, kIOReturnNoChannels );
        CaseErrorStringifyHardCode( 0xE00002DB, kIOReturnNoSpace );
        CaseErrorStringifyHardCode( 0xE00002DD, kIOReturnPortExists );
        CaseErrorStringifyHardCode( 0xE00002DE, kIOReturnCannotWire );
        CaseErrorStringifyHardCode( 0xE00002DF, kIOReturnNoInterrupt );
        CaseErrorStringifyHardCode( 0xE00002E0, kIOReturnNoFrames );
        CaseErrorStringifyHardCode( 0xE00002E1, kIOReturnMessageTooLarge );
        CaseErrorStringifyHardCode( 0xE00002E2, kIOReturnNotPermitted );
        CaseErrorStringifyHardCode( 0xE00002E3, kIOReturnNoPower );
        CaseErrorStringifyHardCode( 0xE00002E4, kIOReturnNoMedia );
        CaseErrorStringifyHardCode( 0xE00002E5, kIOReturnUnformattedMedia );
        CaseErrorStringifyHardCode( 0xE00002E6, kIOReturnUnsupportedMode );
        CaseErrorStringifyHardCode( 0xE00002E7, kIOReturnUnderrun );
        CaseErrorStringifyHardCode( 0xE00002E8, kIOReturnOverrun );
        CaseErrorStringifyHardCode( 0xE00002E9, kIOReturnDeviceError     );
        CaseErrorStringifyHardCode( 0xE00002EA, kIOReturnNoCompletion    );
        CaseErrorStringifyHardCode( 0xE00002EB, kIOReturnAborted     );
        CaseErrorStringifyHardCode( 0xE00002EC, kIOReturnNoBandwidth     );
        CaseErrorStringifyHardCode( 0xE00002ED, kIOReturnNotResponding   );
        CaseErrorStringifyHardCode( 0xE00002EE, kIOReturnIsoTooOld   );
        CaseErrorStringifyHardCode( 0xE00002EF, kIOReturnIsoTooNew   );
        CaseErrorStringifyHardCode( 0xE00002F0, kIOReturnNotFound );
        CaseErrorStringifyHardCode( 0xE0000001, kIOReturnInvalid );

        <span class="enscript-comment">// IOKit FireWire Errors
</span>
        CaseErrorStringifyHardCode( 0xE0008010, kIOFireWireResponseBase );
        CaseErrorStringifyHardCode( 0xE0008020, kIOFireWireBusReset );
        CaseErrorStringifyHardCode( 0xE0008001, kIOConfigNoEntry );
        CaseErrorStringifyHardCode( 0xE0008002, kIOFireWirePending );
        CaseErrorStringifyHardCode( 0xE0008003, kIOFireWireLastDCLToken );
        CaseErrorStringifyHardCode( 0xE0008004, kIOFireWireConfigROMInvalid );
        CaseErrorStringifyHardCode( 0xE0008005, kIOFireWireAlreadyRegistered );
        CaseErrorStringifyHardCode( 0xE0008006, kIOFireWireMultipleTalkers );
        CaseErrorStringifyHardCode( 0xE0008007, kIOFireWireChannelActive );
        CaseErrorStringifyHardCode( 0xE0008008, kIOFireWireNoListenerOrTalker );
        CaseErrorStringifyHardCode( 0xE0008009, kIOFireWireNoChannels );
        CaseErrorStringifyHardCode( 0xE000800A, kIOFireWireChannelNotAvailable );
        CaseErrorStringifyHardCode( 0xE000800B, kIOFireWireSeparateBus );
        CaseErrorStringifyHardCode( 0xE000800C, kIOFireWireBadSelfIDs );
        CaseErrorStringifyHardCode( 0xE000800D, kIOFireWireLowCableVoltage );
        CaseErrorStringifyHardCode( 0xE000800E, kIOFireWireInsufficientPower );
        CaseErrorStringifyHardCode( 0xE000800F, kIOFireWireOutOfTLabels );
        CaseErrorStringifyHardCode( 0xE0008101, kIOFireWireBogusDCLProgram );
        CaseErrorStringifyHardCode( 0xE0008102, kIOFireWireTalkingAndListening );
        CaseErrorStringifyHardCode( 0xE0008103, kIOFireWireHardwareSlept );
        CaseErrorStringifyHardCode( 0xE00087D0, kIOFWMessageServiceIsRequestingClose );
        CaseErrorStringifyHardCode( 0xE00087D1, kIOFWMessagePowerStateChanged );
        CaseErrorStringifyHardCode( 0xE00087D2, kIOFWMessageTopologyChanged );

        <span class="enscript-comment">// IOKit USB Errors
</span>
        CaseErrorStringifyHardCode( 0xE0004061, kIOUSBUnknownPipeErr );
        CaseErrorStringifyHardCode( 0xE0004060, kIOUSBTooManyPipesErr );
        CaseErrorStringifyHardCode( 0xE000405F, kIOUSBNoAsyncPortErr );
        CaseErrorStringifyHardCode( 0xE000405E, kIOUSBNotEnoughPipesErr );
        CaseErrorStringifyHardCode( 0xE000405D, kIOUSBNotEnoughPowerErr );
        CaseErrorStringifyHardCode( 0xE0004057, kIOUSBEndpointNotFound );
        CaseErrorStringifyHardCode( 0xE0004056, kIOUSBConfigNotFound );
        CaseErrorStringifyHardCode( 0xE0004051, kIOUSBTransactionTimeout );
        CaseErrorStringifyHardCode( 0xE0004050, kIOUSBTransactionReturned );
        CaseErrorStringifyHardCode( 0xE000404F, kIOUSBPipeStalled );
        CaseErrorStringifyHardCode( 0xE000404E, kIOUSBInterfaceNotFound );
        CaseErrorStringifyHardCode( 0xE000404D, kIOUSBLowLatencyBufferNotPreviouslyAllocated );
        CaseErrorStringifyHardCode( 0xE000404C, kIOUSBLowLatencyFrameListNotPreviouslyAllocated );
        CaseErrorStringifyHardCode( 0xE000404B, kIOUSBHighSpeedSplitError );
        CaseErrorStringifyHardCode( 0xE0004010, kIOUSBLinkErr );
        CaseErrorStringifyHardCode( 0xE000400F, kIOUSBNotSent2Err );
        CaseErrorStringifyHardCode( 0xE000400E, kIOUSBNotSent1Err );
        CaseErrorStringifyHardCode( 0xE000400D, kIOUSBBufferUnderrunErr );
        CaseErrorStringifyHardCode( 0xE000400C, kIOUSBBufferOverrunErr );
        CaseErrorStringifyHardCode( 0xE000400B, kIOUSBReserved2Err );
        CaseErrorStringifyHardCode( 0xE000400A, kIOUSBReserved1Err );
        CaseErrorStringifyHardCode( 0xE0004007, kIOUSBWrongPIDErr );
        CaseErrorStringifyHardCode( 0xE0004006, kIOUSBPIDCheckErr );
        CaseErrorStringifyHardCode( 0xE0004003, kIOUSBDataToggleErr );
        CaseErrorStringifyHardCode( 0xE0004002, kIOUSBBitstufErr );
        CaseErrorStringifyHardCode( 0xE0004001, kIOUSBCRCErr );

    #endif  <span class="enscript-comment">// __MACH__
</span>
    <span class="enscript-comment">// Other Errors
</span>
    <span class="enscript-reference">default</span>:
        s = NULL;
            #<span class="enscript-keyword">if</span> ( TARGET_OS_WIN32 &amp;&amp; !TARGET_OS_WINDOWS_CE )
        <span class="enscript-keyword">if</span>( inBuffer &amp;&amp; ( inBufferSize &gt; 0 ) )
        {
            DWORD n;

            n = FormatMessageA( FORMAT_MESSAGE_FROM_SYSTEM | FORMAT_MESSAGE_IGNORE_INSERTS, NULL, (DWORD) inErrorCode,
                                MAKELANGID( LANG_NEUTRAL, SUBLANG_DEFAULT ), buffer, <span class="enscript-keyword">sizeof</span>( buffer ), NULL );
            <span class="enscript-keyword">if</span>( n &gt; 0 )
            {
                <span class="enscript-comment">// Remove any trailing CR's or LF's since some messages have them.
</span>
                <span class="enscript-keyword">while</span>( ( n &gt; 0 ) &amp;&amp; isspace( ( (<span class="enscript-type">unsigned</span> <span class="enscript-type">char</span> *) buffer )[ n - 1 ] ) )
                {
                    buffer[ --n ] = <span class="enscript-string">'\0'</span>;
                }
                s = buffer;
            }
        }
            #endif

        <span class="enscript-keyword">if</span>( !s )
        {
                #<span class="enscript-keyword">if</span> ( !TARGET_API_MAC_OSX_KERNEL &amp;&amp; !TARGET_OS_WINDOWS_CE )
            s = strerror( inErrorCode );
                #endif
            <span class="enscript-keyword">if</span>( !s )
            {
                s = <span class="enscript-string">&quot;&lt;unknown error code&gt;&quot;</span>;
            }
        }
        <span class="enscript-keyword">break</span>;
    }

    <span class="enscript-comment">// Copy the string to the output buffer. If no buffer is supplied or it is empty, return an empty string.
</span>
    <span class="enscript-keyword">if</span>( inBuffer &amp;&amp; ( inBufferSize &gt; 0 ) )
    {
        dst = inBuffer;
        end = dst + ( inBufferSize - 1 );
        <span class="enscript-keyword">while</span>( ( ( end - dst ) &gt; 0 ) &amp;&amp; ( *s != <span class="enscript-string">'\0'</span> ) )
        {
            *dst++ = *s++;
        }
        *dst = <span class="enscript-string">'\0'</span>;
        s = inBuffer;
    }
    <span class="enscript-keyword">return</span>( s );
}

<span class="enscript-comment">//===========================================================================================================================
</span><span class="enscript-comment">//	DebugHexDump
</span><span class="enscript-comment">//===========================================================================================================================
</span>
DEBUG_EXPORT size_t
<span class="enscript-function-name">DebugHexDump</span>(
    DebugLevel inLevel,
    <span class="enscript-type">int</span> inIndent,
    <span class="enscript-type">const</span> <span class="enscript-type">char</span> *    inLabel,
    size_t inLabelSize,
    <span class="enscript-type">int</span> inLabelMinWidth,
    <span class="enscript-type">const</span> <span class="enscript-type">char</span> *    inType,
    size_t inTypeSize,
    <span class="enscript-type">const</span> <span class="enscript-type">void</span> *    inDataStart,
    <span class="enscript-type">const</span> <span class="enscript-type">void</span> *    inData,
    size_t inDataSize,
    DebugFlags inFlags,
    <span class="enscript-type">char</span> *          outBuffer,
    size_t inBufferSize )
{
    <span class="enscript-type">static</span> <span class="enscript-type">const</span> <span class="enscript-type">char</span> kHexChars[] = <span class="enscript-string">&quot;0123456789ABCDEF&quot;</span>;
    <span class="enscript-type">const</span> uint8_t *         start;
    <span class="enscript-type">const</span> uint8_t *         src;
    <span class="enscript-type">char</span> *                  dst;
    <span class="enscript-type">char</span> *                  end;
    size_t n;
    <span class="enscript-type">int</span> offset;
    <span class="enscript-type">int</span> width;
    <span class="enscript-type">const</span> <span class="enscript-type">char</span> *            newline;
    <span class="enscript-type">char</span> separator[ 8 ];
    <span class="enscript-type">char</span> *                  s;

    DEBUG_UNUSED( inType );
    DEBUG_UNUSED( inTypeSize );

    <span class="enscript-comment">// Set up the function-wide variables.
</span>
    <span class="enscript-keyword">if</span>( inLabelSize == kSizeCString )
    {
        inLabelSize = strlen( inLabel );
    }
    start   = (<span class="enscript-type">const</span> uint8_t *) inData;
    src     = start;
    dst     = outBuffer;
    end     = dst + inBufferSize;
    offset  = (<span class="enscript-type">int</span>)( (intptr_t) inData - (intptr_t) inDataStart );
    width   = ( (<span class="enscript-type">int</span>) inLabelSize &gt; inLabelMinWidth ) ? (<span class="enscript-type">int</span>) inLabelSize : inLabelMinWidth;
    newline = ( inFlags &amp; kDebugFlagsNoNewLine ) ? <span class="enscript-string">&quot;&quot;</span> : <span class="enscript-string">&quot;\n&quot;</span>;

    <span class="enscript-comment">// Set up the separator string. This is used to insert spaces on subsequent &quot;lines&quot; when not using newlines.
</span>
    s = separator;
    <span class="enscript-keyword">if</span>( inFlags &amp; kDebugFlagsNoNewLine )
    {
        <span class="enscript-keyword">if</span>( inFlags &amp; kDebugFlags8BitSeparator )
        {
            *s++ = <span class="enscript-string">' '</span>;
        }
        <span class="enscript-keyword">if</span>( inFlags &amp; kDebugFlags16BitSeparator )
        {
            *s++ = <span class="enscript-string">' '</span>;
        }
        <span class="enscript-keyword">if</span>( !( inFlags &amp; kDebugFlagsNo32BitSeparator ) )
        {
            *s++ = <span class="enscript-string">' '</span>;
        }
        check( ( (size_t)( s - separator ) ) &lt; <span class="enscript-keyword">sizeof</span>( separator ) );
    }
    *s = <span class="enscript-string">'\0'</span>;

    <span class="enscript-keyword">for</span>( ;; )
    {
        <span class="enscript-type">char</span> prefixString[ 32 ];
        <span class="enscript-type">char</span> hexString[ 64 ];
        <span class="enscript-type">char</span> asciiString[ 32 ];
        <span class="enscript-type">char</span> byteCountString[ 32 ];
        <span class="enscript-type">int</span> c;
        size_t chunkSize;
        size_t i;

        <span class="enscript-comment">// If this is a label-only item (i.e. no data), print the label (accounting for prefix string spacing) and exit.
</span>
        <span class="enscript-keyword">if</span>( inDataSize == 0 )
        {
            <span class="enscript-keyword">if</span>( inLabel &amp;&amp; ( inLabelSize &gt; 0 ) )
            {
                width = 0;
                <span class="enscript-keyword">if</span>( !( inFlags &amp; kDebugFlagsNoAddress ) )
                {
                    width += 8;         <span class="enscript-comment">// &quot;00000000&quot;
</span>                    <span class="enscript-keyword">if</span>( !( inFlags &amp; kDebugFlagsNoOffset ) )
                    {
                        width += 1;     <span class="enscript-comment">// &quot;+&quot;
</span>                    }
                }
                <span class="enscript-keyword">if</span>( inFlags &amp; kDebugFlags32BitOffset )
                {
                    width += 8;         <span class="enscript-comment">// &quot;00000000&quot;
</span>                }
                <span class="enscript-keyword">else</span> <span class="enscript-keyword">if</span>( !( inFlags &amp; kDebugFlagsNoOffset ) )
                {
                    width += 4;         <span class="enscript-comment">// &quot;0000&quot;
</span>                }

                <span class="enscript-keyword">if</span>( outBuffer )
                {
                    dst += DebugSNPrintF( dst, (size_t)( end - dst ), <span class="enscript-string">&quot;%*s&quot;</span> <span class="enscript-string">&quot;%-*.*s&quot;</span> <span class="enscript-string">&quot;%.*s&quot;</span> <span class="enscript-string">&quot;%s&quot;</span>,
                                          width, <span class="enscript-string">&quot;&quot;</span>,
                                          ( width &gt; 0 ) ? <span class="enscript-string">&quot;: &quot;</span> : <span class="enscript-string">&quot;&quot;</span>,
                                          width, (<span class="enscript-type">int</span>) inLabelSize, inLabel,
                                          newline );
                }
                <span class="enscript-keyword">else</span>
                {
                    dst += DebugPrintF( inLevel, <span class="enscript-string">&quot;%*s&quot;</span> <span class="enscript-string">&quot;%-*.*s&quot;</span> <span class="enscript-string">&quot;%.*s&quot;</span> <span class="enscript-string">&quot;%s&quot;</span>,
                                        width, <span class="enscript-string">&quot;&quot;</span>,
                                        ( width &gt; 0 ) ? <span class="enscript-string">&quot;: &quot;</span> : <span class="enscript-string">&quot;&quot;</span>,
                                        width, (<span class="enscript-type">int</span>) inLabelSize, inLabel,
                                        newline );
                }
            }
            <span class="enscript-keyword">break</span>;
        }

        <span class="enscript-comment">// Build the prefix string. It will be in one of the following formats:
</span>        <span class="enscript-comment">//
</span>        <span class="enscript-comment">// 1) &quot;00000000+0000[0000]&quot;	(address and offset)
</span>        <span class="enscript-comment">// 2) &quot;00000000&quot;			(address only)
</span>        <span class="enscript-comment">// 3) &quot;0000[0000]&quot;			(offset only)
</span>        <span class="enscript-comment">// 4) &quot;&quot;					(no address or offset)
</span>        <span class="enscript-comment">//
</span>        <span class="enscript-comment">// Note: If we're printing multiple &quot;lines&quot;, but not printing newlines, a space is used to separate.
</span>
        s = prefixString;
        <span class="enscript-keyword">if</span>( !( inFlags &amp; kDebugFlagsNoAddress ) )
        {
            *s++ = kHexChars[ ( ( (uintptr_t) src ) &gt;&gt; 28 ) &amp; 0xF ];
            *s++ = kHexChars[ ( ( (uintptr_t) src ) &gt;&gt; 24 ) &amp; 0xF ];
            *s++ = kHexChars[ ( ( (uintptr_t) src ) &gt;&gt; 20 ) &amp; 0xF ];
            *s++ = kHexChars[ ( ( (uintptr_t) src ) &gt;&gt; 16 ) &amp; 0xF ];
            *s++ = kHexChars[ ( ( (uintptr_t) src ) &gt;&gt; 12 ) &amp; 0xF ];
            *s++ = kHexChars[ ( ( (uintptr_t) src ) &gt;&gt;  8 ) &amp; 0xF ];
            *s++ = kHexChars[ ( ( (uintptr_t) src ) &gt;&gt;  4 ) &amp; 0xF ];
            *s++ = kHexChars[   ( (uintptr_t) src )         &amp; 0xF ];

            <span class="enscript-keyword">if</span>( !( inFlags &amp; kDebugFlagsNoOffset ) )
            {
                *s++ = <span class="enscript-string">'+'</span>;
            }
        }
        <span class="enscript-keyword">if</span>( !( inFlags &amp; kDebugFlagsNoOffset ) )
        {
            <span class="enscript-keyword">if</span>( inFlags &amp; kDebugFlags32BitOffset )
            {
                *s++ = kHexChars[ ( offset &gt;&gt; 28 ) &amp; 0xF ];
                *s++ = kHexChars[ ( offset &gt;&gt; 24 ) &amp; 0xF ];
                *s++ = kHexChars[ ( offset &gt;&gt; 20 ) &amp; 0xF ];
                *s++ = kHexChars[ ( offset &gt;&gt; 16 ) &amp; 0xF ];
            }
            *s++ = kHexChars[ ( offset &gt;&gt; 12 ) &amp; 0xF ];
            *s++ = kHexChars[ ( offset &gt;&gt;  8 ) &amp; 0xF ];
            *s++ = kHexChars[ ( offset &gt;&gt;  4 ) &amp; 0xF ];
            *s++ = kHexChars[   offset         &amp; 0xF ];
        }
        <span class="enscript-keyword">if</span>( s != prefixString )
        {
            *s++ = <span class="enscript-string">':'</span>;
            *s++ = <span class="enscript-string">' '</span>;
        }
        check( ( (size_t)( s - prefixString ) ) &lt; <span class="enscript-keyword">sizeof</span>( prefixString ) );
        *s = <span class="enscript-string">'\0'</span>;

        <span class="enscript-comment">// Build a hex string with a optional spaces after every 1, 2, and/or 4 bytes to make it easier to read.
</span>        <span class="enscript-comment">// Optionally pads the hex string with space to fill the full 16 byte range (so it lines up).
</span>
        s = hexString;
        chunkSize = ( inDataSize &lt; 16 ) ? inDataSize : 16;
        n = ( inFlags &amp; kDebugFlagsNo16ByteHexPad ) ? chunkSize : 16;
        <span class="enscript-keyword">for</span>( i = 0; i &lt; n; ++i )
        {
            <span class="enscript-keyword">if</span>( ( inFlags &amp; kDebugFlags8BitSeparator ) &amp;&amp; ( i &gt; 0 ) )
            {
                *s++ = <span class="enscript-string">' '</span>;
            }
            <span class="enscript-keyword">if</span>( ( inFlags &amp; kDebugFlags16BitSeparator ) &amp;&amp; ( i &gt; 0 ) &amp;&amp; ( ( i % 2 ) == 0 ) )
            {
                *s++ = <span class="enscript-string">' '</span>;
            }
            <span class="enscript-keyword">if</span>( !( inFlags &amp; kDebugFlagsNo32BitSeparator ) &amp;&amp; ( i &gt; 0 ) &amp;&amp; ( ( i % 4 ) == 0 ) )
            {
                *s++ = <span class="enscript-string">' '</span>;
            }
            <span class="enscript-keyword">if</span>( i &lt; chunkSize )
            {
                *s++ = kHexChars[ src[ i ] &gt;&gt; 4   ];
                *s++ = kHexChars[ src[ i ] &amp;  0xF ];
            }
            <span class="enscript-keyword">else</span>
            {
                *s++ = <span class="enscript-string">' '</span>;
                *s++ = <span class="enscript-string">' '</span>;
            }
        }
        check( ( (size_t)( s - hexString ) ) &lt; <span class="enscript-keyword">sizeof</span>( hexString ) );
        *s = <span class="enscript-string">'\0'</span>;

        <span class="enscript-comment">// Build a string with the ASCII version of the data (replaces non-printable characters with '^').
</span>        <span class="enscript-comment">// Optionally pads the string with '`' to fill the full 16 byte range (so it lines up).
</span>
        s = asciiString;
        <span class="enscript-keyword">if</span>( !( inFlags &amp; kDebugFlagsNoASCII ) )
        {
            *s++ = <span class="enscript-string">' '</span>;
            *s++ = <span class="enscript-string">'|'</span>;
            <span class="enscript-keyword">for</span>( i = 0; i &lt; n; ++i )
            {
                <span class="enscript-keyword">if</span>( i &lt; chunkSize )
                {
                    c = src[ i ];
                    <span class="enscript-keyword">if</span>( !DebugIsPrint( c ) )
                    {
                        c = <span class="enscript-string">'^'</span>;
                    }
                }
                <span class="enscript-keyword">else</span>
                {
                    c = <span class="enscript-string">'`'</span>;
                }
                *s++ = (<span class="enscript-type">char</span>) c;
            }
            *s++ = <span class="enscript-string">'|'</span>;
            check( ( (size_t)( s - asciiString ) ) &lt; <span class="enscript-keyword">sizeof</span>( asciiString ) );
        }
        *s = <span class="enscript-string">'\0'</span>;

        <span class="enscript-comment">// Build a string indicating how bytes are in the hex dump. Only printed on the first line.
</span>
        s = byteCountString;
        <span class="enscript-keyword">if</span>( !( inFlags &amp; kDebugFlagsNoByteCount ) )
        {
            <span class="enscript-keyword">if</span>( src == start )
            {
                s += DebugSNPrintF( s, <span class="enscript-keyword">sizeof</span>( byteCountString ), <span class="enscript-string">&quot; (%d bytes)&quot;</span>, (<span class="enscript-type">int</span>) inDataSize );
            }
        }
        check( ( (size_t)( s - byteCountString ) ) &lt; <span class="enscript-keyword">sizeof</span>( byteCountString ) );
        *s = <span class="enscript-string">'\0'</span>;

        <span class="enscript-comment">// Build the entire line from all the pieces we've previously built.
</span>
        <span class="enscript-keyword">if</span>( outBuffer )
        {
            <span class="enscript-keyword">if</span>( src == start )
            {
                dst += DebugSNPrintF( dst, (size_t)( end - dst ),
                                      <span class="enscript-string">&quot;%*s&quot;</span> <span class="enscript-comment">// Indention
</span>                                      <span class="enscript-string">&quot;%s&quot;</span> <span class="enscript-comment">// Separator (only if needed)
</span>                                      <span class="enscript-string">&quot;%s&quot;</span> <span class="enscript-comment">// Prefix
</span>                                      <span class="enscript-string">&quot;%-*.*s&quot;</span> <span class="enscript-comment">// Label
</span>                                      <span class="enscript-string">&quot;%s&quot;</span> <span class="enscript-comment">// Separator
</span>                                      <span class="enscript-string">&quot;%s&quot;</span> <span class="enscript-comment">// Hex
</span>                                      <span class="enscript-string">&quot;%s&quot;</span> <span class="enscript-comment">// ASCII
</span>                                      <span class="enscript-string">&quot;%s&quot;</span> <span class="enscript-comment">// Byte Count
</span>                                      <span class="enscript-string">&quot;%s&quot;</span>, <span class="enscript-comment">// Newline
</span>                                      inIndent, <span class="enscript-string">&quot;&quot;</span>,
                                      ( src != start ) ? separator : <span class="enscript-string">&quot;&quot;</span>,
                                      prefixString,
                                      width, (<span class="enscript-type">int</span>) inLabelSize, inLabel ? inLabel : <span class="enscript-string">&quot;&quot;</span>,
                                      ( width &gt; 0 ) ? <span class="enscript-string">&quot; &quot;</span> : <span class="enscript-string">&quot;&quot;</span>,
                                      hexString,
                                      asciiString,
                                      byteCountString,
                                      newline );
            }
            <span class="enscript-keyword">else</span>
            {
                dst += DebugSNPrintF( dst, (size_t)( end - dst ),
                                      <span class="enscript-string">&quot;%*s&quot;</span> <span class="enscript-comment">// Indention
</span>                                      <span class="enscript-string">&quot;%s&quot;</span> <span class="enscript-comment">// Separator (only if needed)
</span>                                      <span class="enscript-string">&quot;%s&quot;</span> <span class="enscript-comment">// Prefix
</span>                                      <span class="enscript-string">&quot;%*s&quot;</span> <span class="enscript-comment">// Label Spacing
</span>                                      <span class="enscript-string">&quot;%s&quot;</span> <span class="enscript-comment">// Separator
</span>                                      <span class="enscript-string">&quot;%s&quot;</span> <span class="enscript-comment">// Hex
</span>                                      <span class="enscript-string">&quot;%s&quot;</span> <span class="enscript-comment">// ASCII
</span>                                      <span class="enscript-string">&quot;%s&quot;</span> <span class="enscript-comment">// Byte Count
</span>                                      <span class="enscript-string">&quot;%s&quot;</span>, <span class="enscript-comment">// Newline
</span>                                      inIndent, <span class="enscript-string">&quot;&quot;</span>,
                                      ( src != start ) ? separator : <span class="enscript-string">&quot;&quot;</span>,
                                      prefixString,
                                      width, <span class="enscript-string">&quot;&quot;</span>,
                                      ( width &gt; 0 ) ? <span class="enscript-string">&quot; &quot;</span> : <span class="enscript-string">&quot;&quot;</span>,
                                      hexString,
                                      asciiString,
                                      byteCountString,
                                      newline );
            }
        }
        <span class="enscript-keyword">else</span>
        {
            <span class="enscript-keyword">if</span>( src == start )
            {
                dst += DebugPrintF( inLevel,
                                    <span class="enscript-string">&quot;%*s&quot;</span> <span class="enscript-comment">// Indention
</span>                                    <span class="enscript-string">&quot;%s&quot;</span> <span class="enscript-comment">// Separator (only if needed)
</span>                                    <span class="enscript-string">&quot;%s&quot;</span> <span class="enscript-comment">// Prefix
</span>                                    <span class="enscript-string">&quot;%-*.*s&quot;</span> <span class="enscript-comment">// Label
</span>                                    <span class="enscript-string">&quot;%s&quot;</span> <span class="enscript-comment">// Separator
</span>                                    <span class="enscript-string">&quot;%s&quot;</span> <span class="enscript-comment">// Hex
</span>                                    <span class="enscript-string">&quot;%s&quot;</span> <span class="enscript-comment">// ASCII
</span>                                    <span class="enscript-string">&quot;%s&quot;</span> <span class="enscript-comment">// Byte Count
</span>                                    <span class="enscript-string">&quot;%s&quot;</span>, <span class="enscript-comment">// Newline
</span>                                    inIndent, <span class="enscript-string">&quot;&quot;</span>,
                                    ( src != start ) ? separator : <span class="enscript-string">&quot;&quot;</span>,
                                    prefixString,
                                    width, (<span class="enscript-type">int</span>) inLabelSize, inLabel,
                                    ( width &gt; 0 ) ? <span class="enscript-string">&quot; &quot;</span> : <span class="enscript-string">&quot;&quot;</span>,
                                    hexString,
                                    asciiString,
                                    byteCountString,
                                    newline );
            }
            <span class="enscript-keyword">else</span>
            {
                dst += DebugPrintF( inLevel,
                                    <span class="enscript-string">&quot;%*s&quot;</span> <span class="enscript-comment">// Indention
</span>                                    <span class="enscript-string">&quot;%s&quot;</span> <span class="enscript-comment">// Separator (only if needed)
</span>                                    <span class="enscript-string">&quot;%s&quot;</span> <span class="enscript-comment">// Prefix
</span>                                    <span class="enscript-string">&quot;%*s&quot;</span> <span class="enscript-comment">// Label Spacing
</span>                                    <span class="enscript-string">&quot;%s&quot;</span> <span class="enscript-comment">// Separator
</span>                                    <span class="enscript-string">&quot;%s&quot;</span> <span class="enscript-comment">// Hex
</span>                                    <span class="enscript-string">&quot;%s&quot;</span> <span class="enscript-comment">// ASCII
</span>                                    <span class="enscript-string">&quot;%s&quot;</span> <span class="enscript-comment">// Byte Count
</span>                                    <span class="enscript-string">&quot;%s&quot;</span>, <span class="enscript-comment">// Newline
</span>                                    inIndent, <span class="enscript-string">&quot;&quot;</span>,
                                    ( src != start ) ? separator : <span class="enscript-string">&quot;&quot;</span>,
                                    prefixString,
                                    width, <span class="enscript-string">&quot;&quot;</span>,
                                    ( width &gt; 0 ) ? <span class="enscript-string">&quot; &quot;</span> : <span class="enscript-string">&quot;&quot;</span>,
                                    hexString,
                                    asciiString,
                                    byteCountString,
                                    newline );
            }
        }

        <span class="enscript-comment">// Move to the next chunk. Exit if there is no more data.
</span>
        offset      += (<span class="enscript-type">int</span>) chunkSize;
        src         += chunkSize;
        inDataSize  -= chunkSize;
        <span class="enscript-keyword">if</span>( inDataSize == 0 )
        {
            <span class="enscript-keyword">break</span>;
        }
    }

    <span class="enscript-comment">// Note: The &quot;dst - outBuffer&quot; size calculation works even if &quot;outBuffer&quot; is NULL because it's all relative.
</span>
    <span class="enscript-keyword">return</span>( (size_t)( dst - outBuffer ) );
}

<span class="enscript-comment">//===========================================================================================================================
</span><span class="enscript-comment">//	DebugNumVersionToString
</span><span class="enscript-comment">//===========================================================================================================================
</span>
<span class="enscript-type">static</span> <span class="enscript-type">char</span> *   <span class="enscript-function-name">DebugNumVersionToString</span>( uint32_t inVersion, <span class="enscript-type">char</span> *inString )
{
    <span class="enscript-type">char</span> *      s;
    uint8_t majorRev;
    uint8_t minor;
    uint8_t bugFix;
    uint8_t stage;
    uint8_t revision;

    check( inString );

    majorRev    = (uint8_t)( ( inVersion &gt;&gt; 24 ) &amp; 0xFF );
    minor       = (uint8_t)( ( inVersion &gt;&gt; 20 ) &amp; 0x0F );
    bugFix      = (uint8_t)( ( inVersion &gt;&gt; 16 ) &amp; 0x0F );
    stage       = (uint8_t)( ( inVersion &gt;&gt;  8 ) &amp; 0xFF );
    revision    = (uint8_t)(   inVersion         &amp; 0xFF );

    <span class="enscript-comment">// Convert the major, minor, and bugfix numbers.
</span>
    s  = inString;
    s += sprintf( s, <span class="enscript-string">&quot;%u&quot;</span>, majorRev );
    s += sprintf( s, <span class="enscript-string">&quot;.%u&quot;</span>, minor );
    <span class="enscript-keyword">if</span>( bugFix != 0 )
    {
        s += sprintf( s, <span class="enscript-string">&quot;.%u&quot;</span>, bugFix );
    }

    <span class="enscript-comment">// Convert the version stage and non-release revision number.
</span>
    <span class="enscript-keyword">switch</span>( stage )
    {
    <span class="enscript-keyword">case</span> <span class="enscript-reference">kVersionStageDevelopment</span>:
        s += sprintf( s, <span class="enscript-string">&quot;d%u&quot;</span>, revision );
        <span class="enscript-keyword">break</span>;

    <span class="enscript-keyword">case</span> <span class="enscript-reference">kVersionStageAlpha</span>:
        s += sprintf( s, <span class="enscript-string">&quot;a%u&quot;</span>, revision );
        <span class="enscript-keyword">break</span>;

    <span class="enscript-keyword">case</span> <span class="enscript-reference">kVersionStageBeta</span>:
        s += sprintf( s, <span class="enscript-string">&quot;b%u&quot;</span>, revision );
        <span class="enscript-keyword">break</span>;

    <span class="enscript-keyword">case</span> <span class="enscript-reference">kVersionStageFinal</span>:

        <span class="enscript-comment">// A non-release revision of zero is a special case indicating the software is GM (at the golden master
</span>        <span class="enscript-comment">// stage) and therefore, the non-release revision should not be added to the string.
</span>
        <span class="enscript-keyword">if</span>( revision != 0 )
        {
            s += sprintf( s, <span class="enscript-string">&quot;f%u&quot;</span>, revision );
        }
        <span class="enscript-keyword">break</span>;

    <span class="enscript-reference">default</span>:
        dlog( kDebugLevelError, <span class="enscript-string">&quot;invalid NumVersion stage (0x%02X)\n&quot;</span>, stage );
        <span class="enscript-keyword">break</span>;
    }
    <span class="enscript-keyword">return</span>( inString );
}

<span class="enscript-comment">//===========================================================================================================================
</span><span class="enscript-comment">//	DebugTaskLevel
</span><span class="enscript-comment">//===========================================================================================================================
</span>
DEBUG_EXPORT uint32_t   <span class="enscript-function-name">DebugTaskLevel</span>( <span class="enscript-type">void</span> )
{
    uint32_t level;

    level = 0;

    <span class="enscript-keyword">return</span>( level );
}

#<span class="enscript-reference">if</span> ( <span class="enscript-variable-name">TARGET_OS_WIN32</span> &amp;&amp; !<span class="enscript-variable-name">TARGET_OS_WINDOWS_CE</span> )
<span class="enscript-comment">//===========================================================================================================================
</span><span class="enscript-comment">//	DebugWinEnableConsole
</span><span class="enscript-comment">//===========================================================================================================================
</span>
#<span class="enscript-reference">pragma</span> <span class="enscript-variable-name">warning</span>( <span class="enscript-variable-name">disable</span>:4311 )

<span class="enscript-type">static</span> <span class="enscript-type">void</span> <span class="enscript-function-name">DebugWinEnableConsole</span>( <span class="enscript-type">void</span> )
{
    <span class="enscript-type">static</span> bool sConsoleEnabled = false;
    BOOL result;
    <span class="enscript-type">int</span> fileHandle;
    FILE *          file;
    <span class="enscript-type">int</span> err;

    <span class="enscript-keyword">if</span>( sConsoleEnabled )
    {
        <span class="enscript-keyword">goto</span> <span class="enscript-reference">exit</span>;
    }

    <span class="enscript-comment">// Create console window.
</span>
    result = AllocConsole();
    require_quiet( result, exit );

    <span class="enscript-comment">// Redirect stdin to the console stdin.
</span>
    fileHandle = _open_osfhandle( (<span class="enscript-type">long</span>) GetStdHandle( STD_INPUT_HANDLE ), _O_TEXT );

    #<span class="enscript-keyword">if</span> ( defined( __MWERKS__ ) )
    file = __handle_reopen( (<span class="enscript-type">unsigned</span> <span class="enscript-type">long</span>) fileHandle, <span class="enscript-string">&quot;r&quot;</span>, stdin );
    require_quiet( file, exit );
    #<span class="enscript-keyword">else</span>
    file = _fdopen( fileHandle, <span class="enscript-string">&quot;r&quot;</span> );
    require_quiet( file, exit );

    *stdin = *file;
    #endif

    err = setvbuf( stdin, NULL, _IONBF, 0 );
    require_noerr_quiet( err, exit );

    <span class="enscript-comment">// Redirect stdout to the console stdout.
</span>
    fileHandle = _open_osfhandle( (<span class="enscript-type">long</span>) GetStdHandle( STD_OUTPUT_HANDLE ), _O_TEXT );

    #<span class="enscript-keyword">if</span> ( defined( __MWERKS__ ) )
    file = __handle_reopen( (<span class="enscript-type">unsigned</span> <span class="enscript-type">long</span>) fileHandle, <span class="enscript-string">&quot;w&quot;</span>, stdout );
    require_quiet( file, exit );
    #<span class="enscript-keyword">else</span>
    file = _fdopen( fileHandle, <span class="enscript-string">&quot;w&quot;</span> );
    require_quiet( file, exit );

    *stdout = *file;
    #endif

    err = setvbuf( stdout, NULL, _IONBF, 0 );
    require_noerr_quiet( err, exit );

    <span class="enscript-comment">// Redirect stderr to the console stdout.
</span>
    fileHandle = _open_osfhandle( (<span class="enscript-type">long</span>) GetStdHandle( STD_OUTPUT_HANDLE ), _O_TEXT );

    #<span class="enscript-keyword">if</span> ( defined( __MWERKS__ ) )
    file = __handle_reopen( (<span class="enscript-type">unsigned</span> <span class="enscript-type">long</span>) fileHandle, <span class="enscript-string">&quot;w&quot;</span>, stderr );
    require_quiet( file, exit );
    #<span class="enscript-keyword">else</span>
    file = _fdopen( fileHandle, <span class="enscript-string">&quot;w&quot;</span> );
    require_quiet( file, exit );

    *stderr = *file;
    #endif

    err = setvbuf( stderr, NULL, _IONBF, 0 );
    require_noerr_quiet( err, exit );

    sConsoleEnabled = true;

<span class="enscript-reference">exit</span>:
    <span class="enscript-keyword">return</span>;
}

#<span class="enscript-reference">pragma</span> <span class="enscript-variable-name">warning</span>( <span class="enscript-variable-name">default</span>:4311 )

#<span class="enscript-reference">endif</span>  // <span class="enscript-variable-name">TARGET_OS_WIN32</span> &amp;&amp; !<span class="enscript-variable-name">TARGET_OS_WINDOWS_CE</span>

#<span class="enscript-reference">if</span> ( <span class="enscript-variable-name">TARGET_OS_WIN32</span> )
<span class="enscript-comment">//===========================================================================================================================
</span><span class="enscript-comment">//	DebugWinCharToTCharString
</span><span class="enscript-comment">//===========================================================================================================================
</span>
<span class="enscript-type">static</span> TCHAR *
<span class="enscript-function-name">DebugWinCharToTCharString</span>(
    <span class="enscript-type">const</span> <span class="enscript-type">char</span> *    inCharString,
    size_t inCharCount,
    TCHAR *         outTCharString,
    size_t inTCharCountMax,
    size_t *        outTCharCount )
{
    <span class="enscript-type">const</span> <span class="enscript-type">char</span> *        src;
    TCHAR *             dst;
    TCHAR *             end;

    <span class="enscript-keyword">if</span>( inCharCount == kSizeCString )
    {
        inCharCount = strlen( inCharString );
    }
    src = inCharString;
    dst = outTCharString;
    <span class="enscript-keyword">if</span>( inTCharCountMax &gt; 0 )
    {
        inTCharCountMax -= 1;
        <span class="enscript-keyword">if</span>( inTCharCountMax &gt; inCharCount )
        {
            inTCharCountMax = inCharCount;
        }

        end = dst + inTCharCountMax;
        <span class="enscript-keyword">while</span>( dst &lt; end )
        {
            *dst++ = (TCHAR) *src++;
        }
        *dst = 0;
    }
    <span class="enscript-keyword">if</span>( outTCharCount )
    {
        *outTCharCount = (size_t)( dst - outTCharString );
    }
    <span class="enscript-keyword">return</span>( outTCharString );
}
#<span class="enscript-reference">endif</span>

#<span class="enscript-reference">if</span> 0
#<span class="enscript-reference">pragma</span> <span class="enscript-variable-name">mark</span> -
#<span class="enscript-reference">pragma</span> <span class="enscript-variable-name">mark</span> == <span class="enscript-variable-name">Debugging</span> ==
#<span class="enscript-reference">endif</span>

<span class="enscript-comment">//===========================================================================================================================
</span><span class="enscript-comment">//	DebugServicesTest
</span><span class="enscript-comment">//===========================================================================================================================
</span>
DEBUG_EXPORT OSStatus   <span class="enscript-function-name">DebugServicesTest</span>( <span class="enscript-type">void</span> )
{
    OSStatus err;
    <span class="enscript-type">char</span> s[ 512 ];
    uint8_t *       p;
    uint8_t data[] =
    {
        0x11, 0x22, 0x33, 0x44,
        0x55, 0x66,
        0x77, 0x88, 0x99, 0xAA,
        0xBB, 0xCC, 0xDD,
        0xEE,
        0xFF,
        0x01, 0x02, 0x03, 0x04, 0x05, 0x06, 0x07, 0x08, 0x09, 0x0A,
        0x10, 0x20, 0x30, 0x40, 0x50, 0x60, 0x70, 0x80, 0x90, 0xA0,
        0x11, 0x21, 0x31, 0x41, 0x51, 0x61, 0x71, 0x81, 0x91, 0xA1
    };

    debug_initialize( kDebugOutputTypeMetaConsole );

    <span class="enscript-comment">// check's
</span>
    check( 0 &amp;&amp; <span class="enscript-string">&quot;SHOULD SEE: check&quot;</span> );
    check( 1 &amp;&amp; <span class="enscript-string">&quot;SHOULD *NOT* SEE: check (valid)&quot;</span> );
    check_string( 0, <span class="enscript-string">&quot;SHOULD SEE: check_string&quot;</span> );
    check_string( 1, <span class="enscript-string">&quot;SHOULD *NOT* SEE: check_string (valid)&quot;</span> );
    check_noerr( -123 );
    check_noerr( 10038 );
    check_noerr( 22 );
    check_noerr( 0 );
    check_noerr_string( -6712, <span class="enscript-string">&quot;SHOULD SEE: check_noerr_string&quot;</span> );
    check_noerr_string( 0, <span class="enscript-string">&quot;SHOULD *NOT* SEE: check_noerr_string (valid)&quot;</span> );
    check_translated_errno( 0 &gt;= 0 &amp;&amp; <span class="enscript-string">&quot;SHOULD *NOT* SEE&quot;</span>, -384, -999 );
    check_translated_errno( -1 &gt;= 0 &amp;&amp; <span class="enscript-string">&quot;SHOULD SEE&quot;</span>, -384, -999 );
    check_translated_errno( -1 &gt;= 0 &amp;&amp; <span class="enscript-string">&quot;SHOULD SEE&quot;</span>, 0, -999 );
    check_ptr_overlap( <span class="enscript-string">&quot;SHOULD *NOT* SEE&quot;</span> ? 10 : 0, 10, 22, 10 );
    check_ptr_overlap( <span class="enscript-string">&quot;SHOULD SEE&quot;</span> ? 10 : 0, 10,  5, 10 );
    check_ptr_overlap( <span class="enscript-string">&quot;SHOULD SEE&quot;</span> ? 10 : 0, 10, 12,  6 );
    check_ptr_overlap( <span class="enscript-string">&quot;SHOULD SEE&quot;</span> ? 12 : 0,  6, 10, 10 );
    check_ptr_overlap( <span class="enscript-string">&quot;SHOULD SEE&quot;</span> ? 12 : 0, 10, 10, 10 );
    check_ptr_overlap( <span class="enscript-string">&quot;SHOULD *NOT* SEE&quot;</span> ? 22 : 0, 10, 10, 10 );
    check_ptr_overlap( <span class="enscript-string">&quot;SHOULD *NOT* SEE&quot;</span> ? 10 : 0, 10, 20, 10 );
    check_ptr_overlap( <span class="enscript-string">&quot;SHOULD *NOT* SEE&quot;</span> ? 20 : 0, 10, 10, 10 );

    <span class="enscript-comment">// require's
</span>
    require( 0 &amp;&amp; <span class="enscript-string">&quot;SHOULD SEE&quot;</span>, require1 );
    { err = kResponseErr; <span class="enscript-keyword">goto</span> <span class="enscript-reference">exit</span>; }
<span class="enscript-reference">require1</span>:
    require( 1 &amp;&amp; <span class="enscript-string">&quot;SHOULD *NOT* SEE&quot;</span>, require2 );
    <span class="enscript-keyword">goto</span> <span class="enscript-reference">require2Good</span>;
<span class="enscript-reference">require2</span>:
    { err = kResponseErr; <span class="enscript-keyword">goto</span> <span class="enscript-reference">exit</span>; }
<span class="enscript-reference">require2Good</span>:
    require_string( 0 &amp;&amp; <span class="enscript-string">&quot;SHOULD SEE&quot;</span>, require3, <span class="enscript-string">&quot;SHOULD SEE: require_string&quot;</span> );
    { err = kResponseErr; <span class="enscript-keyword">goto</span> <span class="enscript-reference">exit</span>; }
<span class="enscript-reference">require3</span>:
    require_string( 1 &amp;&amp; <span class="enscript-string">&quot;SHOULD *NOT* SEE&quot;</span>, require4, <span class="enscript-string">&quot;SHOULD *NOT* SEE: require_string (valid)&quot;</span> );
    <span class="enscript-keyword">goto</span> <span class="enscript-reference">require4Good</span>;
<span class="enscript-reference">require4</span>:
    { err = kResponseErr; <span class="enscript-keyword">goto</span> <span class="enscript-reference">exit</span>; }
<span class="enscript-reference">require4Good</span>:
    require_quiet( 0 &amp;&amp; <span class="enscript-string">&quot;SHOULD SEE&quot;</span>, require5 );
    { err = kResponseErr; <span class="enscript-keyword">goto</span> <span class="enscript-reference">exit</span>; }
<span class="enscript-reference">require5</span>:
    require_quiet( 1 &amp;&amp; <span class="enscript-string">&quot;SHOULD *NOT* SEE&quot;</span>, require6 );
    <span class="enscript-keyword">goto</span> <span class="enscript-reference">require6Good</span>;
<span class="enscript-reference">require6</span>:
    { err = kResponseErr; <span class="enscript-keyword">goto</span> <span class="enscript-reference">exit</span>; }
<span class="enscript-reference">require6Good</span>:
    require_noerr( -1, require7 );
    { err = kResponseErr; <span class="enscript-keyword">goto</span> <span class="enscript-reference">exit</span>; }
<span class="enscript-reference">require7</span>:
    require_noerr( 0, require8 );
    <span class="enscript-keyword">goto</span> <span class="enscript-reference">require8Good</span>;
<span class="enscript-reference">require8</span>:
    { err = kResponseErr; <span class="enscript-keyword">goto</span> <span class="enscript-reference">exit</span>; }
<span class="enscript-reference">require8Good</span>:
    require_noerr_string( -2, require9, <span class="enscript-string">&quot;SHOULD SEE: require_noerr_string&quot;</span>);
    { err = kResponseErr; <span class="enscript-keyword">goto</span> <span class="enscript-reference">exit</span>; }
<span class="enscript-reference">require9</span>:
    require_noerr_string( 0, require10, <span class="enscript-string">&quot;SHOULD *NOT* SEE: require_noerr_string (valid)&quot;</span> );
    <span class="enscript-keyword">goto</span> <span class="enscript-reference">require10Good</span>;
<span class="enscript-reference">require10</span>:
    { err = kResponseErr; <span class="enscript-keyword">goto</span> <span class="enscript-reference">exit</span>; }
<span class="enscript-reference">require10Good</span>:
    require_noerr_action_string( -3, require11, dlog( kDebugLevelMax, <span class="enscript-string">&quot;action 1 (expected)\n&quot;</span> ), <span class="enscript-string">&quot;require_noerr_action_string&quot;</span> );
    { err = kResponseErr; <span class="enscript-keyword">goto</span> <span class="enscript-reference">exit</span>; }
<span class="enscript-reference">require11</span>:
    require_noerr_action_string( 0, require12, dlog( kDebugLevelMax, <span class="enscript-string">&quot;action 2\n&quot;</span> ), <span class="enscript-string">&quot;require_noerr_action_string (valid)&quot;</span> );
    <span class="enscript-keyword">goto</span> <span class="enscript-reference">require12Good</span>;
<span class="enscript-reference">require12</span>:
    { err = kResponseErr; <span class="enscript-keyword">goto</span> <span class="enscript-reference">exit</span>; }
<span class="enscript-reference">require12Good</span>:
    require_noerr_quiet( -4, require13 );
    { err = kResponseErr; <span class="enscript-keyword">goto</span> <span class="enscript-reference">exit</span>; }
<span class="enscript-reference">require13</span>:
    require_noerr_quiet( 0, require14 );
    <span class="enscript-keyword">goto</span> <span class="enscript-reference">require14Good</span>;
<span class="enscript-reference">require14</span>:
    { err = kResponseErr; <span class="enscript-keyword">goto</span> <span class="enscript-reference">exit</span>; }
<span class="enscript-reference">require14Good</span>:
    require_noerr_action( -5, require15, dlog( kDebugLevelMax, <span class="enscript-string">&quot;SHOULD SEE: action 3 (expected)\n&quot;</span> ) );
    { err = kResponseErr; <span class="enscript-keyword">goto</span> <span class="enscript-reference">exit</span>; }
<span class="enscript-reference">require15</span>:
    require_noerr_action( 0, require16, dlog( kDebugLevelMax, <span class="enscript-string">&quot;SHOULD *NOT* SEE: action 4\n&quot;</span> ) );
    <span class="enscript-keyword">goto</span> <span class="enscript-reference">require16Good</span>;
<span class="enscript-reference">require16</span>:
    { err = kResponseErr; <span class="enscript-keyword">goto</span> <span class="enscript-reference">exit</span>; }
<span class="enscript-reference">require16Good</span>:
    require_noerr_action_quiet( -4, require17, dlog( kDebugLevelMax, <span class="enscript-string">&quot;SHOULD SEE: action 5 (expected)\n&quot;</span> ) );
    { err = kResponseErr; <span class="enscript-keyword">goto</span> <span class="enscript-reference">exit</span>; }
<span class="enscript-reference">require17</span>:
    require_noerr_action_quiet( 0, require18, dlog( kDebugLevelMax, <span class="enscript-string">&quot;SHOULD *NOT* SEE: action 6\n&quot;</span> ) );
    <span class="enscript-keyword">goto</span> <span class="enscript-reference">require18Good</span>;
<span class="enscript-reference">require18</span>:
    { err = kResponseErr; <span class="enscript-keyword">goto</span> <span class="enscript-reference">exit</span>; }
<span class="enscript-reference">require18Good</span>:
    require_action( 0 &amp;&amp; <span class="enscript-string">&quot;SHOULD SEE&quot;</span>, require19, dlog( kDebugLevelMax, <span class="enscript-string">&quot;SHOULD SEE: action 7 (expected)\n&quot;</span> ) );
    { err = kResponseErr; <span class="enscript-keyword">goto</span> <span class="enscript-reference">exit</span>; }
<span class="enscript-reference">require19</span>:
    require_action( 1 &amp;&amp; <span class="enscript-string">&quot;SHOULD *NOT* SEE&quot;</span>, require20, dlog( kDebugLevelMax, <span class="enscript-string">&quot;SHOULD *NOT* SEE: action 8\n&quot;</span> ) );
    <span class="enscript-keyword">goto</span> <span class="enscript-reference">require20Good</span>;
<span class="enscript-reference">require20</span>:
    { err = kResponseErr; <span class="enscript-keyword">goto</span> <span class="enscript-reference">exit</span>; }
<span class="enscript-reference">require20Good</span>:
    require_action_quiet( 0, require21, dlog( kDebugLevelMax, <span class="enscript-string">&quot;SHOULD SEE: action 9 (expected)\n&quot;</span> ) );
    { err = kResponseErr; <span class="enscript-keyword">goto</span> <span class="enscript-reference">exit</span>; }
<span class="enscript-reference">require21</span>:
    require_action_quiet( 1, require22, dlog( kDebugLevelMax, <span class="enscript-string">&quot;SHOULD *NOT* SEE: action 10\n&quot;</span> ) );
    <span class="enscript-keyword">goto</span> <span class="enscript-reference">require22Good</span>;
<span class="enscript-reference">require22</span>:
    { err = kResponseErr; <span class="enscript-keyword">goto</span> <span class="enscript-reference">exit</span>; }
<span class="enscript-reference">require22Good</span>:
    require_action_string( 0, require23, dlog( kDebugLevelMax, <span class="enscript-string">&quot;SHOULD SEE: action 11 (expected)\n&quot;</span> ), <span class="enscript-string">&quot;SHOULD SEE: require_action_string&quot;</span> );
    { err = kResponseErr; <span class="enscript-keyword">goto</span> <span class="enscript-reference">exit</span>; }
<span class="enscript-reference">require23</span>:
    require_action_string( 1, require24, dlog( kDebugLevelMax, <span class="enscript-string">&quot;SHOULD *NOT* SEE: action 12\n&quot;</span> ), <span class="enscript-string">&quot;SHOULD *NOT* SEE: require_action_string&quot;</span> );
    <span class="enscript-keyword">goto</span> <span class="enscript-reference">require24Good</span>;
<span class="enscript-reference">require24</span>:
    { err = kResponseErr; <span class="enscript-keyword">goto</span> <span class="enscript-reference">exit</span>; }
<span class="enscript-reference">require24Good</span>:

#<span class="enscript-reference">if</span> ( <span class="enscript-reference">defined</span>(<span class="enscript-variable-name"> __MWERKS__ </span>)  )
    #<span class="enscript-keyword">if</span> ( defined( __cplusplus ) &amp;&amp; __option( exceptions ) )
        #define COMPILER_HAS_EXCEPTIONS     1
    #<span class="enscript-keyword">else</span>
        #define COMPILER_HAS_EXCEPTIONS     0
    #endif
#<span class="enscript-reference">else</span>
    #<span class="enscript-keyword">if</span> ( defined( __cplusplus ) )
        #define COMPILER_HAS_EXCEPTIONS     1
    #<span class="enscript-keyword">else</span>
        #define COMPILER_HAS_EXCEPTIONS     0
    #endif
#<span class="enscript-reference">endif</span>

#<span class="enscript-reference">if</span> ( <span class="enscript-variable-name">COMPILER_HAS_EXCEPTIONS</span> )
    try
    {
        require_throw( 1 &amp;&amp; <span class="enscript-string">&quot;SHOULD *NOT* SEE&quot;</span> );
        require_throw( 0 &amp;&amp; <span class="enscript-string">&quot;SHOULD SEE&quot;</span> );
    }
    catch(... )
    {
        <span class="enscript-keyword">goto</span> <span class="enscript-reference">require26Good</span>;
    }
    { err = kResponseErr; <span class="enscript-keyword">goto</span> <span class="enscript-reference">exit</span>; }
<span class="enscript-reference">require26Good</span>:
#<span class="enscript-reference">endif</span>

    <span class="enscript-comment">// translate_errno
</span>
    err = translate_errno( 1 != -1, -123, -567 );
    require( ( err == 0 ) &amp;&amp; <span class="enscript-string">&quot;SHOULD *NOT* SEE&quot;</span>, exit );

    err = translate_errno( -1 != -1, -123, -567 );
    require( ( err == -123 ) &amp;&amp; <span class="enscript-string">&quot;SHOULD *NOT* SEE&quot;</span>, exit );

    err = translate_errno( -1 != -1, 0, -567 );
    require( ( err == -567 ) &amp;&amp; <span class="enscript-string">&quot;SHOULD *NOT* SEE&quot;</span>, exit );

    <span class="enscript-comment">// debug_string
</span>
    debug_string( <span class="enscript-string">&quot;debug_string&quot;</span> );

    <span class="enscript-comment">// DebugSNPrintF
</span>
    DebugSNPrintF( s, <span class="enscript-keyword">sizeof</span>( s ), <span class="enscript-string">&quot;%d&quot;</span>, 1234 );
    require_action( strcmp( s, <span class="enscript-string">&quot;1234&quot;</span> ) == 0, exit, err = -1 );

    DebugSNPrintF( s, <span class="enscript-keyword">sizeof</span>( s ), <span class="enscript-string">&quot;%X&quot;</span>, 0x2345 );
    require_action( strcmp( s, <span class="enscript-string">&quot;2345&quot;</span> ) == 0, exit, err = -1 );

    DebugSNPrintF( s, <span class="enscript-keyword">sizeof</span>( s ), <span class="enscript-string">&quot;%#s&quot;</span>, <span class="enscript-string">&quot;\05test&quot;</span> );
    require_action( strcmp( s, <span class="enscript-string">&quot;test&quot;</span> ) == 0, exit, err = -1 );

    DebugSNPrintF( s, <span class="enscript-keyword">sizeof</span>( s ), <span class="enscript-string">&quot;%##s&quot;</span>, <span class="enscript-string">&quot;\03www\05apple\03com&quot;</span> );
    require_action( strcmp( s, <span class="enscript-string">&quot;www.apple.com.&quot;</span> ) == 0, exit, err = -1 );

    DebugSNPrintF( s, <span class="enscript-keyword">sizeof</span>( s ), <span class="enscript-string">&quot;%ld&quot;</span>, (<span class="enscript-type">long</span>) INT32_C( 2147483647 ) );
    require_action( strcmp( s, <span class="enscript-string">&quot;2147483647&quot;</span> ) == 0, exit, err = -1 );

    DebugSNPrintF( s, <span class="enscript-keyword">sizeof</span>( s ), <span class="enscript-string">&quot;%lu&quot;</span>, (<span class="enscript-type">unsigned</span> <span class="enscript-type">long</span>) UINT32_C( 4294967295 ) );
    require_action( strcmp( s, <span class="enscript-string">&quot;4294967295&quot;</span> ) == 0, exit, err = -1 );

    #<span class="enscript-keyword">if</span> ( TYPE_LONGLONG_NATIVE )
    DebugSNPrintF( s, <span class="enscript-keyword">sizeof</span>( s ), <span class="enscript-string">&quot;%lld&quot;</span>, (long_long_compat) INT64_C( 9223372036854775807 ) );
    require_action( strcmp( s, <span class="enscript-string">&quot;9223372036854775807&quot;</span> ) == 0, exit, err = -1 );

    DebugSNPrintF( s, <span class="enscript-keyword">sizeof</span>( s ), <span class="enscript-string">&quot;%lld&quot;</span>, (long_long_compat) INT64_C( -9223372036854775807 ) );
    require_action( strcmp( s, <span class="enscript-string">&quot;-9223372036854775807&quot;</span> ) == 0, exit, err = -1 );

    DebugSNPrintF( s, <span class="enscript-keyword">sizeof</span>( s ), <span class="enscript-string">&quot;%llu&quot;</span>, (unsigned_long_long_compat) UINT64_C( 18446744073709551615 ) );
    require_action( strcmp( s, <span class="enscript-string">&quot;18446744073709551615&quot;</span> ) == 0, exit, err = -1 );
    #endif

    DebugSNPrintF( s, <span class="enscript-keyword">sizeof</span>( s ), <span class="enscript-string">&quot;%lb&quot;</span>, (<span class="enscript-type">unsigned</span> <span class="enscript-type">long</span>) binary_32( 01111011, 01111011, 01111011, 01111011 ) );
    require_action( strcmp( s, <span class="enscript-string">&quot;1111011011110110111101101111011&quot;</span> ) == 0, exit, err = -1 );

    DebugSNPrintF( s, <span class="enscript-keyword">sizeof</span>( s ), <span class="enscript-string">&quot;%C&quot;</span>, 0x41624364 );  <span class="enscript-comment">// 'AbCd'
</span>    require_action( strcmp( s, <span class="enscript-string">&quot;AbCd&quot;</span> ) == 0, exit, err = -1 );

    #<span class="enscript-keyword">if</span> ( defined( MDNS_DEBUGMSGS ) )
    {
        mDNSAddr maddr;

        memset( &amp;maddr, 0, <span class="enscript-keyword">sizeof</span>( maddr ) );
        maddr.type = mDNSAddrType_IPv4;
        maddr.ip.v4.b[ 0 ] = 127;
        maddr.ip.v4.b[ 1 ] = 0;
        maddr.ip.v4.b[ 2 ] = 0;
        maddr.ip.v4.b[ 3 ] = 1;
        DebugSNPrintF( s, <span class="enscript-keyword">sizeof</span>( s ), <span class="enscript-string">&quot;%#a&quot;</span>, &amp;maddr );
        require_action( strcmp( s, <span class="enscript-string">&quot;127.0.0.1&quot;</span> ) == 0, exit, err = -1 );

        memset( &amp;maddr, 0, <span class="enscript-keyword">sizeof</span>( maddr ) );
        maddr.type = mDNSAddrType_IPv6;
        maddr.ip.v6.b[  0 ] = 0xFE;
        maddr.ip.v6.b[  1 ] = 0x80;
        maddr.ip.v6.b[ 15 ] = 0x01;
        DebugSNPrintF( s, <span class="enscript-keyword">sizeof</span>( s ), <span class="enscript-string">&quot;%#a&quot;</span>, &amp;maddr );
        require_action( strcmp( s, <span class="enscript-string">&quot;FE80:0000:0000:0000:0000:0000:0000:0001&quot;</span> ) == 0, exit, err = -1 );
    }
    #endif

    #<span class="enscript-keyword">if</span> ( AF_INET )
    {
        <span class="enscript-type">struct</span> sockaddr_in sa4;

        memset( &amp;sa4, 0, <span class="enscript-keyword">sizeof</span>( sa4 ) );
        sa4.sin_family      = AF_INET;
        p                   = (uint8_t *) &amp;sa4.sin_port;
        p[ 0 ]              = (uint8_t)( ( 80 &gt;&gt; 8 ) &amp; 0xFF );
        p[ 1 ]              = (uint8_t)(   80        &amp; 0xFF );
        p                   = (uint8_t *) &amp;sa4.sin_addr.s_addr;
        p[ 0 ]              = (uint8_t)( ( INADDR_LOOPBACK &gt;&gt; 24 ) &amp; 0xFF );
        p[ 1 ]              = (uint8_t)( ( INADDR_LOOPBACK &gt;&gt; 16 ) &amp; 0xFF );
        p[ 2 ]              = (uint8_t)( ( INADDR_LOOPBACK &gt;&gt;  8 ) &amp; 0xFF );
        p[ 3 ]              = (uint8_t)(   INADDR_LOOPBACK         &amp; 0xFF );
        DebugSNPrintF( s, <span class="enscript-keyword">sizeof</span>( s ), <span class="enscript-string">&quot;%##a&quot;</span>, &amp;sa4 );
        require_action( strcmp( s, <span class="enscript-string">&quot;127.0.0.1:80&quot;</span> ) == 0, exit, err = -1 );
    }
    #endif

    #<span class="enscript-keyword">if</span> ( AF_INET6 )
    {
        <span class="enscript-type">struct</span> sockaddr_in6 sa6;

        memset( &amp;sa6, 0, <span class="enscript-keyword">sizeof</span>( sa6 ) );
        sa6.sin6_family             = AF_INET6;
        p                           = (uint8_t *) &amp;sa6.sin6_port;
        p[ 0 ]                      = (uint8_t)( ( 80 &gt;&gt; 8 ) &amp; 0xFF );
        p[ 1 ]                      = (uint8_t)(   80        &amp; 0xFF );
        sa6.sin6_addr.s6_addr[  0 ] = 0xFE;
        sa6.sin6_addr.s6_addr[  1 ] = 0x80;
        sa6.sin6_addr.s6_addr[ 15 ] = 0x01;
        sa6.sin6_scope_id           = 2;
        DebugSNPrintF( s, <span class="enscript-keyword">sizeof</span>( s ), <span class="enscript-string">&quot;%##a&quot;</span>, &amp;sa6 );
        require_action( strcmp( s, <span class="enscript-string">&quot;[FE80:0000:0000:0000:0000:0000:0000:0001%2]:80&quot;</span> ) == 0, exit, err = -1 );
    }
    #endif

    <span class="enscript-comment">// Unicode
</span>
    DebugSNPrintF(s, <span class="enscript-keyword">sizeof</span>(s), <span class="enscript-string">&quot;%.*s&quot;</span>, 4, <span class="enscript-string">&quot;tes&quot;</span> );
    require_action( strcmp( s, <span class="enscript-string">&quot;tes&quot;</span> ) == 0, exit, err = kResponseErr );

    DebugSNPrintF(s, <span class="enscript-keyword">sizeof</span>(s), <span class="enscript-string">&quot;%.*s&quot;</span>, 4, <span class="enscript-string">&quot;test&quot;</span> );
    require_action( strcmp( s, <span class="enscript-string">&quot;test&quot;</span> ) == 0, exit, err = kResponseErr );

    DebugSNPrintF(s, <span class="enscript-keyword">sizeof</span>(s), <span class="enscript-string">&quot;%.*s&quot;</span>, 4, <span class="enscript-string">&quot;testing&quot;</span> );
    require_action( strcmp( s, <span class="enscript-string">&quot;test&quot;</span> ) == 0, exit, err = kResponseErr );

    DebugSNPrintF(s, <span class="enscript-keyword">sizeof</span>(s), <span class="enscript-string">&quot;%.*s&quot;</span>, 4, <span class="enscript-string">&quot;te\xC3\xA9&quot;</span> );
    require_action( strcmp( s, <span class="enscript-string">&quot;te\xC3\xA9&quot;</span> ) == 0, exit, err = kResponseErr );

    DebugSNPrintF(s, <span class="enscript-keyword">sizeof</span>(s), <span class="enscript-string">&quot;%.*s&quot;</span>, 4, <span class="enscript-string">&quot;te\xC3\xA9ing&quot;</span> );
    require_action( strcmp( s, <span class="enscript-string">&quot;te\xC3\xA9&quot;</span> ) == 0, exit, err = kResponseErr );

    DebugSNPrintF(s, <span class="enscript-keyword">sizeof</span>(s), <span class="enscript-string">&quot;%.*s&quot;</span>, 4, <span class="enscript-string">&quot;tes\xC3\xA9ing&quot;</span> );
    require_action( strcmp( s, <span class="enscript-string">&quot;tes&quot;</span> ) == 0, exit, err = kResponseErr );

    DebugSNPrintF(s, <span class="enscript-keyword">sizeof</span>(s), <span class="enscript-string">&quot;%.*s&quot;</span>, 4, <span class="enscript-string">&quot;t\xed\x9f\xbf&quot;</span> );
    require_action( strcmp( s, <span class="enscript-string">&quot;t\xed\x9f\xbf&quot;</span> ) == 0, exit, err = kResponseErr );

    DebugSNPrintF(s, <span class="enscript-keyword">sizeof</span>(s), <span class="enscript-string">&quot;%.*s&quot;</span>, 4, <span class="enscript-string">&quot;t\xed\x9f\xbfing&quot;</span> );
    require_action( strcmp( s, <span class="enscript-string">&quot;t\xed\x9f\xbf&quot;</span> ) == 0, exit, err = kResponseErr );

    DebugSNPrintF(s, <span class="enscript-keyword">sizeof</span>(s), <span class="enscript-string">&quot;%.*s&quot;</span>, 4, <span class="enscript-string">&quot;te\xed\x9f\xbf&quot;</span> );
    require_action( strcmp( s, <span class="enscript-string">&quot;te&quot;</span> ) == 0, exit, err = kResponseErr );

    DebugSNPrintF(s, <span class="enscript-keyword">sizeof</span>(s), <span class="enscript-string">&quot;%.*s&quot;</span>, 4, <span class="enscript-string">&quot;te\xed\x9f\xbfing&quot;</span> );
    require_action( strcmp( s, <span class="enscript-string">&quot;te&quot;</span> ) == 0, exit, err = kResponseErr );

    DebugSNPrintF(s, <span class="enscript-keyword">sizeof</span>(s), <span class="enscript-string">&quot;%.*s&quot;</span>, 7, <span class="enscript-string">&quot;te\xC3\xA9\xed\x9f\xbfing&quot;</span> );
    require_action( strcmp( s, <span class="enscript-string">&quot;te\xC3\xA9\xed\x9f\xbf&quot;</span> ) == 0, exit, err = kResponseErr );

    DebugSNPrintF(s, <span class="enscript-keyword">sizeof</span>(s), <span class="enscript-string">&quot;%.*s&quot;</span>, 6, <span class="enscript-string">&quot;te\xC3\xA9\xed\x9f\xbfing&quot;</span> );
    require_action( strcmp( s, <span class="enscript-string">&quot;te\xC3\xA9&quot;</span> ) == 0, exit, err = kResponseErr );

    DebugSNPrintF(s, <span class="enscript-keyword">sizeof</span>(s), <span class="enscript-string">&quot;%.*s&quot;</span>, 5, <span class="enscript-string">&quot;te\xC3\xA9\xed\x9f\xbfing&quot;</span> );
    require_action( strcmp( s, <span class="enscript-string">&quot;te\xC3\xA9&quot;</span> ) == 0, exit, err = kResponseErr );

    #<span class="enscript-keyword">if</span> ( TARGET_RT_BIG_ENDIAN )
    DebugSNPrintF( s, <span class="enscript-keyword">sizeof</span>( s ), <span class="enscript-string">&quot;%S&quot;</span>, <span class="enscript-string">&quot;\x00&quot;</span> <span class="enscript-string">&quot;a&quot;</span> <span class="enscript-string">&quot;\x00&quot;</span> <span class="enscript-string">&quot;b&quot;</span> <span class="enscript-string">&quot;\x00&quot;</span> <span class="enscript-string">&quot;c&quot;</span> <span class="enscript-string">&quot;\x00&quot;</span> <span class="enscript-string">&quot;d&quot;</span> <span class="enscript-string">&quot;\x00&quot;</span> <span class="enscript-string">&quot;\x00&quot;</span> );
    require_action( strcmp( s, <span class="enscript-string">&quot;abcd&quot;</span> ) == 0, exit, err = -1 );
    #<span class="enscript-keyword">else</span>
    DebugSNPrintF( s, <span class="enscript-keyword">sizeof</span>( s ), <span class="enscript-string">&quot;%S&quot;</span>, <span class="enscript-string">&quot;a&quot;</span> <span class="enscript-string">&quot;\x00&quot;</span> <span class="enscript-string">&quot;b&quot;</span> <span class="enscript-string">&quot;\x00&quot;</span> <span class="enscript-string">&quot;c&quot;</span> <span class="enscript-string">&quot;\x00&quot;</span> <span class="enscript-string">&quot;d&quot;</span> <span class="enscript-string">&quot;\x00&quot;</span> <span class="enscript-string">&quot;\x00&quot;</span> <span class="enscript-string">&quot;\x00&quot;</span> );
    require_action( strcmp( s, <span class="enscript-string">&quot;abcd&quot;</span> ) == 0, exit, err = -1 );
    #endif

    DebugSNPrintF( s, <span class="enscript-keyword">sizeof</span>( s ), <span class="enscript-string">&quot;%S&quot;</span>,
                   <span class="enscript-string">&quot;\xFE\xFF&quot;</span> <span class="enscript-string">&quot;\x00&quot;</span> <span class="enscript-string">&quot;a&quot;</span> <span class="enscript-string">&quot;\x00&quot;</span> <span class="enscript-string">&quot;b&quot;</span> <span class="enscript-string">&quot;\x00&quot;</span> <span class="enscript-string">&quot;c&quot;</span> <span class="enscript-string">&quot;\x00&quot;</span> <span class="enscript-string">&quot;d&quot;</span> <span class="enscript-string">&quot;\x00&quot;</span> <span class="enscript-string">&quot;\x00&quot;</span> ); <span class="enscript-comment">// Big Endian BOM
</span>    require_action( strcmp( s, <span class="enscript-string">&quot;abcd&quot;</span> ) == 0, exit, err = -1 );

    DebugSNPrintF( s, <span class="enscript-keyword">sizeof</span>( s ), <span class="enscript-string">&quot;%S&quot;</span>,
                   <span class="enscript-string">&quot;\xFF\xFE&quot;</span> <span class="enscript-string">&quot;a&quot;</span> <span class="enscript-string">&quot;\x00&quot;</span> <span class="enscript-string">&quot;b&quot;</span> <span class="enscript-string">&quot;\x00&quot;</span> <span class="enscript-string">&quot;c&quot;</span> <span class="enscript-string">&quot;\x00&quot;</span> <span class="enscript-string">&quot;d&quot;</span> <span class="enscript-string">&quot;\x00&quot;</span> <span class="enscript-string">&quot;\x00&quot;</span> <span class="enscript-string">&quot;\x00&quot;</span> ); <span class="enscript-comment">// Little Endian BOM
</span>    require_action( strcmp( s, <span class="enscript-string">&quot;abcd&quot;</span> ) == 0, exit, err = -1 );

    DebugSNPrintF( s, <span class="enscript-keyword">sizeof</span>( s ), <span class="enscript-string">&quot;%#S&quot;</span>, <span class="enscript-string">&quot;\x00&quot;</span> <span class="enscript-string">&quot;a&quot;</span> <span class="enscript-string">&quot;\x00&quot;</span> <span class="enscript-string">&quot;b&quot;</span> <span class="enscript-string">&quot;\x00&quot;</span> <span class="enscript-string">&quot;c&quot;</span> <span class="enscript-string">&quot;\x00&quot;</span> <span class="enscript-string">&quot;d&quot;</span> <span class="enscript-string">&quot;\x00&quot;</span> <span class="enscript-string">&quot;\x00&quot;</span> );  <span class="enscript-comment">// Big Endian
</span>    require_action( strcmp( s, <span class="enscript-string">&quot;abcd&quot;</span> ) == 0, exit, err = -1 );

    DebugSNPrintF( s, <span class="enscript-keyword">sizeof</span>( s ), <span class="enscript-string">&quot;%##S&quot;</span>, <span class="enscript-string">&quot;a&quot;</span> <span class="enscript-string">&quot;\x00&quot;</span> <span class="enscript-string">&quot;b&quot;</span> <span class="enscript-string">&quot;\x00&quot;</span> <span class="enscript-string">&quot;c&quot;</span> <span class="enscript-string">&quot;\x00&quot;</span> <span class="enscript-string">&quot;d&quot;</span> <span class="enscript-string">&quot;\x00&quot;</span> <span class="enscript-string">&quot;\x00&quot;</span> <span class="enscript-string">&quot;\x00&quot;</span> ); <span class="enscript-comment">// Little Endian
</span>    require_action( strcmp( s, <span class="enscript-string">&quot;abcd&quot;</span> ) == 0, exit, err = -1 );

    DebugSNPrintF( s, <span class="enscript-keyword">sizeof</span>( s ), <span class="enscript-string">&quot;%.*S&quot;</span>,
                   4, <span class="enscript-string">&quot;\xFE\xFF&quot;</span> <span class="enscript-string">&quot;\x00&quot;</span> <span class="enscript-string">&quot;a&quot;</span> <span class="enscript-string">&quot;\x00&quot;</span> <span class="enscript-string">&quot;b&quot;</span> <span class="enscript-string">&quot;\x00&quot;</span> <span class="enscript-string">&quot;c&quot;</span> <span class="enscript-string">&quot;\x00&quot;</span> <span class="enscript-string">&quot;d&quot;</span> ); <span class="enscript-comment">// Big Endian BOM
</span>    require_action( strcmp( s, <span class="enscript-string">&quot;abc&quot;</span> ) == 0, exit, err = -1 );

    DebugSNPrintF( s, <span class="enscript-keyword">sizeof</span>( s ), <span class="enscript-string">&quot;%.*S&quot;</span>,
                   4, <span class="enscript-string">&quot;\xFF\xFE&quot;</span> <span class="enscript-string">&quot;a&quot;</span> <span class="enscript-string">&quot;\x00&quot;</span> <span class="enscript-string">&quot;b&quot;</span> <span class="enscript-string">&quot;\x00&quot;</span> <span class="enscript-string">&quot;c&quot;</span> <span class="enscript-string">&quot;\x00&quot;</span> <span class="enscript-string">&quot;d&quot;</span> <span class="enscript-string">&quot;\x00&quot;</span> ); <span class="enscript-comment">// Little Endian BOM
</span>    require_action( strcmp( s, <span class="enscript-string">&quot;abc&quot;</span> ) == 0, exit, err = -1 );

    #<span class="enscript-keyword">if</span> ( TARGET_RT_BIG_ENDIAN )
    DebugSNPrintF( s, <span class="enscript-keyword">sizeof</span>( s ), <span class="enscript-string">&quot;%.*S&quot;</span>, 3, <span class="enscript-string">&quot;\x00&quot;</span> <span class="enscript-string">&quot;a&quot;</span> <span class="enscript-string">&quot;\x00&quot;</span> <span class="enscript-string">&quot;b&quot;</span> <span class="enscript-string">&quot;\x00&quot;</span> <span class="enscript-string">&quot;c&quot;</span> <span class="enscript-string">&quot;\x00&quot;</span> <span class="enscript-string">&quot;d&quot;</span> );
    require_action( strcmp( s, <span class="enscript-string">&quot;abc&quot;</span> ) == 0, exit, err = -1 );
    #<span class="enscript-keyword">else</span>
    DebugSNPrintF( s, <span class="enscript-keyword">sizeof</span>( s ), <span class="enscript-string">&quot;%.*S&quot;</span>, 3, <span class="enscript-string">&quot;a&quot;</span> <span class="enscript-string">&quot;\x00&quot;</span> <span class="enscript-string">&quot;b&quot;</span> <span class="enscript-string">&quot;\x00&quot;</span> <span class="enscript-string">&quot;c&quot;</span> <span class="enscript-string">&quot;\x00&quot;</span> <span class="enscript-string">&quot;d&quot;</span> <span class="enscript-string">&quot;\x00&quot;</span> );
    require_action( strcmp( s, <span class="enscript-string">&quot;abc&quot;</span> ) == 0, exit, err = -1 );
    #endif

    DebugSNPrintF( s, <span class="enscript-keyword">sizeof</span>( s ), <span class="enscript-string">&quot;%#.*S&quot;</span>, 3, <span class="enscript-string">&quot;\x00&quot;</span> <span class="enscript-string">&quot;a&quot;</span> <span class="enscript-string">&quot;\x00&quot;</span> <span class="enscript-string">&quot;b&quot;</span> <span class="enscript-string">&quot;\x00&quot;</span> <span class="enscript-string">&quot;c&quot;</span> <span class="enscript-string">&quot;\x00&quot;</span> <span class="enscript-string">&quot;d&quot;</span> );   <span class="enscript-comment">// Big Endian
</span>    require_action( strcmp( s, <span class="enscript-string">&quot;abc&quot;</span> ) == 0, exit, err = -1 );

    DebugSNPrintF( s, <span class="enscript-keyword">sizeof</span>( s ), <span class="enscript-string">&quot;%##.*S&quot;</span>, 3, <span class="enscript-string">&quot;a&quot;</span> <span class="enscript-string">&quot;\x00&quot;</span> <span class="enscript-string">&quot;b&quot;</span> <span class="enscript-string">&quot;\x00&quot;</span> <span class="enscript-string">&quot;c&quot;</span> <span class="enscript-string">&quot;\x00&quot;</span> <span class="enscript-string">&quot;d&quot;</span> <span class="enscript-string">&quot;\x00&quot;</span> );  <span class="enscript-comment">// Little Endian
</span>    require_action( strcmp( s, <span class="enscript-string">&quot;abc&quot;</span> ) == 0, exit, err = -1 );

    <span class="enscript-comment">// Misc
</span>
    DebugSNPrintF( s, <span class="enscript-keyword">sizeof</span>( s ), <span class="enscript-string">&quot;%U&quot;</span>, <span class="enscript-string">&quot;\x10\xb8\xa7\x6b&quot;</span> <span class="enscript-string">&quot;\xad\x9d&quot;</span> <span class="enscript-string">&quot;\xd1\x11&quot;</span> <span class="enscript-string">&quot;\x80\xb4&quot;</span> <span class="enscript-string">&quot;\x00\xc0\x4f\xd4\x30\xc8&quot;</span> );
    require_action( strcmp( s, <span class="enscript-string">&quot;6ba7b810-9dad-11d1-80b4-00c04fd430c8&quot;</span> ) == 0, exit, err = -1 );

    DebugSNPrintF( s, <span class="enscript-keyword">sizeof</span>( s ), <span class="enscript-string">&quot;%m&quot;</span>, 0 );
    require_action( strcmp( s, <span class="enscript-string">&quot;no error&quot;</span> ) == 0, exit, err = -1 );

    DebugSNPrintF( s, <span class="enscript-keyword">sizeof</span>( s ), <span class="enscript-string">&quot;%lm&quot;</span>, (<span class="enscript-type">long</span>) 0 );
    require_action( strcmp( s, <span class="enscript-string">&quot;no error&quot;</span> ) == 0, exit, err = -1 );

    DebugSNPrintF( s, <span class="enscript-keyword">sizeof</span>( s ), <span class="enscript-string">&quot;\&quot;%H\&quot;&quot;</span>, <span class="enscript-string">&quot;\x6b\xa7\xb8\x10\x9d\xad\x11\xd1\x80\xb4\x00\xc0\x4f\xd4\x30\xc8&quot;</span>, 16, 16 );
    DebugPrintF( kDebugLevelMax, <span class="enscript-string">&quot;%s\n\n&quot;</span>, s );

    DebugSNPrintF( s, <span class="enscript-keyword">sizeof</span>( s ), <span class="enscript-string">&quot;\&quot;%H\&quot;&quot;</span>,
                   <span class="enscript-string">&quot;\x6b\xa7\xb8\x10\x9d\xad\x11\xd1\x80\xb4\x00\xc0\x4f\xd4\x30\xc8&quot;</span>
                   <span class="enscript-string">&quot;\x6b\xa7\xb8\x10\x9d\xad\x11\xd1\x80\xb4\x00\xc0\x4f\xd4\x30\xc8&quot;</span>,
                   32, 32 );
    DebugPrintF( kDebugLevelMax, <span class="enscript-string">&quot;%s\n\n&quot;</span>, s );

    DebugSNPrintF( s, <span class="enscript-keyword">sizeof</span>( s ), <span class="enscript-string">&quot;\&quot;%H\&quot;&quot;</span>, <span class="enscript-string">&quot;\x6b\xa7&quot;</span>, 2, 2 );
    DebugPrintF( kDebugLevelMax, <span class="enscript-string">&quot;%s\n\n&quot;</span>, s );

    <span class="enscript-comment">// Hex Dumps
</span>
    s[ 0 ] = <span class="enscript-string">'\0'</span>;
    DebugHexDump( kDebugLevelMax, 0, <span class="enscript-string">&quot;My Label&quot;</span>, kSizeCString, 0, NULL, 0, data, data, <span class="enscript-keyword">sizeof</span>( data ),
                  kDebugFlagsNone, s, <span class="enscript-keyword">sizeof</span>( s ) );
    DebugPrintF( kDebugLevelMax, <span class="enscript-string">&quot;%s\n&quot;</span>, s );

    s[ 0 ] = <span class="enscript-string">'\0'</span>;
    DebugHexDump( kDebugLevelMax, 0, NULL, 0, 0, NULL, 0, data, data, <span class="enscript-keyword">sizeof</span>( data ),
                  kDebugFlagsNoAddress | kDebugFlagsNoOffset, s, <span class="enscript-keyword">sizeof</span>( s ) );
    DebugPrintF( kDebugLevelMax, <span class="enscript-string">&quot;%s\n&quot;</span>, s );

    s[ 0 ] = <span class="enscript-string">'\0'</span>;
    DebugHexDump( kDebugLevelMax, 0, <span class="enscript-string">&quot;My Label&quot;</span>, kSizeCString, 0, NULL, 0, data, data, <span class="enscript-keyword">sizeof</span>( data ),
                  kDebugFlagsNoAddress | kDebugFlagsNoOffset, s, <span class="enscript-keyword">sizeof</span>( s ) );
    DebugPrintF( kDebugLevelMax, <span class="enscript-string">&quot;%s\n&quot;</span>, s );

    s[ 0 ] = <span class="enscript-string">'\0'</span>;
    DebugHexDump( kDebugLevelMax, 0, <span class="enscript-string">&quot;My Label&quot;</span>, kSizeCString, 0, NULL, 0, data, data, <span class="enscript-keyword">sizeof</span>( data ),
                  kDebugFlagsNoAddress, s, <span class="enscript-keyword">sizeof</span>( s ) );
    DebugPrintF( kDebugLevelMax, <span class="enscript-string">&quot;%s\n&quot;</span>, s );

    s[ 0 ] = <span class="enscript-string">'\0'</span>;
    DebugHexDump( kDebugLevelMax, 0, NULL, 0, 0, NULL, 0, data, data, <span class="enscript-keyword">sizeof</span>( data ),
                  kDebugFlagsNoOffset, s, <span class="enscript-keyword">sizeof</span>( s ) );
    DebugPrintF( kDebugLevelMax, <span class="enscript-string">&quot;%s\n&quot;</span>, s );

    s[ 0 ] = <span class="enscript-string">'\0'</span>;
    DebugHexDump( kDebugLevelMax, 0, NULL, 0, 0, NULL, 0, data, data, <span class="enscript-keyword">sizeof</span>( data ),
                  kDebugFlagsNoAddress, s, <span class="enscript-keyword">sizeof</span>( s ) );
    DebugPrintF( kDebugLevelMax, <span class="enscript-string">&quot;%s\n&quot;</span>, s );

    s[ 0 ] = <span class="enscript-string">'\0'</span>;
    DebugHexDump( kDebugLevelMax, 0, NULL, 0, 0, NULL, 0, data, data, <span class="enscript-keyword">sizeof</span>( data ),
                  kDebugFlagsNoOffset, s, <span class="enscript-keyword">sizeof</span>( s ) );
    DebugPrintF( kDebugLevelMax, <span class="enscript-string">&quot;%s\n&quot;</span>, s );

    s[ 0 ] = <span class="enscript-string">'\0'</span>;
    DebugHexDump( kDebugLevelMax, 0, NULL, 0, 0, NULL, 0, data, data, <span class="enscript-keyword">sizeof</span>( data ),
                  kDebugFlagsNoByteCount, s, <span class="enscript-keyword">sizeof</span>( s ) );
    DebugPrintF( kDebugLevelMax, <span class="enscript-string">&quot;%s\n&quot;</span>, s );

    s[ 0 ] = <span class="enscript-string">'\0'</span>;
    DebugHexDump( kDebugLevelMax, 0, NULL, 0, 0, NULL, 0, <span class="enscript-string">&quot;\x41\x62\x43\x64&quot;</span>, <span class="enscript-string">&quot;\x41\x62\x43\x64&quot;</span>, 4,    <span class="enscript-comment">// 'AbCd'
</span>                  kDebugFlagsNoAddress | kDebugFlagsNoOffset | kDebugFlagsNoNewLine |
                  kDebugFlagsNo32BitSeparator | kDebugFlagsNo16ByteHexPad | kDebugFlagsNoByteCount,
                  s, <span class="enscript-keyword">sizeof</span>( s ) );
    DebugPrintF( kDebugLevelMax, <span class="enscript-string">&quot;%s\n&quot;</span>, s );

    s[ 0 ] = <span class="enscript-string">'\0'</span>;
    DebugHexDump( kDebugLevelMax, 0, NULL, 0, 0, NULL, 0, data, data, <span class="enscript-keyword">sizeof</span>( data ),
                  kDebugFlagsNoAddress | kDebugFlagsNoOffset | kDebugFlagsNoASCII | kDebugFlagsNoNewLine |
                  kDebugFlags16BitSeparator | kDebugFlagsNo32BitSeparator |
                  kDebugFlagsNo16ByteHexPad | kDebugFlagsNoByteCount, s, <span class="enscript-keyword">sizeof</span>( s ) );
    DebugPrintF( kDebugLevelMax, <span class="enscript-string">&quot;%s\n&quot;</span>, s );

    s[ 0 ] = <span class="enscript-string">'\0'</span>;
    DebugHexDump( kDebugLevelMax, 8, NULL, 0, 0, NULL, 0, data, data, <span class="enscript-keyword">sizeof</span>( data ), kDebugFlagsNone, s, <span class="enscript-keyword">sizeof</span>( s ) );
    DebugPrintF( kDebugLevelMax, <span class="enscript-string">&quot;%s\n&quot;</span>, s );

    <span class="enscript-comment">// dlog's
</span>
    dlog( kDebugLevelNotice, <span class="enscript-string">&quot;dlog\n&quot;</span> );
    dlog( kDebugLevelNotice, <span class="enscript-string">&quot;dlog integer: %d\n&quot;</span>, 123 );
    dlog( kDebugLevelNotice, <span class="enscript-string">&quot;dlog string:  \&quot;%s\&quot;\n&quot;</span>, <span class="enscript-string">&quot;test string&quot;</span> );
    dlogmem( kDebugLevelNotice, data, <span class="enscript-keyword">sizeof</span>( data ) );

    <span class="enscript-comment">// Done
</span>
    DebugPrintF( kDebugLevelMax, <span class="enscript-string">&quot;\n\nALL TESTS DONE\n\n&quot;</span> );
    err = kNoErr;

<span class="enscript-reference">exit</span>:
    <span class="enscript-keyword">if</span>( err )
    {
        DebugPrintF( kDebugLevelMax, <span class="enscript-string">&quot;\n\n### TEST FAILED ###\n\n&quot;</span> );
    }
    <span class="enscript-keyword">return</span>( err );
}

#<span class="enscript-reference">endif</span>  // <span class="enscript-variable-name">DEBUG</span>
</pre>
<hr />
</body></html>