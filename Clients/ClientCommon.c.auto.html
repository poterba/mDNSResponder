<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<title>ClientCommon.c</title>
<style type="text/css">
.enscript-comment { font-style: italic; color: rgb(178,34,34); }
.enscript-function-name { font-weight: bold; color: rgb(0,0,255); }
.enscript-variable-name { font-weight: bold; color: rgb(184,134,11); }
.enscript-keyword { font-weight: bold; color: rgb(160,32,240); }
.enscript-reference { font-weight: bold; color: rgb(95,158,160); }
.enscript-string { font-weight: bold; color: rgb(188,143,143); }
.enscript-builtin { font-weight: bold; color: rgb(218,112,214); }
.enscript-type { font-weight: bold; color: rgb(34,139,34); }
.enscript-highlight { text-decoration: underline; color: 0; }
</style>
</head>
<body id="top">
<h1 style="margin:8px;" id="f1">ClientCommon.c&nbsp;&nbsp;&nbsp;<span style="font-weight: normal; font-size: 0.5em;">[<a href="ClientCommon.c">plain text</a>]</span></h1>
<hr/>
<div></div>
<pre>
<span class="enscript-comment">/* -*- Mode: C; tab-width: 4 -*-
 *
 * Copyright (c) 2008-2011 Apple Inc. All rights reserved.
 *
 * Disclaimer: IMPORTANT:  This Apple software is supplied to you by Apple Inc.
 * (&quot;Apple&quot;) in consideration of your agreement to the following terms, and your
 * use, installation, modification or redistribution of this Apple software
 * constitutes acceptance of these terms.  If you do not agree with these terms,
 * please do not use, install, modify or redistribute this Apple software.
 *
 * In consideration of your agreement to abide by the following terms, and subject
 * to these terms, Apple grants you a personal, non-exclusive license, under Apple's
 * copyrights in this original Apple software (the &quot;Apple Software&quot;), to use,
 * reproduce, modify and redistribute the Apple Software, with or without
 * modifications, in source and/or binary forms; provided that if you redistribute
 * the Apple Software in its entirety and without modifications, you must retain
 * this notice and the following text and disclaimers in all such redistributions of
 * the Apple Software.  Neither the name, trademarks, service marks or logos of
 * Apple Inc. may be used to endorse or promote products derived from the
 * Apple Software without specific prior written permission from Apple.  Except as
 * expressly stated in this notice, no other rights or licenses, express or implied,
 * are granted by Apple herein, including but not limited to any patent rights that
 * may be infringed by your derivative works or by other works in which the Apple
 * Software may be incorporated.
 *
 * The Apple Software is provided by Apple on an &quot;AS IS&quot; basis.  APPLE MAKES NO
 * WARRANTIES, EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION THE IMPLIED
 * WARRANTIES OF NON-INFRINGEMENT, MERCHANTABILITY AND FITNESS FOR A PARTICULAR
 * PURPOSE, REGARDING THE APPLE SOFTWARE OR ITS USE AND OPERATION ALONE OR IN
 * COMBINATION WITH YOUR PRODUCTS.
 *
 * IN NO EVENT SHALL APPLE BE LIABLE FOR ANY SPECIAL, INDIRECT, INCIDENTAL OR
 * CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE
 * GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION)
 * ARISING IN ANY WAY OUT OF THE USE, REPRODUCTION, MODIFICATION AND/OR DISTRIBUTION
 * OF THE APPLE SOFTWARE, HOWEVER CAUSED AND WHETHER UNDER THEORY OF CONTRACT, TORT
 * (INCLUDING NEGLIGENCE), STRICT LIABILITY OR OTHERWISE, EVEN IF APPLE HAS BEEN
 * ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 */</span>

#<span class="enscript-reference">include</span> <span class="enscript-string">&lt;ctype.h&gt;</span>
#<span class="enscript-reference">include</span> <span class="enscript-string">&lt;stdio.h&gt;</span>          // For stdout, stderr

#<span class="enscript-reference">include</span> <span class="enscript-string">&quot;ClientCommon.h&quot;</span>

<span class="enscript-type">const</span> <span class="enscript-type">char</span> *<span class="enscript-function-name">GetNextLabel</span>(<span class="enscript-type">const</span> <span class="enscript-type">char</span> *cstr, <span class="enscript-type">char</span> label[64])
{
    <span class="enscript-type">char</span> *ptr = label;
    <span class="enscript-keyword">while</span> (*cstr &amp;&amp; *cstr != <span class="enscript-string">'.'</span>)               <span class="enscript-comment">// While we have characters in the label...
</span>    {
        <span class="enscript-type">char</span> c = *cstr++;
        <span class="enscript-keyword">if</span> (c == <span class="enscript-string">'\\'</span>)                          <span class="enscript-comment">// If escape character, check next character
</span>        {
            <span class="enscript-keyword">if</span> (*cstr == <span class="enscript-string">'\0'</span>) <span class="enscript-keyword">break</span>;           <span class="enscript-comment">// If this is the end of the string, then break
</span>            c = *cstr++;
            <span class="enscript-keyword">if</span> (isdigit(cstr[-1]) &amp;&amp; isdigit(cstr[0]) &amp;&amp; isdigit(cstr[1]))
            {
                <span class="enscript-type">int</span> v0 = cstr[-1] - <span class="enscript-string">'0'</span>;                        <span class="enscript-comment">// then interpret as three-digit decimal
</span>                <span class="enscript-type">int</span> v1 = cstr[ 0] - <span class="enscript-string">'0'</span>;
                <span class="enscript-type">int</span> v2 = cstr[ 1] - <span class="enscript-string">'0'</span>;
                <span class="enscript-type">int</span> val = v0 * 100 + v1 * 10 + v2;
                <span class="enscript-comment">// If valid three-digit decimal value, use it
</span>                <span class="enscript-comment">// Note that although ascii nuls are possible in DNS labels
</span>                <span class="enscript-comment">// we're building a C string here so we have no way to represent that
</span>                <span class="enscript-keyword">if</span> (val == 0) val = <span class="enscript-string">'-'</span>;
                <span class="enscript-keyword">if</span> (val &lt;= 255) { c = (<span class="enscript-type">char</span>)val; cstr += 2; }
            }
        }
        *ptr++ = c;
        <span class="enscript-keyword">if</span> (ptr &gt;= label+64) { label[63] = 0; <span class="enscript-keyword">return</span>(NULL); }   <span class="enscript-comment">// Illegal label more than 63 bytes
</span>    }
    *ptr = 0;                                                   <span class="enscript-comment">// Null-terminate label text
</span>    <span class="enscript-keyword">if</span> (ptr == label) <span class="enscript-keyword">return</span>(NULL);                             <span class="enscript-comment">// Illegal empty label
</span>    <span class="enscript-keyword">if</span> (*cstr) cstr++;                                          <span class="enscript-comment">// Skip over the trailing dot (if present)
</span>    <span class="enscript-keyword">return</span>(cstr);
}
</pre>
<hr />
</body></html>