<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<title>dnssd_xpc.c</title>
<style type="text/css">
.enscript-comment { font-style: italic; color: rgb(178,34,34); }
.enscript-function-name { font-weight: bold; color: rgb(0,0,255); }
.enscript-variable-name { font-weight: bold; color: rgb(184,134,11); }
.enscript-keyword { font-weight: bold; color: rgb(160,32,240); }
.enscript-reference { font-weight: bold; color: rgb(95,158,160); }
.enscript-string { font-weight: bold; color: rgb(188,143,143); }
.enscript-builtin { font-weight: bold; color: rgb(218,112,214); }
.enscript-type { font-weight: bold; color: rgb(34,139,34); }
.enscript-highlight { text-decoration: underline; color: 0; }
</style>
</head>
<body id="top">
<h1 style="margin:8px;" id="f1">dnssd_xpc.c&nbsp;&nbsp;&nbsp;<span style="font-weight: normal; font-size: 0.5em;">[<a href="dnssd_xpc.c">plain text</a>]</span></h1>
<hr/>
<div></div>
<pre>
<span class="enscript-comment">/*
 * Copyright (c) 2019 Apple Inc. All rights reserved.
 *
 * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     <a href="http://www.apache.org/licenses/LICENSE-2.0">http://www.apache.org/licenses/LICENSE-2.0</a>
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */</span>

#<span class="enscript-reference">include</span> <span class="enscript-string">&quot;dnssd_xpc.h&quot;</span>

#<span class="enscript-reference">if</span> 0
<span class="enscript-comment">//======================================================================================================================
</span>#<span class="enscript-reference">pragma</span> <span class="enscript-variable-name">mark</span> - <span class="enscript-variable-name">XPC</span> <span class="enscript-variable-name">Dictionary</span> <span class="enscript-variable-name">Helper</span> <span class="enscript-variable-name">Declarations</span>
#<span class="enscript-reference">endif</span>

<span class="enscript-type">static</span> int32_t
<span class="enscript-function-name">_dnssd_xpc_dictionary_get_int32</span>(xpc_object_t dict, <span class="enscript-type">const</span> <span class="enscript-type">char</span> *key, bool *out_valid);

<span class="enscript-type">static</span> int64_t
<span class="enscript-function-name">_dnssd_xpc_dictionary_get_int64</span>(xpc_object_t dict, <span class="enscript-type">const</span> <span class="enscript-type">char</span> *key, bool *out_valid);

<span class="enscript-type">static</span> int64_t
<span class="enscript-function-name">_dnssd_xpc_dictionary_get_int64_limited</span>(xpc_object_t dict, <span class="enscript-type">const</span> <span class="enscript-type">char</span> *key, int64_t min, int64_t max, bool *out_valid);

<span class="enscript-type">static</span> uint16_t
<span class="enscript-function-name">_dnssd_xpc_dictionary_get_uint16</span>(xpc_object_t dict, <span class="enscript-type">const</span> <span class="enscript-type">char</span> *key, bool *out_valid);

<span class="enscript-type">static</span> uint32_t
<span class="enscript-function-name">_dnssd_xpc_dictionary_get_uint32</span>(xpc_object_t dict, <span class="enscript-type">const</span> <span class="enscript-type">char</span> *key, bool *out_valid);

<span class="enscript-type">static</span> uint64_t
<span class="enscript-function-name">_dnssd_xpc_dictionary_get_uint64</span>(xpc_object_t dict, <span class="enscript-type">const</span> <span class="enscript-type">char</span> *key, bool *out_valid);

<span class="enscript-type">static</span> uint64_t
<span class="enscript-function-name">_dnssd_xpc_dictionary_get_uint64_limited</span>(xpc_object_t dict, <span class="enscript-type">const</span> <span class="enscript-type">char</span> *key, uint64_t min, uint64_t max,
	bool *out_valid);

<span class="enscript-type">static</span> xpc_object_t
<span class="enscript-function-name">_dnssd_xpc_dictionary_get_value</span>(xpc_object_t dict, <span class="enscript-type">const</span> <span class="enscript-type">char</span> *key, xpc_type_t type);

#<span class="enscript-reference">if</span> 0
<span class="enscript-comment">//======================================================================================================================
</span>#<span class="enscript-reference">pragma</span> <span class="enscript-variable-name">mark</span> - <span class="enscript-variable-name">Top</span>-<span class="enscript-variable-name">Level</span> <span class="enscript-variable-name">Message</span> <span class="enscript-variable-name">Dictionaries</span>
#<span class="enscript-reference">endif</span>

#<span class="enscript-reference">define</span> <span class="enscript-variable-name">DNSSD_XPC_MESSAGE_KEY_COMMAND</span>	<span class="enscript-string">&quot;command&quot;</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">DNSSD_XPC_MESSAGE_KEY_ERROR</span>		<span class="enscript-string">&quot;error&quot;</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">DNSSD_XPC_MESSAGE_KEY_ID</span>		<span class="enscript-string">&quot;id&quot;</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">DNSSD_XPC_MESSAGE_KEY_PARAMS</span>	<span class="enscript-string">&quot;params&quot;</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">DNSSD_XPC_MESSAGE_KEY_RESULTS</span>	<span class="enscript-string">&quot;results&quot;</span>

<span class="enscript-comment">//======================================================================================================================
</span>
<span class="enscript-type">const</span> <span class="enscript-type">char</span> *
<span class="enscript-function-name">dnssd_xpc_message_get_command</span>(xpc_object_t msg)
{
	<span class="enscript-keyword">return</span> xpc_dictionary_get_string(msg, DNSSD_XPC_MESSAGE_KEY_COMMAND);
}

<span class="enscript-comment">//======================================================================================================================
</span>
<span class="enscript-type">void</span>
<span class="enscript-function-name">dnssd_xpc_message_set_command</span>(xpc_object_t msg, <span class="enscript-type">const</span> <span class="enscript-type">char</span> *command)
{
	xpc_dictionary_set_string(msg, DNSSD_XPC_MESSAGE_KEY_COMMAND, command);
}

<span class="enscript-comment">//======================================================================================================================
</span>
DNSServiceErrorType
<span class="enscript-function-name">dnssd_xpc_message_get_error</span>(xpc_object_t msg, bool *out_valid)
{
	<span class="enscript-keyword">return</span> _dnssd_xpc_dictionary_get_int32(msg, DNSSD_XPC_MESSAGE_KEY_ERROR, out_valid);
}

<span class="enscript-comment">//======================================================================================================================
</span>
<span class="enscript-type">void</span>
<span class="enscript-function-name">dnssd_xpc_message_set_error</span>(xpc_object_t msg, DNSServiceErrorType error)
{
	xpc_dictionary_set_int64(msg, DNSSD_XPC_MESSAGE_KEY_ERROR, error);
}

<span class="enscript-comment">//======================================================================================================================
</span>
uint64_t
<span class="enscript-function-name">dnssd_xpc_message_get_id</span>(xpc_object_t msg, bool *out_valid)
{
	<span class="enscript-keyword">return</span> _dnssd_xpc_dictionary_get_uint64(msg, DNSSD_XPC_MESSAGE_KEY_ID, out_valid);
}

<span class="enscript-comment">//======================================================================================================================
</span>
<span class="enscript-type">void</span>
<span class="enscript-function-name">dnssd_xpc_message_set_id</span>(xpc_object_t msg, uint64_t ident)
{
	xpc_dictionary_set_uint64(msg, DNSSD_XPC_MESSAGE_KEY_ID, ident);
}

<span class="enscript-comment">//======================================================================================================================
</span>
xpc_object_t
<span class="enscript-function-name">dnssd_xpc_message_get_parameters</span>(xpc_object_t msg)
{
	<span class="enscript-keyword">return</span> xpc_dictionary_get_dictionary(msg, DNSSD_XPC_MESSAGE_KEY_PARAMS);
}

<span class="enscript-comment">//======================================================================================================================
</span>
<span class="enscript-type">void</span>
<span class="enscript-function-name">dnssd_xpc_message_set_parameters</span>(xpc_object_t msg, xpc_object_t params)
{
	xpc_dictionary_set_value(msg, DNSSD_XPC_MESSAGE_KEY_PARAMS, params);
}

<span class="enscript-comment">//======================================================================================================================
</span>
xpc_object_t
<span class="enscript-function-name">dnssd_xpc_message_get_results</span>(xpc_object_t msg)
{
	<span class="enscript-keyword">return</span> xpc_dictionary_get_array(msg, DNSSD_XPC_MESSAGE_KEY_RESULTS);
}

<span class="enscript-comment">//======================================================================================================================
</span>
<span class="enscript-type">void</span>
<span class="enscript-function-name">dnssd_xpc_message_set_results</span>(xpc_object_t msg, xpc_object_t results)
{
	xpc_dictionary_set_value(msg, DNSSD_XPC_MESSAGE_KEY_RESULTS, results);
}

#<span class="enscript-reference">if</span> 0
<span class="enscript-comment">//======================================================================================================================
</span>#<span class="enscript-reference">pragma</span> <span class="enscript-variable-name">mark</span> - <span class="enscript-variable-name">Parameter</span> <span class="enscript-variable-name">Dictionaries</span>
#<span class="enscript-reference">endif</span>

#<span class="enscript-reference">define</span> <span class="enscript-variable-name">DNSSD_XPC_PARAMETERS_KEY_DELEGATE_ID</span>		<span class="enscript-string">&quot;delegate_id&quot;</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">DNSSD_XPC_PARAMETERS_KEY_FLAGS</span>				<span class="enscript-string">&quot;flags&quot;</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">DNSSD_XPC_PARAMETERS_KEY_HOSTNAME</span>			<span class="enscript-string">&quot;hostname&quot;</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">DNSSD_XPC_PARAMETERS_KEY_INTERFACE_INDEX</span>	<span class="enscript-string">&quot;interface_index&quot;</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">DNSSD_XPC_PARAMETERS_KEY_NEED_AUTH_TAGS</span>		<span class="enscript-string">&quot;need_auth_tags&quot;</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">DNSSD_XPC_PARAMETERS_KEY_PROTOCOLS</span>			<span class="enscript-string">&quot;protocols&quot;</span>

<span class="enscript-comment">//======================================================================================================================
</span>
pid_t
<span class="enscript-function-name">dnssd_xpc_parameters_get_delegate_pid</span>(xpc_object_t params, bool *out_valid)
{
	<span class="enscript-keyword">return</span> (pid_t)_dnssd_xpc_dictionary_get_int64(params, DNSSD_XPC_PARAMETERS_KEY_DELEGATE_ID, out_valid);
}

<span class="enscript-comment">//======================================================================================================================
</span>
<span class="enscript-type">void</span>
<span class="enscript-function-name">dnssd_xpc_parameters_set_delegate_pid</span>(xpc_object_t params, pid_t pid)
{
	xpc_dictionary_set_int64(params, DNSSD_XPC_PARAMETERS_KEY_DELEGATE_ID, pid);
}

<span class="enscript-comment">//======================================================================================================================
</span>
<span class="enscript-type">const</span> uint8_t *
<span class="enscript-function-name">dnssd_xpc_parameters_get_delegate_uuid</span>(xpc_object_t params)
{
	<span class="enscript-keyword">return</span> xpc_dictionary_get_uuid(params, DNSSD_XPC_PARAMETERS_KEY_DELEGATE_ID);
}

<span class="enscript-comment">//======================================================================================================================
</span>
<span class="enscript-type">void</span>
<span class="enscript-function-name">dnssd_xpc_parameters_set_delegate_uuid</span>(xpc_object_t params, uuid_t uuid)
{
	xpc_dictionary_set_uuid(params, DNSSD_XPC_PARAMETERS_KEY_DELEGATE_ID, uuid);
}

<span class="enscript-comment">//======================================================================================================================
</span>
DNSServiceFlags
<span class="enscript-function-name">dnssd_xpc_parameters_get_flags</span>(xpc_object_t params, bool *out_valid)
{
	<span class="enscript-keyword">return</span> _dnssd_xpc_dictionary_get_uint32(params, DNSSD_XPC_PARAMETERS_KEY_FLAGS, out_valid);
}

<span class="enscript-comment">//======================================================================================================================
</span>
<span class="enscript-type">void</span>
<span class="enscript-function-name">dnssd_xpc_parameters_set_flags</span>(xpc_object_t params, DNSServiceFlags flags)
{
	xpc_dictionary_set_uint64(params, DNSSD_XPC_PARAMETERS_KEY_FLAGS, flags);
}

<span class="enscript-comment">//======================================================================================================================
</span>
xpc_object_t
<span class="enscript-function-name">dnssd_xpc_parameters_get_hostname_object</span>(xpc_object_t params)
{
	<span class="enscript-keyword">return</span> _dnssd_xpc_dictionary_get_value(params, DNSSD_XPC_PARAMETERS_KEY_HOSTNAME, XPC_TYPE_STRING);
}

<span class="enscript-comment">//======================================================================================================================
</span>
<span class="enscript-type">void</span>
<span class="enscript-function-name">dnssd_xpc_parameters_set_hostname</span>(xpc_object_t params, <span class="enscript-type">const</span> <span class="enscript-type">char</span> *hostname)
{
	xpc_dictionary_set_string(params, DNSSD_XPC_PARAMETERS_KEY_HOSTNAME, hostname);
}

<span class="enscript-comment">//======================================================================================================================
</span>
uint32_t
<span class="enscript-function-name">dnssd_xpc_parameters_get_interface_index</span>(xpc_object_t params, bool *out_valid)
{
	<span class="enscript-keyword">return</span> _dnssd_xpc_dictionary_get_uint32(params, DNSSD_XPC_PARAMETERS_KEY_INTERFACE_INDEX, out_valid);
}

<span class="enscript-comment">//======================================================================================================================
</span>
<span class="enscript-type">void</span>
<span class="enscript-function-name">dnssd_xpc_parameters_set_interface_index</span>(xpc_object_t params, uint32_t interface_index)
{
	xpc_dictionary_set_uint64(params, DNSSD_XPC_PARAMETERS_KEY_INTERFACE_INDEX, interface_index);
}

<span class="enscript-comment">//======================================================================================================================
</span>
bool
<span class="enscript-function-name">dnssd_xpc_parameters_get_need_authentication_tags</span>(xpc_object_t params)
{
	<span class="enscript-keyword">return</span> xpc_dictionary_get_bool(params, DNSSD_XPC_PARAMETERS_KEY_NEED_AUTH_TAGS);
}

<span class="enscript-comment">//======================================================================================================================
</span>
<span class="enscript-type">void</span>
<span class="enscript-function-name">dnssd_xpc_parameters_set_need_authentication_tags</span>(xpc_object_t params, bool need_auth_tags)
{
	xpc_dictionary_set_bool(params, DNSSD_XPC_PARAMETERS_KEY_NEED_AUTH_TAGS, need_auth_tags);
}

<span class="enscript-comment">//======================================================================================================================
</span>
DNSServiceProtocol
<span class="enscript-function-name">dnssd_xpc_parameters_get_protocols</span>(xpc_object_t params, bool *out_valid)
{
	<span class="enscript-keyword">return</span> _dnssd_xpc_dictionary_get_uint32(params, DNSSD_XPC_PARAMETERS_KEY_PROTOCOLS, out_valid);
}

<span class="enscript-comment">//======================================================================================================================
</span>
<span class="enscript-type">void</span>
<span class="enscript-function-name">dnssd_xpc_parameters_set_protocols</span>(xpc_object_t params, DNSServiceProtocol protocols)
{
	xpc_dictionary_set_uint64(params, DNSSD_XPC_PARAMETERS_KEY_PROTOCOLS, protocols);
}

#<span class="enscript-reference">if</span> 0
<span class="enscript-comment">//======================================================================================================================
</span>#<span class="enscript-reference">pragma</span> <span class="enscript-variable-name">mark</span> - <span class="enscript-variable-name">Result</span> <span class="enscript-variable-name">Dictionaries</span>
#<span class="enscript-reference">endif</span>

#<span class="enscript-reference">define</span> <span class="enscript-variable-name">DNSSD_XPC_RESULT_KEY_AUTH_TAG</span>			<span class="enscript-string">&quot;auth_tag&quot;</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">DNSSD_XPC_RESULT_KEY_ERROR</span>				<span class="enscript-string">&quot;error&quot;</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">DNSSD_XPC_RESULT_KEY_FLAGS</span>				<span class="enscript-string">&quot;flags&quot;</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">DNSSD_XPC_RESULT_KEY_INTERFACE_INDEX</span>	<span class="enscript-string">&quot;interface_index&quot;</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">DNSSD_XPC_RESULT_KEY_RECORD_CLASS</span>		<span class="enscript-string">&quot;rclass&quot;</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">DNSSD_XPC_RESULT_KEY_RECORD_DATA</span>		<span class="enscript-string">&quot;rdata&quot;</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">DNSSD_XPC_RESULT_KEY_RECORD_NAME</span>		<span class="enscript-string">&quot;rname&quot;</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">DNSSD_XPC_RESULT_KEY_RECORD_TYPE</span>		<span class="enscript-string">&quot;rtype&quot;</span>

<span class="enscript-comment">//======================================================================================================================
</span>
xpc_object_t
<span class="enscript-function-name">dnssd_xpc_result_get_authentication_tag_object</span>(xpc_object_t result)
{
	<span class="enscript-keyword">return</span> _dnssd_xpc_dictionary_get_value(result, DNSSD_XPC_RESULT_KEY_AUTH_TAG, XPC_TYPE_DATA);
}

<span class="enscript-comment">//======================================================================================================================
</span>
<span class="enscript-type">void</span>
<span class="enscript-function-name">dnssd_xpc_result_set_authentication_tag</span>(xpc_object_t result, <span class="enscript-type">const</span> <span class="enscript-type">void</span> *auth_tag_ptr, size_t auth_tag_len)
{
	xpc_dictionary_set_data(result, DNSSD_XPC_RESULT_KEY_AUTH_TAG, auth_tag_ptr, auth_tag_len);
}

<span class="enscript-comment">//======================================================================================================================
</span>
DNSServiceErrorType
<span class="enscript-function-name">dnssd_xpc_result_get_error</span>(xpc_object_t result, bool *out_valid)
{
	<span class="enscript-keyword">return</span> _dnssd_xpc_dictionary_get_int32(result, DNSSD_XPC_RESULT_KEY_ERROR, out_valid);
}

<span class="enscript-comment">//======================================================================================================================
</span>
<span class="enscript-type">void</span>
<span class="enscript-function-name">dnssd_xpc_result_set_error</span>(xpc_object_t result, DNSServiceErrorType error)
{
	xpc_dictionary_set_int64(result, DNSSD_XPC_RESULT_KEY_ERROR, error);
}

<span class="enscript-comment">//======================================================================================================================
</span>
DNSServiceFlags
<span class="enscript-function-name">dnssd_xpc_result_get_flags</span>(xpc_object_t result, bool *out_valid)
{
	<span class="enscript-keyword">return</span> _dnssd_xpc_dictionary_get_uint32(result, DNSSD_XPC_RESULT_KEY_FLAGS, out_valid);
}

<span class="enscript-comment">//======================================================================================================================
</span>
<span class="enscript-type">void</span>
<span class="enscript-function-name">dnssd_xpc_result_set_flags</span>(xpc_object_t result, DNSServiceFlags flags)
{
	xpc_dictionary_set_uint64(result, DNSSD_XPC_RESULT_KEY_FLAGS, flags);
}

<span class="enscript-comment">//======================================================================================================================
</span>
uint32_t
<span class="enscript-function-name">dnssd_xpc_result_get_interface_index</span>(xpc_object_t result, bool *out_valid)
{
	<span class="enscript-keyword">return</span> _dnssd_xpc_dictionary_get_uint32(result, DNSSD_XPC_RESULT_KEY_INTERFACE_INDEX, out_valid);
}

<span class="enscript-comment">//======================================================================================================================
</span>
<span class="enscript-type">void</span>
<span class="enscript-function-name">dnssd_xpc_result_set_interface_index</span>(xpc_object_t result, uint32_t interface_index)
{
	xpc_dictionary_set_uint64(result, DNSSD_XPC_RESULT_KEY_INTERFACE_INDEX, interface_index);
}

<span class="enscript-comment">//======================================================================================================================
</span>
uint16_t
<span class="enscript-function-name">dnssd_xpc_result_get_record_class</span>(xpc_object_t result, bool *out_valid)
{
	<span class="enscript-keyword">return</span> _dnssd_xpc_dictionary_get_uint16(result, DNSSD_XPC_RESULT_KEY_RECORD_CLASS, out_valid);
}

<span class="enscript-comment">//======================================================================================================================
</span>
<span class="enscript-type">void</span>
<span class="enscript-function-name">dnssd_xpc_result_set_record_class</span>(xpc_object_t result, uint16_t class)
{
	xpc_dictionary_set_uint64(result, DNSSD_XPC_RESULT_KEY_RECORD_CLASS, class);
}

<span class="enscript-comment">//======================================================================================================================
</span>
xpc_object_t
<span class="enscript-function-name">dnssd_xpc_result_get_record_data_object</span>(xpc_object_t result)
{
	<span class="enscript-keyword">return</span> _dnssd_xpc_dictionary_get_value(result, DNSSD_XPC_RESULT_KEY_RECORD_DATA, XPC_TYPE_DATA);
}

<span class="enscript-comment">//======================================================================================================================
</span>
<span class="enscript-type">void</span>
<span class="enscript-function-name">dnssd_xpc_result_set_record_data</span>(xpc_object_t result, <span class="enscript-type">const</span> <span class="enscript-type">void</span> *data_ptr, size_t data_len)
{
	xpc_dictionary_set_data(result, DNSSD_XPC_RESULT_KEY_RECORD_DATA, data_ptr, data_len);
}

<span class="enscript-comment">//======================================================================================================================
</span>
xpc_object_t
<span class="enscript-function-name">dnssd_xpc_result_get_record_name_object</span>(xpc_object_t result)
{
	<span class="enscript-keyword">return</span> _dnssd_xpc_dictionary_get_value(result, DNSSD_XPC_RESULT_KEY_RECORD_NAME, XPC_TYPE_STRING);
}

<span class="enscript-comment">//======================================================================================================================
</span>
<span class="enscript-type">void</span>
<span class="enscript-function-name">dnssd_xpc_result_set_record_name</span>(xpc_object_t result, <span class="enscript-type">const</span> <span class="enscript-type">char</span> *name)
{
	xpc_dictionary_set_string(result, DNSSD_XPC_RESULT_KEY_RECORD_NAME, name);
}

<span class="enscript-comment">//======================================================================================================================
</span>
uint16_t
<span class="enscript-function-name">dnssd_xpc_result_get_record_type</span>(xpc_object_t result, bool *out_valid)
{
	<span class="enscript-keyword">return</span> _dnssd_xpc_dictionary_get_uint16(result, DNSSD_XPC_RESULT_KEY_RECORD_TYPE, out_valid);
}

<span class="enscript-comment">//======================================================================================================================
</span>
<span class="enscript-type">void</span>
<span class="enscript-function-name">dnssd_xpc_result_set_record_type</span>(xpc_object_t result, uint16_t type)
{
	xpc_dictionary_set_uint64(result, DNSSD_XPC_RESULT_KEY_RECORD_TYPE, type);
}

#<span class="enscript-reference">if</span> 0
<span class="enscript-comment">//======================================================================================================================
</span>#<span class="enscript-reference">pragma</span> <span class="enscript-variable-name">mark</span> - <span class="enscript-variable-name">XPC</span> <span class="enscript-variable-name">Dictionary</span> <span class="enscript-variable-name">Helpers</span>
#<span class="enscript-reference">endif</span>

<span class="enscript-type">static</span> int32_t
<span class="enscript-function-name">_dnssd_xpc_dictionary_get_int32</span>(xpc_object_t dict, <span class="enscript-type">const</span> <span class="enscript-type">char</span> *key, bool *out_valid)
{
	<span class="enscript-keyword">return</span> (int32_t)_dnssd_xpc_dictionary_get_int64_limited(dict, key, INT32_MIN, INT32_MAX, out_valid);
}

<span class="enscript-comment">//======================================================================================================================
</span>
<span class="enscript-type">static</span> int64_t
<span class="enscript-function-name">_dnssd_xpc_dictionary_get_int64</span>(xpc_object_t dict, <span class="enscript-type">const</span> <span class="enscript-type">char</span> *key, bool *out_valid)
{
	<span class="enscript-keyword">return</span> _dnssd_xpc_dictionary_get_int64_limited(dict, key, INT64_MIN, INT64_MAX, out_valid);
}

<span class="enscript-comment">//======================================================================================================================
</span>
<span class="enscript-type">static</span> int64_t
<span class="enscript-function-name">_dnssd_xpc_dictionary_get_int64_limited</span>(xpc_object_t dict, <span class="enscript-type">const</span> <span class="enscript-type">char</span> *key, int64_t min, int64_t max, bool *out_valid)
{
	int64_t	i64;
	bool	valid;

	xpc_object_t <span class="enscript-type">const</span> value = _dnssd_xpc_dictionary_get_value(dict, key, XPC_TYPE_INT64);
	<span class="enscript-keyword">if</span> (value) {
		i64 = xpc_int64_get_value(value);
		<span class="enscript-keyword">if</span> ((i64 &gt;= min) &amp;&amp; (i64 &lt;= max)) {
			valid	= true;
		} <span class="enscript-keyword">else</span> {
			i64		= 0;
			valid	= false;
		}
	} <span class="enscript-keyword">else</span> {
		i64		= 0;
		valid	= false;
	}
	<span class="enscript-keyword">if</span> (out_valid) {
		*out_valid = valid;
	}
	<span class="enscript-keyword">return</span> i64;
}

<span class="enscript-comment">//======================================================================================================================
</span>
<span class="enscript-type">static</span> uint16_t
<span class="enscript-function-name">_dnssd_xpc_dictionary_get_uint16</span>(xpc_object_t dict, <span class="enscript-type">const</span> <span class="enscript-type">char</span> *key, bool *out_valid)
{
	<span class="enscript-keyword">return</span> (uint16_t)_dnssd_xpc_dictionary_get_uint64_limited(dict, key, 0, UINT16_MAX, out_valid);
}

<span class="enscript-comment">//======================================================================================================================
</span>
<span class="enscript-type">static</span> uint32_t
<span class="enscript-function-name">_dnssd_xpc_dictionary_get_uint32</span>(xpc_object_t dict, <span class="enscript-type">const</span> <span class="enscript-type">char</span> *key, bool *out_valid)
{
	<span class="enscript-keyword">return</span> (uint32_t)_dnssd_xpc_dictionary_get_uint64_limited(dict, key, 0, UINT32_MAX, out_valid);
}

<span class="enscript-comment">//======================================================================================================================
</span>
<span class="enscript-type">static</span> uint64_t
<span class="enscript-function-name">_dnssd_xpc_dictionary_get_uint64</span>(xpc_object_t dict, <span class="enscript-type">const</span> <span class="enscript-type">char</span> *key, bool *out_valid)
{
	<span class="enscript-keyword">return</span> _dnssd_xpc_dictionary_get_uint64_limited(dict, key, 0, UINT64_MAX, out_valid);
}

<span class="enscript-comment">//======================================================================================================================
</span>
<span class="enscript-type">static</span> uint64_t
<span class="enscript-function-name">_dnssd_xpc_dictionary_get_uint64_limited</span>(xpc_object_t dict, <span class="enscript-type">const</span> <span class="enscript-type">char</span> *key, uint64_t min, uint64_t max,
	bool *out_valid)
{
	uint64_t	u64;
	bool		valid;

	xpc_object_t <span class="enscript-type">const</span> value = _dnssd_xpc_dictionary_get_value(dict, key, XPC_TYPE_UINT64);
	<span class="enscript-keyword">if</span> (value) {
		u64 = xpc_uint64_get_value(value);
		<span class="enscript-keyword">if</span> ((u64 &gt;= min) &amp;&amp; (u64 &lt;= max)) {
			valid	= true;
		} <span class="enscript-keyword">else</span> {
			u64		= 0;
			valid	= false;
		}
	} <span class="enscript-keyword">else</span> {
		u64		= 0;
		valid	= false;
	}
	<span class="enscript-keyword">if</span> (out_valid) {
		*out_valid = valid;
	}
	<span class="enscript-keyword">return</span> u64;
}

<span class="enscript-comment">//======================================================================================================================
</span>
<span class="enscript-type">static</span> xpc_object_t
<span class="enscript-function-name">_dnssd_xpc_dictionary_get_value</span>(xpc_object_t dict, <span class="enscript-type">const</span> <span class="enscript-type">char</span> *key, xpc_type_t type)
{
	xpc_object_t value = xpc_dictionary_get_value(dict, key);
	<span class="enscript-keyword">return</span> (value &amp;&amp; (xpc_get_type(value) == type)) ? value : NULL;
}
</pre>
<hr />
</body></html>