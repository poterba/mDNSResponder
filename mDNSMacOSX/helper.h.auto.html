<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<title>helper.h</title>
<style type="text/css">
.enscript-comment { font-style: italic; color: rgb(178,34,34); }
.enscript-function-name { font-weight: bold; color: rgb(0,0,255); }
.enscript-variable-name { font-weight: bold; color: rgb(184,134,11); }
.enscript-keyword { font-weight: bold; color: rgb(160,32,240); }
.enscript-reference { font-weight: bold; color: rgb(95,158,160); }
.enscript-string { font-weight: bold; color: rgb(188,143,143); }
.enscript-builtin { font-weight: bold; color: rgb(218,112,214); }
.enscript-type { font-weight: bold; color: rgb(34,139,34); }
.enscript-highlight { text-decoration: underline; color: 0; }
</style>
</head>
<body id="top">
<h1 style="margin:8px;" id="f1">helper.h&nbsp;&nbsp;&nbsp;<span style="font-weight: normal; font-size: 0.5em;">[<a href="helper.h">plain text</a>]</span></h1>
<hr/>
<div></div>
<pre>
<span class="enscript-comment">/* -*- Mode: C; tab-width: 4 -*-
 *
 * Copyright (c) 2007-2019 Apple Inc. All rights reserved.
 *
 * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     <a href="http://www.apache.org/licenses/LICENSE-2.0">http://www.apache.org/licenses/LICENSE-2.0</a>
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */</span>

#<span class="enscript-reference">ifndef</span> <span class="enscript-variable-name">H_HELPER_H</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">H_HELPER_H</span>

#<span class="enscript-reference">include</span> <span class="enscript-string">&lt;os/log.h&gt;</span>

#<span class="enscript-reference">define</span> <span class="enscript-variable-name">kHelperService</span> <span class="enscript-string">&quot;com.apple.mDNSResponder_Helper&quot;</span>

#<span class="enscript-reference">define</span> <span class="enscript-variable-name">kmDNSHelperProgramArgs</span> CFSTR(<span class="enscript-string">&quot;com.apple.mDNSResponderHelper&quot;</span>)
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">kPreferencesKey_mDNSHelperLog</span>  CFSTR(<span class="enscript-string">&quot;mDNSHelperDebugLogging&quot;</span>)

#<span class="enscript-reference">define</span> <span class="enscript-variable-name">kHelperMode</span>             <span class="enscript-string">&quot;HelperMode&quot;</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">kHelperReplyStatus</span>      <span class="enscript-string">&quot;HelperReplyStatusToClient&quot;</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">kHelperErrCode</span>          <span class="enscript-string">&quot;HelperErrorCodefromCall&quot;</span>

#<span class="enscript-reference">define</span> <span class="enscript-variable-name">kPrefsNameKey</span>  <span class="enscript-string">&quot;PreferencesNameKey&quot;</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">kPrefsOldName</span>  <span class="enscript-string">&quot;PreferencesOldName&quot;</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">kPrefsNewName</span>  <span class="enscript-string">&quot;PreferencesNewName&quot;</span>

<span class="enscript-type">extern</span> <span class="enscript-type">int</span> mDNSHelperLogEnabled;

<span class="enscript-type">extern</span> os_log_t  log_handle;

<span class="enscript-type">typedef</span> <span class="enscript-type">enum</span>
{
    bpf_request = 1,
    set_name = 2,
    p2p_packetfilter = 3,
    user_notify = 4,
    power_req = 5,
    send_wakepkt = 6,
    set_localaddr_cacheentry = 7,
    send_keepalive = 8,
    retreive_tcpinfo = 9,
    keychain_getsecrets = 10,
} HelperModes;

<span class="enscript-type">typedef</span> <span class="enscript-type">enum</span>
{
    kHelperReply_ACK = 0,
} HelperReplyStatusCodes;


<span class="enscript-type">typedef</span> <span class="enscript-type">enum</span>
{
    kHelperErr_NoErr = 0,
    kHelperErr_DefaultErr = -1,
    kHelperErr_NotConnected = -2,
    kHelperErr_NoResponse = -3,
    kHelperErr_UndefinedMode = -4,
    kHelperErr_ApiErr = -5,
    kHelperErr_InvalidTunnelSetKeysOperation = -6,
    kHelperErr_InvalidNetworkAddress = -7,
    kHelperErr_ResultTooLarge = -8,
    kHelperErr_RacoonConfigCreationFailed = -9,
    kHelperErr_IPsecPolicySocketCreationFailed = -10,
    kHelperErr_IPsecPolicyCreationFailed = -11,
    kHelperErr_IPsecPolicySetFailed = -12,
    kHelperErr_IPsecRemoveSAFailed = -13,
    kHelperErr_IPsecDisabled = -14,
    kHelperErr_RoutingSocketCreationFailed = -15,
    kHelperErr_RouteDeletionFailed = -16,
    kHelperErr_RouteAdditionFailed = -17,
    kHelperErr_RacoonStartFailed = -18,
    kHelperErr_RacoonNotificationFailed = -19,
    kHelperErr_ParamErr = -20,
} HelperErrorCodes;


<span class="enscript-type">enum</span> mDNSPreferencesSetNameKey
{
    kmDNSComputerName = 1,
    kmDNSLocalHostName
};

<span class="enscript-type">enum</span> mDNSUpDown
{
    kmDNSUp = 1,
    kmDNSDown
};

<span class="enscript-comment">// helper parses the system keychain and returns the information to mDNSResponder.
</span><span class="enscript-comment">// It returns four attributes. Attributes are defined after how they show up in
</span><span class="enscript-comment">// keychain access utility (the actual attribute name to retrieve these are different).
</span><span class="enscript-type">enum</span> mDNSKeyChainAttributes
{
    kmDNSKcWhere,   <span class="enscript-comment">// Where
</span>    kmDNSKcAccount, <span class="enscript-comment">// Account
</span>    kmDNSKcKey,     <span class="enscript-comment">// Key
</span>    kmDNSKcName     <span class="enscript-comment">// Name
</span>};

#<span class="enscript-reference">include</span> <span class="enscript-string">&quot;mDNSEmbeddedAPI.h&quot;</span>
#<span class="enscript-reference">include</span> <span class="enscript-string">&quot;helpermsg-types.h&quot;</span>

<span class="enscript-type">extern</span> <span class="enscript-type">const</span> <span class="enscript-type">char</span> *<span class="enscript-function-name">mDNSHelperError</span>(<span class="enscript-type">int</span> errornum);

<span class="enscript-type">extern</span> mStatus <span class="enscript-function-name">mDNSHelperInit</span>(<span class="enscript-type">void</span>);


<span class="enscript-type">extern</span> <span class="enscript-type">void</span> <span class="enscript-function-name">mDNSRequestBPF</span>(<span class="enscript-type">void</span>);
<span class="enscript-type">extern</span> <span class="enscript-type">int</span>  <span class="enscript-function-name">mDNSPowerRequest</span>(<span class="enscript-type">int</span> key, <span class="enscript-type">int</span> interval);
<span class="enscript-type">extern</span> <span class="enscript-type">int</span>  <span class="enscript-function-name">mDNSSetLocalAddressCacheEntry</span>(<span class="enscript-type">int</span> ifindex, <span class="enscript-type">int</span> family, <span class="enscript-type">const</span> v6addr_t ip, <span class="enscript-type">const</span> ethaddr_t eth);
<span class="enscript-type">extern</span> <span class="enscript-type">void</span> <span class="enscript-function-name">mDNSNotify</span>(<span class="enscript-type">const</span> <span class="enscript-type">char</span> *title, <span class="enscript-type">const</span> <span class="enscript-type">char</span> *msg);     <span class="enscript-comment">// Both strings are UTF-8 text
</span><span class="enscript-type">extern</span> <span class="enscript-type">void</span> <span class="enscript-function-name">mDNSPreferencesSetName</span>(<span class="enscript-type">int</span> key, domainlabel *old, domainlabel *new);
<span class="enscript-type">extern</span> <span class="enscript-type">int</span>  <span class="enscript-function-name">mDNSKeychainGetSecrets</span>(CFArrayRef *secrets);
<span class="enscript-type">extern</span> <span class="enscript-type">void</span> <span class="enscript-function-name">mDNSSendWakeupPacket</span>(<span class="enscript-type">unsigned</span> ifid, <span class="enscript-type">char</span> *eth_addr, <span class="enscript-type">char</span> *ip_addr, <span class="enscript-type">int</span> iteration);
<span class="enscript-type">extern</span> <span class="enscript-type">void</span> <span class="enscript-function-name">mDNSPacketFilterControl</span>(uint32_t command, <span class="enscript-type">char</span> * ifname, uint32_t count, pfArray_t portArray, pfArray_t protocolArray);
<span class="enscript-type">extern</span> <span class="enscript-type">void</span> <span class="enscript-function-name">mDNSSendKeepalive</span>(<span class="enscript-type">const</span> v6addr_t sadd, <span class="enscript-type">const</span> v6addr_t dadd, uint16_t lport, uint16_t rport, <span class="enscript-type">unsigned</span> seq, <span class="enscript-type">unsigned</span> ack, uint16_t win);
<span class="enscript-type">extern</span> <span class="enscript-type">int</span>  <span class="enscript-function-name">mDNSRetrieveTCPInfo</span>(<span class="enscript-type">int</span> family, v6addr_t laddr, uint16_t lport, v6addr_t raddr, uint16_t rport, uint32_t *seq, uint32_t *ack, uint16_t *win, int32_t *intfid);

<span class="enscript-type">extern</span> <span class="enscript-type">void</span> <span class="enscript-function-name">RequestBPF</span>(<span class="enscript-type">void</span>);
<span class="enscript-type">extern</span> <span class="enscript-type">void</span> <span class="enscript-function-name">PreferencesSetName</span>(<span class="enscript-type">int</span> key, <span class="enscript-type">const</span> <span class="enscript-type">char</span>* old, <span class="enscript-type">const</span> <span class="enscript-type">char</span>* new);
<span class="enscript-type">extern</span> <span class="enscript-type">void</span> <span class="enscript-function-name">PacketFilterControl</span>(uint32_t command, <span class="enscript-type">const</span> <span class="enscript-type">char</span> * ifname, uint32_t count, pfArray_t portArray, pfArray_t protocolArray);
<span class="enscript-type">extern</span> <span class="enscript-type">void</span> <span class="enscript-function-name">UserNotify</span>(<span class="enscript-type">const</span> <span class="enscript-type">char</span> *title, <span class="enscript-type">const</span> <span class="enscript-type">char</span> *msg);     <span class="enscript-comment">// Both strings are UTF-8 text
</span><span class="enscript-type">extern</span> <span class="enscript-type">void</span> <span class="enscript-function-name">PowerRequest</span>(<span class="enscript-type">int</span> key, <span class="enscript-type">int</span> interval, <span class="enscript-type">int</span> *error);
<span class="enscript-type">extern</span> <span class="enscript-type">void</span> <span class="enscript-function-name">SendWakeupPacket</span>(<span class="enscript-type">unsigned</span> <span class="enscript-type">int</span> ifid, <span class="enscript-type">const</span> <span class="enscript-type">char</span> *eth_addr, <span class="enscript-type">const</span> <span class="enscript-type">char</span> *ip_addr, <span class="enscript-type">int</span> iteration);
<span class="enscript-type">extern</span> <span class="enscript-type">void</span> <span class="enscript-function-name">SetLocalAddressCacheEntry</span>(<span class="enscript-type">int</span> ifindex, <span class="enscript-type">int</span> family, <span class="enscript-type">const</span> v6addr_t ip, <span class="enscript-type">const</span> ethaddr_t eth, <span class="enscript-type">int</span> *err);
<span class="enscript-type">extern</span> <span class="enscript-type">void</span> <span class="enscript-function-name">SendKeepalive</span>(<span class="enscript-type">const</span> v6addr_t sadd6, <span class="enscript-type">const</span> v6addr_t dadd6, uint16_t lport, uint16_t rport, uint32_t seq, uint32_t ack, uint16_t win);
<span class="enscript-type">extern</span> <span class="enscript-type">void</span> <span class="enscript-function-name">RetrieveTCPInfo</span>(<span class="enscript-type">int</span> family, <span class="enscript-type">const</span> v6addr_t laddr, uint16_t lport, <span class="enscript-type">const</span> v6addr_t raddr, uint16_t  rport, uint32_t *seq, uint32_t *ack, uint16_t *win, int32_t *intfid, <span class="enscript-type">int</span> *err);
<span class="enscript-type">extern</span> <span class="enscript-type">void</span> <span class="enscript-function-name">KeychainGetSecrets</span>(__unused <span class="enscript-type">unsigned</span> <span class="enscript-type">int</span> *numsecrets,__unused <span class="enscript-type">unsigned</span> <span class="enscript-type">long</span> *secrets, __unused <span class="enscript-type">unsigned</span> <span class="enscript-type">int</span> *secretsCnt, __unused <span class="enscript-type">int</span> *err);
<span class="enscript-type">extern</span> <span class="enscript-type">int</span>  <span class="enscript-function-name">HelperAutoTunnelSetKeys</span>(<span class="enscript-type">int</span> replacedelete, <span class="enscript-type">const</span> v6addr_t loc_inner, <span class="enscript-type">const</span> v6addr_t loc_outer6, uint16_t loc_port, <span class="enscript-type">const</span> v6addr_t rmt_inner,
                            <span class="enscript-type">const</span> v6addr_t rmt_outer6, uint16_t rmt_port, <span class="enscript-type">const</span> <span class="enscript-type">char</span> *id, <span class="enscript-type">int</span> *err);
<span class="enscript-type">extern</span> <span class="enscript-type">void</span> <span class="enscript-function-name">helper_exit</span>(<span class="enscript-type">void</span>);

#<span class="enscript-reference">endif</span> <span class="enscript-comment">/* H_HELPER_H */</span>
</pre>
<hr />
</body></html>